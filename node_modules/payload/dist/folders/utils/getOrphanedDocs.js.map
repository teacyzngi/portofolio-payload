{"version":3,"sources":["../../../src/folders/utils/getOrphanedDocs.ts"],"sourcesContent":["import type { CollectionSlug, PayloadRequest, Where } from '../../index.js'\nimport type { FolderOrDocument } from '../types.js'\n\nimport { combineWhereConstraints } from '../../utilities/combineWhereConstraints.js'\nimport { formatFolderOrDocumentItem } from './formatFolderOrDocumentItem.js'\n\ntype Args = {\n  collectionSlug: CollectionSlug\n  folderFieldName: string\n  req: PayloadRequest\n  /**\n   * Optional where clause to filter documents by\n   * @default undefined\n   */\n  where?: Where\n}\nexport async function getOrphanedDocs({\n  collectionSlug,\n  folderFieldName,\n  req,\n  where,\n}: Args): Promise<FolderOrDocument[]> {\n  const { payload, user } = req\n  const noParentFolderConstraint: Where = {\n    or: [\n      {\n        [folderFieldName]: {\n          exists: false,\n        },\n      },\n      {\n        [folderFieldName]: {\n          equals: null,\n        },\n      },\n    ],\n  }\n\n  const orphanedFolders = await payload.find({\n    collection: collectionSlug,\n    limit: 0,\n    overrideAccess: false,\n    req,\n    sort: payload.collections[collectionSlug]?.config.admin.useAsTitle,\n    user,\n    where: where\n      ? combineWhereConstraints([noParentFolderConstraint, where])\n      : noParentFolderConstraint,\n  })\n\n  return (\n    orphanedFolders?.docs.map((doc) =>\n      formatFolderOrDocumentItem({\n        folderFieldName,\n        isUpload: Boolean(payload.collections[collectionSlug]?.config.upload),\n        relationTo: collectionSlug,\n        useAsTitle: payload.collections[collectionSlug]?.config.admin.useAsTitle,\n        value: doc,\n      }),\n    ) || []\n  )\n}\n"],"names":["combineWhereConstraints","formatFolderOrDocumentItem","getOrphanedDocs","collectionSlug","folderFieldName","req","where","payload","user","noParentFolderConstraint","or","exists","equals","orphanedFolders","find","collection","limit","overrideAccess","sort","collections","config","admin","useAsTitle","docs","map","doc","isUpload","Boolean","upload","relationTo","value"],"mappings":"AAGA,SAASA,uBAAuB,QAAQ,6CAA4C;AACpF,SAASC,0BAA0B,QAAQ,kCAAiC;AAY5E,OAAO,eAAeC,gBAAgB,EACpCC,cAAc,EACdC,eAAe,EACfC,GAAG,EACHC,KAAK,EACA;IACL,MAAM,EAAEC,OAAO,EAAEC,IAAI,EAAE,GAAGH;IAC1B,MAAMI,2BAAkC;QACtCC,IAAI;YACF;gBACE,CAACN,gBAAgB,EAAE;oBACjBO,QAAQ;gBACV;YACF;YACA;gBACE,CAACP,gBAAgB,EAAE;oBACjBQ,QAAQ;gBACV;YACF;SACD;IACH;IAEA,MAAMC,kBAAkB,MAAMN,QAAQO,IAAI,CAAC;QACzCC,YAAYZ;QACZa,OAAO;QACPC,gBAAgB;QAChBZ;QACAa,MAAMX,QAAQY,WAAW,CAAChB,eAAe,EAAEiB,OAAOC,MAAMC;QACxDd;QACAF,OAAOA,QACHN,wBAAwB;YAACS;YAA0BH;SAAM,IACzDG;IACN;IAEA,OACEI,iBAAiBU,KAAKC,IAAI,CAACC,MACzBxB,2BAA2B;YACzBG;YACAsB,UAAUC,QAAQpB,QAAQY,WAAW,CAAChB,eAAe,EAAEiB,OAAOQ;YAC9DC,YAAY1B;YACZmB,YAAYf,QAAQY,WAAW,CAAChB,eAAe,EAAEiB,OAAOC,MAAMC;YAC9DQ,OAAOL;QACT,OACG,EAAE;AAEX"}