{"version":3,"sources":["../../src/utilities/validateWhereQuery.ts"],"sourcesContent":["import type { Operator, Where } from '../types/index.js'\n\nimport { validOperatorSet } from '../types/constants.js'\n\n/**\n * Validates that a \"where\" query is in a format in which the \"where builder\" can understand.\n * Even though basic queries are valid, we need to hoist them into the \"and\" / \"or\" format.\n * Use this function alongside `transformWhereQuery` to perform a transformation if the query is not valid.\n * @example\n * Inaccurate: [text][equals]=example%20post\n * Accurate: [or][0][and][0][text][equals]=example%20post\n */\nexport const validateWhereQuery = (whereQuery: Where): whereQuery is Where => {\n  if (\n    whereQuery?.or &&\n    (whereQuery?.or?.length === 0 ||\n      (whereQuery?.or?.length > 0 &&\n        whereQuery?.or?.[0]?.and &&\n        whereQuery?.or?.[0]?.and?.length > 0))\n  ) {\n    // At this point we know that the whereQuery has 'or' and 'and' fields,\n    // now let's check the structure and content of these fields.\n\n    const isValid = whereQuery.or.every((orQuery) => {\n      if (orQuery.and && Array.isArray(orQuery.and)) {\n        return orQuery.and.every((andQuery) => {\n          if (typeof andQuery !== 'object') {\n            return false\n          }\n\n          const andKeys = Object.keys(andQuery)\n\n          // If there are no keys, it's not a valid WhereField.\n          if (andKeys.length === 0) {\n            return false\n          }\n\n          for (const key of andKeys) {\n            const operator = Object.keys(andQuery[key]!)[0]\n            // Check if the key is a valid Operator.\n            if (!operator || !validOperatorSet.has(operator as Operator)) {\n              return false\n            }\n          }\n          return true\n        })\n      }\n      return false\n    })\n\n    return isValid\n  }\n\n  return false\n}\n"],"names":["validOperatorSet","validateWhereQuery","whereQuery","or","length","and","isValid","every","orQuery","Array","isArray","andQuery","andKeys","Object","keys","key","operator","has"],"mappings":"AAEA,SAASA,gBAAgB,QAAQ,wBAAuB;AAExD;;;;;;;CAOC,GACD,OAAO,MAAMC,qBAAqB,CAACC;IACjC,IACEA,YAAYC,MACXD,CAAAA,YAAYC,IAAIC,WAAW,KACzBF,YAAYC,IAAIC,SAAS,KACxBF,YAAYC,IAAI,CAAC,EAAE,EAAEE,OACrBH,YAAYC,IAAI,CAAC,EAAE,EAAEE,KAAKD,SAAS,CAAC,GACxC;QACA,uEAAuE;QACvE,6DAA6D;QAE7D,MAAME,UAAUJ,WAAWC,EAAE,CAACI,KAAK,CAAC,CAACC;YACnC,IAAIA,QAAQH,GAAG,IAAII,MAAMC,OAAO,CAACF,QAAQH,GAAG,GAAG;gBAC7C,OAAOG,QAAQH,GAAG,CAACE,KAAK,CAAC,CAACI;oBACxB,IAAI,OAAOA,aAAa,UAAU;wBAChC,OAAO;oBACT;oBAEA,MAAMC,UAAUC,OAAOC,IAAI,CAACH;oBAE5B,qDAAqD;oBACrD,IAAIC,QAAQR,MAAM,KAAK,GAAG;wBACxB,OAAO;oBACT;oBAEA,KAAK,MAAMW,OAAOH,QAAS;wBACzB,MAAMI,WAAWH,OAAOC,IAAI,CAACH,QAAQ,CAACI,IAAI,CAAE,CAAC,EAAE;wBAC/C,wCAAwC;wBACxC,IAAI,CAACC,YAAY,CAAChB,iBAAiBiB,GAAG,CAACD,WAAuB;4BAC5D,OAAO;wBACT;oBACF;oBACA,OAAO;gBACT;YACF;YACA,OAAO;QACT;QAEA,OAAOV;IACT;IAEA,OAAO;AACT,EAAC"}