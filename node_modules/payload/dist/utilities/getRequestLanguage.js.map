{"version":3,"sources":["../../src/utilities/getRequestLanguage.ts"],"sourcesContent":["import type { AcceptedLanguages } from '@payloadcms/translations'\nimport type { ReadonlyRequestCookies } from 'next/dist/server/web/spec-extension/adapters/request-cookies.js'\n\nimport { extractHeaderLanguage } from '@payloadcms/translations'\n\nimport type { SanitizedConfig } from '../config/types.js'\n\ntype GetRequestLanguageArgs = {\n  config: SanitizedConfig\n  cookies: Map<string, string> | ReadonlyRequestCookies\n  defaultLanguage?: AcceptedLanguages\n  headers: Request['headers']\n}\n\nexport const getRequestLanguage = ({\n  config,\n  cookies,\n  headers,\n}: GetRequestLanguageArgs): AcceptedLanguages => {\n  const supportedLanguageKeys = Object.keys(config.i18n.supportedLanguages) as AcceptedLanguages[]\n  const langCookie = cookies.get(`${config.cookiePrefix || 'payload'}-lng`)\n\n  const languageFromCookie: AcceptedLanguages = (\n    typeof langCookie === 'string' ? langCookie : langCookie?.value\n  ) as AcceptedLanguages\n\n  if (languageFromCookie && supportedLanguageKeys.includes(languageFromCookie)) {\n    return languageFromCookie\n  }\n\n  const languageFromHeader = headers.get('Accept-Language')\n    ? extractHeaderLanguage(headers.get('Accept-Language')!)\n    : undefined\n\n  if (languageFromHeader && supportedLanguageKeys.includes(languageFromHeader)) {\n    return languageFromHeader\n  }\n\n  return config.i18n.fallbackLanguage\n}\n"],"names":["extractHeaderLanguage","getRequestLanguage","config","cookies","headers","supportedLanguageKeys","Object","keys","i18n","supportedLanguages","langCookie","get","cookiePrefix","languageFromCookie","value","includes","languageFromHeader","undefined","fallbackLanguage"],"mappings":"AAGA,SAASA,qBAAqB,QAAQ,2BAA0B;AAWhE,OAAO,MAAMC,qBAAqB,CAAC,EACjCC,MAAM,EACNC,OAAO,EACPC,OAAO,EACgB;IACvB,MAAMC,wBAAwBC,OAAOC,IAAI,CAACL,OAAOM,IAAI,CAACC,kBAAkB;IACxE,MAAMC,aAAaP,QAAQQ,GAAG,CAAC,GAAGT,OAAOU,YAAY,IAAI,UAAU,IAAI,CAAC;IAExE,MAAMC,qBACJ,OAAOH,eAAe,WAAWA,aAAaA,YAAYI;IAG5D,IAAID,sBAAsBR,sBAAsBU,QAAQ,CAACF,qBAAqB;QAC5E,OAAOA;IACT;IAEA,MAAMG,qBAAqBZ,QAAQO,GAAG,CAAC,qBACnCX,sBAAsBI,QAAQO,GAAG,CAAC,sBAClCM;IAEJ,IAAID,sBAAsBX,sBAAsBU,QAAQ,CAACC,qBAAqB;QAC5E,OAAOA;IACT;IAEA,OAAOd,OAAOM,IAAI,CAACU,gBAAgB;AACrC,EAAC"}