{"version":3,"sources":["../../src/utilities/deepCopyObject.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type { JsonValue } from '../types/index.js'\n\n/*\nMain deepCopyObject handling - from rfdc: https://github.com/davidmarkclements/rfdc/blob/master/index.js\n\nCopyright 2019 \"David Mark Clements <david.mark.clements@gmail.com>\"\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\ndocumentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\nthe rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\nto permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions\nof the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED\nTO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\nTHE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF\nCONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\nIN THE SOFTWARE.\n*/\n\nfunction copyBuffer(cur: any) {\n  if (cur instanceof Buffer) {\n    return Buffer.from(cur)\n  }\n\n  return new cur.constructor(cur.buffer.slice(), cur.byteOffset, cur.length)\n}\n\nconst constructorHandlers = new Map()\nconstructorHandlers.set(Date, (o: any) => new Date(o))\nconstructorHandlers.set(Map, (o: any, fn: any) => new Map(cloneArray<any>(Array.from(o), fn)))\nconstructorHandlers.set(Set, (o: any, fn: any) => new Set(cloneArray(Array.from(o), fn)))\nconstructorHandlers.set(RegExp, (regex: RegExp) => new RegExp(regex.source, regex.flags))\n\nlet handler: ((o: any, fn: any) => any) | null = null\n\nfunction cloneArray<T extends object>(a: T, fn: (o: any) => any): T {\n  const keys = Object.keys(a)\n  const a2 = new Array(keys.length) as T\n  for (let i = 0; i < keys.length; i++) {\n    const k = keys[i] as keyof typeof a\n    const cur = a[k] as any\n    if (typeof cur !== 'object' || cur === null) {\n      a2[k] = cur\n    } else if (cur instanceof RegExp) {\n      a2[k] = new RegExp(cur.source, cur.flags) as any\n    } else if (cur.constructor !== Object && (handler = constructorHandlers.get(cur.constructor))) {\n      a2[k] = handler(cur, fn)\n    } else if (ArrayBuffer.isView(cur)) {\n      a2[k] = copyBuffer(cur)\n    } else {\n      a2[k] = fn(cur)\n    }\n  }\n  return a2\n}\n\nexport const deepCopyObject = <T>(o: T): T => {\n  if (typeof o !== 'object' || o === null) {\n    return o\n  }\n  if (Array.isArray(o)) {\n    return cloneArray(o, deepCopyObject)\n  }\n  if (o instanceof RegExp) {\n    return new RegExp(o.source, o.flags) as T\n  }\n\n  if (o.constructor !== Object && (handler = constructorHandlers.get(o.constructor))) {\n    return handler(o, deepCopyObject)\n  }\n  const o2 = {} as T\n  for (const k in o) {\n    if (Object.hasOwnProperty.call(o, k) === false) {\n      continue\n    }\n    const cur = o[k]\n    if (typeof cur !== 'object' || cur === null) {\n      o2[k] = cur\n    } else if (cur instanceof RegExp) {\n      o2[k] = new RegExp(cur.source, cur.flags) as any\n    } else if (cur.constructor !== Object && (handler = constructorHandlers.get(cur.constructor))) {\n      o2[k] = handler(cur, deepCopyObject)\n    } else if (ArrayBuffer.isView(cur)) {\n      o2[k] = copyBuffer(cur)\n    } else {\n      o2[k] = deepCopyObject(cur)\n    }\n  }\n  return o2\n}\n\n/*\nFast deepCopyObjectSimple handling - from fast-json-clone: https://github.com/rhysd/fast-json-clone\n\nBenchmark: https://github.com/AlessioGr/fastest-deep-clone-json/blob/main/test/benchmark.js\n*/\n\n/**\n * A deepCopyObject implementation which only works for JSON objects and arrays, and is faster than\n * JSON.parse(JSON.stringify(obj))\n *\n * @param value The JSON value to be cloned. There are two invariants. 1) It must not contain circles\n *              as JSON does not allow it. This function will cause infinite loop for such values by\n *              design. 2) It must contain JSON values only. Other values like `Date`, `Regexp`, `Map`,\n *              `Set`, `Buffer`, ... are not allowed.\n * @returns The cloned JSON value.\n */\nexport function deepCopyObjectSimple<T extends JsonValue>(value: T, filterUndefined = false): T {\n  if (typeof value !== 'object' || value === null) {\n    return value\n  } else if (Array.isArray(value)) {\n    return value.map((e) =>\n      typeof e !== 'object' || e === null ? e : deepCopyObjectSimple(e, filterUndefined),\n    ) as T\n  } else {\n    if (value instanceof Date) {\n      return new Date(value) as unknown as T\n    }\n    const ret: { [key: string]: T } = {}\n    for (const k in value) {\n      const v = value[k]\n      if (filterUndefined && v === undefined) {\n        continue\n      }\n      ret[k] =\n        typeof v !== 'object' || v === null\n          ? v\n          : (deepCopyObjectSimple(v as T, filterUndefined) as any)\n    }\n    return ret as unknown as T\n  }\n}\n\nexport function deepCopyObjectSimpleWithoutReactComponents<T extends JsonValue>(value: T): T {\n  if (\n    typeof value === 'object' &&\n    value !== null &&\n    '$$typeof' in value &&\n    typeof value.$$typeof === 'symbol'\n  ) {\n    return undefined!\n  } else if (typeof value !== 'object' || value === null) {\n    return value\n  } else if (Array.isArray(value)) {\n    return value.map((e) =>\n      typeof e !== 'object' || e === null ? e : deepCopyObjectSimpleWithoutReactComponents(e),\n    ) as T\n  } else {\n    if (value instanceof Date) {\n      return new Date(value) as unknown as T\n    }\n    const ret: { [key: string]: T } = {}\n    for (const k in value) {\n      const v = value[k]\n      ret[k] =\n        typeof v !== 'object' || v === null\n          ? v\n          : (deepCopyObjectSimpleWithoutReactComponents(v as T) as any)\n    }\n    return ret as unknown as T\n  }\n}\n\n/**\n * A deepCopyObject implementation which is slower than deepCopyObject, but more correct.\n * Can be used if correctness is more important than speed. Supports circular dependencies\n */\nexport function deepCopyObjectComplex<T>(object: T, cache: WeakMap<any, any> = new WeakMap()): T {\n  if (object === null) {\n    return null!\n  }\n\n  if (cache.has(object)) {\n    return cache.get(object)\n  }\n\n  // Handle File\n  if (object instanceof File) {\n    return object as unknown as T\n  }\n\n  // Handle Date\n  if (object instanceof Date) {\n    return new Date(object.getTime()) as unknown as T\n  }\n\n  // Handle RegExp\n  if (object instanceof RegExp) {\n    return new RegExp(object.source, object.flags) as unknown as T\n  }\n\n  // Handle Map\n  if (object instanceof Map) {\n    const clonedMap = new Map()\n    cache.set(object, clonedMap)\n    for (const [key, value] of object.entries()) {\n      clonedMap.set(key, deepCopyObjectComplex(value, cache))\n    }\n    return clonedMap as unknown as T\n  }\n\n  // Handle Set\n  if (object instanceof Set) {\n    const clonedSet = new Set()\n    cache.set(object, clonedSet)\n    for (const value of object.values()) {\n      clonedSet.add(deepCopyObjectComplex(value, cache))\n    }\n    return clonedSet as unknown as T\n  }\n\n  // Handle Array and Object\n  if (typeof object === 'object' && object !== null) {\n    if ('$$typeof' in object && typeof object.$$typeof === 'symbol') {\n      return object\n    }\n\n    const clonedObject: any = Array.isArray(object)\n      ? []\n      : Object.create(Object.getPrototypeOf(object))\n    cache.set(object, clonedObject)\n\n    for (const key in object) {\n      if (\n        Object.prototype.hasOwnProperty.call(object, key) ||\n        Object.getOwnPropertySymbols(object).includes(key as any)\n      ) {\n        clonedObject[key] = deepCopyObjectComplex(object[key], cache)\n      }\n    }\n\n    return clonedObject as T\n  }\n\n  // Handle all other cases\n  return object\n}\n"],"names":["copyBuffer","cur","Buffer","from","constructor","buffer","slice","byteOffset","length","constructorHandlers","Map","set","Date","o","fn","cloneArray","Array","Set","RegExp","regex","source","flags","handler","a","keys","Object","a2","i","k","get","ArrayBuffer","isView","deepCopyObject","isArray","o2","hasOwnProperty","call","deepCopyObjectSimple","value","filterUndefined","map","e","ret","v","undefined","deepCopyObjectSimpleWithoutReactComponents","$$typeof","deepCopyObjectComplex","object","cache","WeakMap","has","File","getTime","clonedMap","key","entries","clonedSet","values","add","clonedObject","create","getPrototypeOf","prototype","getOwnPropertySymbols","includes"],"mappings":"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"}