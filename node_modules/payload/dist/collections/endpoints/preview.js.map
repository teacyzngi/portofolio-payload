{"version":3,"sources":["../../../src/collections/endpoints/preview.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { extractJWT } from '../../auth/extractJWT.js'\nimport { getRequestCollectionWithID } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { isNumber } from '../../utilities/isNumber.js'\nimport { findByIDOperation } from '../operations/findByID.js'\n\nexport const previewHandler: PayloadHandler = async (req) => {\n  const { id, collection } = getRequestCollectionWithID(req)\n  const { searchParams } = req\n  const depth = searchParams.get('depth')\n\n  const doc = await findByIDOperation({\n    id,\n    collection,\n    depth: isNumber(depth) ? Number(depth) : undefined,\n    draft: searchParams.get('draft') === 'true',\n    req,\n    trash: true,\n  })\n\n  let previewURL!: string\n\n  const generatePreviewURL =\n    req.payload?.collections?.[collection.config.slug]?.config?.admin?.preview\n\n  const token = extractJWT(req)\n\n  if (typeof generatePreviewURL === 'function') {\n    previewURL = (await generatePreviewURL(doc, {\n      locale: req.locale!,\n      req,\n      token,\n    })) as string\n  }\n\n  return Response.json(previewURL, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","extractJWT","getRequestCollectionWithID","headersWithCors","isNumber","findByIDOperation","previewHandler","req","id","collection","searchParams","depth","get","doc","Number","undefined","draft","trash","previewURL","generatePreviewURL","payload","collections","config","slug","admin","preview","token","locale","Response","json","headers","Headers","OK"],"mappings":"AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,UAAU,QAAQ,2BAA0B;AACrD,SAASC,0BAA0B,QAAQ,sCAAqC;AAChF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,QAAQ,QAAQ,8BAA6B;AACtD,SAASC,iBAAiB,QAAQ,4BAA2B;AAE7D,OAAO,MAAMC,iBAAiC,OAAOC;IACnD,MAAM,EAAEC,EAAE,EAAEC,UAAU,EAAE,GAAGP,2BAA2BK;IACtD,MAAM,EAAEG,YAAY,EAAE,GAAGH;IACzB,MAAMI,QAAQD,aAAaE,GAAG,CAAC;IAE/B,MAAMC,MAAM,MAAMR,kBAAkB;QAClCG;QACAC;QACAE,OAAOP,SAASO,SAASG,OAAOH,SAASI;QACzCC,OAAON,aAAaE,GAAG,CAAC,aAAa;QACrCL;QACAU,OAAO;IACT;IAEA,IAAIC;IAEJ,MAAMC,qBACJZ,IAAIa,OAAO,EAAEC,aAAa,CAACZ,WAAWa,MAAM,CAACC,IAAI,CAAC,EAAED,QAAQE,OAAOC;IAErE,MAAMC,QAAQzB,WAAWM;IAEzB,IAAI,OAAOY,uBAAuB,YAAY;QAC5CD,aAAc,MAAMC,mBAAmBN,KAAK;YAC1Cc,QAAQpB,IAAIoB,MAAM;YAClBpB;YACAmB;QACF;IACF;IAEA,OAAOE,SAASC,IAAI,CAACX,YAAY;QAC/BY,SAAS3B,gBAAgB;YACvB2B,SAAS,IAAIC;YACbxB;QACF;QACAR,QAAQC,WAAWgC,EAAE;IACvB;AACF,EAAC"}