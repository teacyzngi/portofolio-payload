{"version":3,"sources":["../../../src/collections/endpoints/update.ts"],"sourcesContent":["import { getTranslation } from '@payloadcms/translations'\nimport { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\nimport type { Where } from '../../types/index.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { isNumber } from '../../utilities/isNumber.js'\nimport { sanitizePopulateParam } from '../../utilities/sanitizePopulateParam.js'\nimport { sanitizeSelectParam } from '../../utilities/sanitizeSelectParam.js'\nimport { updateOperation } from '../operations/update.js'\n\nexport const updateHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n  const { depth, draft, limit, overrideLock, populate, select, sort, trash, where } = req.query as {\n    depth?: string\n    draft?: string\n    limit?: string\n    overrideLock?: string\n    populate?: Record<string, unknown>\n    select?: Record<string, unknown>\n    sort?: string\n    trash?: string\n    where?: Where\n  }\n\n  const result = await updateOperation({\n    collection,\n    data: req.data!,\n    depth: isNumber(depth) ? Number(depth) : undefined,\n    draft: draft === 'true',\n    limit: isNumber(limit) ? Number(limit) : undefined,\n    overrideLock: Boolean(overrideLock === 'true'),\n    populate: sanitizePopulateParam(populate),\n    req,\n    select: sanitizeSelectParam(select),\n    sort: typeof sort === 'string' ? sort.split(',') : undefined,\n    trash: trash === 'true',\n    where: where!,\n  })\n\n  const headers = headersWithCors({\n    headers: new Headers(),\n    req,\n  })\n\n  if (result.errors.length === 0) {\n    const message = req.t('general:updatedCountSuccessfully', {\n      count: result.docs.length,\n      label: getTranslation(\n        collection.config.labels[result.docs.length === 1 ? 'singular' : 'plural'],\n        req.i18n,\n      ),\n    })\n\n    return Response.json(\n      {\n        ...result,\n        message,\n      },\n      {\n        headers,\n        status: httpStatus.OK,\n      },\n    )\n  }\n\n  const total = result.docs.length + result.errors.length\n  const message = req.t('error:unableToUpdateCount', {\n    count: result.errors.length,\n    label: getTranslation(collection.config.labels[total === 1 ? 'singular' : 'plural'], req.i18n),\n    total,\n  })\n\n  return Response.json(\n    {\n      ...result,\n      message,\n    },\n    {\n      headers,\n      status: httpStatus.BAD_REQUEST,\n    },\n  )\n}\n"],"names":["getTranslation","status","httpStatus","getRequestCollection","headersWithCors","isNumber","sanitizePopulateParam","sanitizeSelectParam","updateOperation","updateHandler","req","collection","depth","draft","limit","overrideLock","populate","select","sort","trash","where","query","result","data","Number","undefined","Boolean","split","headers","Headers","errors","length","message","t","count","docs","label","config","labels","i18n","Response","json","OK","total","BAD_REQUEST"],"mappings":"AAAA,SAASA,cAAc,QAAQ,2BAA0B;AACzD,SAASC,UAAUC,UAAU,QAAQ,cAAa;AAKlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,QAAQ,QAAQ,8BAA6B;AACtD,SAASC,qBAAqB,QAAQ,2CAA0C;AAChF,SAASC,mBAAmB,QAAQ,yCAAwC;AAC5E,SAASC,eAAe,QAAQ,0BAAyB;AAEzD,OAAO,MAAMC,gBAAgC,OAAOC;IAClD,MAAMC,aAAaR,qBAAqBO;IACxC,MAAM,EAAEE,KAAK,EAAEC,KAAK,EAAEC,KAAK,EAAEC,YAAY,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAEC,KAAK,EAAE,GAAGV,IAAIW,KAAK;IAY7F,MAAMC,SAAS,MAAMd,gBAAgB;QACnCG;QACAY,MAAMb,IAAIa,IAAI;QACdX,OAAOP,SAASO,SAASY,OAAOZ,SAASa;QACzCZ,OAAOA,UAAU;QACjBC,OAAOT,SAASS,SAASU,OAAOV,SAASW;QACzCV,cAAcW,QAAQX,iBAAiB;QACvCC,UAAUV,sBAAsBU;QAChCN;QACAO,QAAQV,oBAAoBU;QAC5BC,MAAM,OAAOA,SAAS,WAAWA,KAAKS,KAAK,CAAC,OAAOF;QACnDN,OAAOA,UAAU;QACjBC,OAAOA;IACT;IAEA,MAAMQ,UAAUxB,gBAAgB;QAC9BwB,SAAS,IAAIC;QACbnB;IACF;IAEA,IAAIY,OAAOQ,MAAM,CAACC,MAAM,KAAK,GAAG;QAC9B,MAAMC,UAAUtB,IAAIuB,CAAC,CAAC,oCAAoC;YACxDC,OAAOZ,OAAOa,IAAI,CAACJ,MAAM;YACzBK,OAAOpC,eACLW,WAAW0B,MAAM,CAACC,MAAM,CAAChB,OAAOa,IAAI,CAACJ,MAAM,KAAK,IAAI,aAAa,SAAS,EAC1ErB,IAAI6B,IAAI;QAEZ;QAEA,OAAOC,SAASC,IAAI,CAClB;YACE,GAAGnB,MAAM;YACTU;QACF,GACA;YACEJ;YACA3B,QAAQC,WAAWwC,EAAE;QACvB;IAEJ;IAEA,MAAMC,QAAQrB,OAAOa,IAAI,CAACJ,MAAM,GAAGT,OAAOQ,MAAM,CAACC,MAAM;IACvD,MAAMC,UAAUtB,IAAIuB,CAAC,CAAC,6BAA6B;QACjDC,OAAOZ,OAAOQ,MAAM,CAACC,MAAM;QAC3BK,OAAOpC,eAAeW,WAAW0B,MAAM,CAACC,MAAM,CAACK,UAAU,IAAI,aAAa,SAAS,EAAEjC,IAAI6B,IAAI;QAC7FI;IACF;IAEA,OAAOH,SAASC,IAAI,CAClB;QACE,GAAGnB,MAAM;QACTU;IACF,GACA;QACEJ;QACA3B,QAAQC,WAAW0C,WAAW;IAChC;AAEJ,EAAC"}