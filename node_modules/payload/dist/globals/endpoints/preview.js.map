{"version":3,"sources":["../../../src/globals/endpoints/preview.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { extractJWT } from '../../auth/extractJWT.js'\nimport { getRequestGlobal } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { isNumber } from '../../utilities/isNumber.js'\nimport { findOneOperation } from '../operations/findOne.js'\n\nexport const previewHandler: PayloadHandler = async (req) => {\n  const globalConfig = getRequestGlobal(req)\n  const { searchParams } = req\n  const depth = searchParams.get('depth')\n\n  const doc = await findOneOperation({\n    slug: globalConfig.slug,\n    depth: isNumber(depth) ? Number(depth) : undefined,\n    draft: searchParams.get('draft') === 'true',\n    globalConfig,\n    req,\n  })\n\n  let previewURL!: string\n\n  const generatePreviewURL = req.payload.config.globals.find(\n    (config) => config.slug === globalConfig.slug,\n  )?.admin?.preview\n\n  const token = extractJWT(req)\n\n  if (typeof generatePreviewURL === 'function') {\n    previewURL = (await generatePreviewURL(doc, {\n      locale: req.locale!,\n      req,\n      token,\n    }))!\n  }\n\n  return Response.json(previewURL, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","extractJWT","getRequestGlobal","headersWithCors","isNumber","findOneOperation","previewHandler","req","globalConfig","searchParams","depth","get","doc","slug","Number","undefined","draft","previewURL","generatePreviewURL","payload","config","globals","find","admin","preview","token","locale","Response","json","headers","Headers","OK"],"mappings":"AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,UAAU,QAAQ,2BAA0B;AACrD,SAASC,gBAAgB,QAAQ,sCAAqC;AACtE,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,QAAQ,QAAQ,8BAA6B;AACtD,SAASC,gBAAgB,QAAQ,2BAA0B;AAE3D,OAAO,MAAMC,iBAAiC,OAAOC;IACnD,MAAMC,eAAeN,iBAAiBK;IACtC,MAAM,EAAEE,YAAY,EAAE,GAAGF;IACzB,MAAMG,QAAQD,aAAaE,GAAG,CAAC;IAE/B,MAAMC,MAAM,MAAMP,iBAAiB;QACjCQ,MAAML,aAAaK,IAAI;QACvBH,OAAON,SAASM,SAASI,OAAOJ,SAASK;QACzCC,OAAOP,aAAaE,GAAG,CAAC,aAAa;QACrCH;QACAD;IACF;IAEA,IAAIU;IAEJ,MAAMC,qBAAqBX,IAAIY,OAAO,CAACC,MAAM,CAACC,OAAO,CAACC,IAAI,CACxD,CAACF,SAAWA,OAAOP,IAAI,KAAKL,aAAaK,IAAI,GAC5CU,OAAOC;IAEV,MAAMC,QAAQxB,WAAWM;IAEzB,IAAI,OAAOW,uBAAuB,YAAY;QAC5CD,aAAc,MAAMC,mBAAmBN,KAAK;YAC1Cc,QAAQnB,IAAImB,MAAM;YAClBnB;YACAkB;QACF;IACF;IAEA,OAAOE,SAASC,IAAI,CAACX,YAAY;QAC/BY,SAAS1B,gBAAgB;YACvB0B,SAAS,IAAIC;YACbvB;QACF;QACAR,QAAQC,WAAW+B,EAAE;IACvB;AACF,EAAC"}