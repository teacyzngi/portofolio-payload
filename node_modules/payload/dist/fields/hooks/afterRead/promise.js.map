{"version":3,"sources":["../../../../src/fields/hooks/afterRead/promise.ts"],"sourcesContent":["import type { RichTextAdapter } from '../../../admin/RichText.js'\nimport type { SanitizedCollectionConfig } from '../../../collections/config/types.js'\nimport type { SanitizedGlobalConfig } from '../../../globals/config/types.js'\nimport type {\n  JsonObject,\n  PayloadRequest,\n  PopulateType,\n  SelectMode,\n  SelectType,\n} from '../../../types/index.js'\nimport type { Block, Field, TabAsField } from '../../config/types.js'\nimport type { AfterReadArgs } from './index.js'\n\nimport { MissingEditorProp } from '../../../errors/index.js'\nimport { type RequestContext } from '../../../index.js'\nimport { getBlockSelect } from '../../../utilities/getBlockSelect.js'\nimport { stripUnselectedFields } from '../../../utilities/stripUnselectedFields.js'\nimport { fieldAffectsData, fieldShouldBeLocalized, tabHasName } from '../../config/types.js'\nimport { getDefaultValue } from '../../getDefaultValue.js'\nimport { getFieldPathsModified as getFieldPaths } from '../../getFieldPaths.js'\nimport { relationshipPopulationPromise } from './relationshipPopulationPromise.js'\nimport { traverseFields } from './traverseFields.js'\nimport { virtualFieldPopulationPromise } from './virtualFieldPopulationPromise.js'\n\ntype Args = {\n  /**\n   * Data of the nearest parent block. If no parent block exists, this will be the `undefined`\n   */\n  blockData?: JsonObject\n  collection: null | SanitizedCollectionConfig\n  context: RequestContext\n  currentDepth: number\n  depth: number\n  doc: JsonObject\n  draft: boolean\n  fallbackLocale: null | string | string[]\n  field: Field | TabAsField\n  fieldIndex: number\n  /**\n   * fieldPromises are used for things like field hooks. They should be awaited before awaiting populationPromises\n   */\n  fieldPromises: Promise<void>[]\n  findMany: boolean\n  global: null | SanitizedGlobalConfig\n  locale: null | string\n  overrideAccess: boolean\n  parentIndexPath: string\n  /**\n   * @todo make required in v4.0\n   */\n  parentIsLocalized?: boolean\n  parentPath: string\n  parentSchemaPath: string\n  populate?: PopulateType\n  populationPromises: Promise<void>[]\n  req: PayloadRequest\n  select?: SelectType\n  selectMode?: SelectMode\n  showHiddenFields: boolean\n  siblingDoc: JsonObject\n  siblingFields?: (Field | TabAsField)[]\n  triggerAccessControl?: boolean\n  triggerHooks?: boolean\n} & Required<Pick<AfterReadArgs<JsonObject>, 'flattenLocales'>>\n\n// This function is responsible for the following actions, in order:\n// - Remove hidden fields from response\n// - Flatten locales into requested locale\n// - Sanitize outgoing data (point field, etc.)\n// - Execute field hooks\n// - Execute read access control\n// - Populate relationships\n\nexport const promise = async ({\n  blockData,\n  collection,\n  context,\n  currentDepth,\n  depth,\n  doc,\n  draft,\n  fallbackLocale,\n  field,\n  fieldIndex,\n  fieldPromises,\n  findMany,\n  flattenLocales,\n  global,\n  locale,\n  overrideAccess,\n  parentIndexPath,\n  parentIsLocalized,\n  parentPath,\n  parentSchemaPath,\n  populate,\n  populationPromises,\n  req,\n  select,\n  selectMode,\n  showHiddenFields,\n  siblingDoc,\n  siblingFields,\n  triggerAccessControl = true,\n  triggerHooks = true,\n}: Args): Promise<void> => {\n  const { indexPath, path, schemaPath } = getFieldPaths({\n    field,\n    index: fieldIndex,\n    parentIndexPath,\n    parentPath,\n    parentSchemaPath,\n  })\n\n  const fieldAffectsDataResult = fieldAffectsData(field)\n  const pathSegments = path ? path.split('.') : []\n  const schemaPathSegments = schemaPath ? schemaPath.split('.') : []\n  const indexPathSegments = indexPath ? indexPath.split('-').filter(Boolean)?.map(Number) : []\n  let removedFieldValue = false\n\n  if (\n    fieldAffectsDataResult &&\n    field.hidden &&\n    typeof siblingDoc[field.name!] !== 'undefined' &&\n    !showHiddenFields\n  ) {\n    removedFieldValue = true\n    delete siblingDoc[field.name!]\n  }\n\n  if (path !== 'id') {\n    const shouldContinue = stripUnselectedFields({\n      field,\n      select: select!,\n      selectMode: selectMode!,\n      siblingDoc,\n    })\n\n    if (!shouldContinue) {\n      return\n    }\n  }\n\n  const shouldHoistLocalizedValue: boolean = Boolean(\n    flattenLocales &&\n      fieldAffectsDataResult &&\n      typeof siblingDoc[field.name!] === 'object' &&\n      siblingDoc[field.name!] !== null &&\n      fieldShouldBeLocalized({ field, parentIsLocalized: parentIsLocalized! }) &&\n      locale !== 'all' &&\n      req.payload.config.localization,\n  )\n\n  if (fieldAffectsDataResult && shouldHoistLocalizedValue) {\n    // replace actual value with localized value before sanitizing\n    // { [locale]: fields } -> fields\n    const value = siblingDoc[field.name!][locale!]\n\n    let hoistedValue = value\n\n    if (fallbackLocale && fallbackLocale !== locale) {\n      let fallbackValue\n      const isNullOrUndefined = typeof value === 'undefined' || value === null\n\n      if (Array.isArray(fallbackLocale)) {\n        for (const locale of fallbackLocale) {\n          const val = siblingDoc[field.name!]?.[locale]\n          if (val !== undefined && val !== null && val !== '') {\n            fallbackValue = val\n            break\n          }\n        }\n      } else {\n        fallbackValue = siblingDoc[field.name!][fallbackLocale]\n      }\n\n      if (fallbackValue) {\n        switch (field.type) {\n          case 'text':\n          case 'textarea': {\n            if (value === '' || isNullOrUndefined) {\n              hoistedValue = fallbackValue\n            }\n            break\n          }\n\n          default: {\n            if (isNullOrUndefined) {\n              hoistedValue = fallbackValue\n            }\n            break\n          }\n        }\n      }\n    }\n\n    siblingDoc[field.name!] = hoistedValue\n  }\n\n  // Sanitize outgoing field value\n  switch (field.type) {\n    case 'group': {\n      // Fill groups with empty objects so fields with hooks within groups can populate\n      // themselves virtually as necessary\n      if (fieldAffectsDataResult && typeof siblingDoc[field.name] === 'undefined') {\n        siblingDoc[field.name] = {}\n      }\n\n      break\n    }\n    case 'point': {\n      const pointDoc = siblingDoc[field.name] as Record<string, unknown>\n      if (Array.isArray(pointDoc?.coordinates) && pointDoc.coordinates.length === 2) {\n        siblingDoc[field.name] = pointDoc.coordinates\n      } else {\n        siblingDoc[field.name] = undefined\n      }\n\n      break\n    }\n\n    case 'richText': {\n      if (!field?.editor) {\n        throw new MissingEditorProp(field) // while we allow disabling editor functionality, you should not have any richText fields defined if you do not have an editor\n      }\n      if (typeof field?.editor === 'function') {\n        throw new Error('Attempted to access unsanitized rich text editor.')\n      }\n\n      // Rich Text fields should use afterRead hooks to do population. The previous editor.populationPromises have been renamed to editor.graphQLPopulationPromises\n      break\n    }\n\n    case 'tabs': {\n      field.tabs.forEach((tab) => {\n        if (\n          tabHasName(tab) &&\n          (typeof siblingDoc[tab.name] === 'undefined' || siblingDoc[tab.name] === null)\n        ) {\n          siblingDoc[tab.name] = {}\n        }\n      })\n\n      break\n    }\n\n    default: {\n      break\n    }\n  }\n\n  // If locale is `all`, siblingDoc[field.name] will be an object mapping locales to values - locales won't be flattened.\n  // In this case, run the hook for each locale and value pair\n  const shouldRunHookOnAllLocales =\n    locale === 'all' &&\n    'name' in field &&\n    typeof field.name === 'string' &&\n    // If localized values were hoisted, siblingDoc[field.name] will not be an object mapping locales to values\n    // => Object.entries(siblingDoc[field.name]) will be the value of a single locale, not all locales\n    // => do not run the hook for each locale\n    !shouldHoistLocalizedValue &&\n    fieldShouldBeLocalized({ field, parentIsLocalized: parentIsLocalized! }) &&\n    typeof siblingDoc[field.name] === 'object'\n\n  if (fieldAffectsDataResult) {\n    // Execute hooks\n    if (triggerHooks && 'hooks' in field && field.hooks?.afterRead) {\n      for (const hook of field.hooks.afterRead) {\n        if (shouldRunHookOnAllLocales) {\n          const localesAndValues = Object.entries(siblingDoc[field.name])\n          await Promise.all(\n            localesAndValues.map(async ([localeKey, value]) => {\n              const hookedValue = await hook({\n                blockData,\n                collection,\n                context,\n                currentDepth,\n                data: doc,\n                depth,\n                draft,\n                field,\n                findMany,\n                global,\n                indexPath: indexPathSegments,\n                operation: 'read',\n                originalDoc: doc,\n                overrideAccess,\n                path: pathSegments,\n                req,\n                schemaPath: schemaPathSegments,\n                showHiddenFields,\n                siblingData: siblingDoc,\n                siblingFields: siblingFields!,\n                value,\n              })\n\n              if (hookedValue !== undefined) {\n                siblingDoc[field.name][localeKey] = hookedValue\n              }\n            }),\n          )\n        } else {\n          const hookedValue = await hook({\n            blockData,\n            collection,\n            context,\n            currentDepth,\n            data: doc,\n            depth,\n            draft,\n            field,\n            findMany,\n            global,\n            indexPath: indexPathSegments,\n            operation: 'read',\n            originalDoc: doc,\n            overrideAccess,\n            path: pathSegments,\n            req,\n            schemaPath: schemaPathSegments,\n            showHiddenFields,\n            siblingData: siblingDoc,\n            siblingFields: siblingFields!,\n            value: siblingDoc[field.name],\n          })\n\n          if (hookedValue !== undefined) {\n            siblingDoc[field.name] = hookedValue\n          }\n        }\n      }\n    }\n\n    if (\n      'virtual' in field &&\n      typeof field.virtual === 'string' &&\n      (!field.hidden || showHiddenFields)\n    ) {\n      populationPromises.push(\n        virtualFieldPopulationPromise({\n          name: field.name,\n          draft,\n          fallbackLocale: fallbackLocale!,\n          fields: (collection || global)!.flattenedFields,\n          locale: locale!,\n          overrideAccess,\n          ref: doc,\n          req,\n          segments: field.virtual.split('.'),\n          showHiddenFields,\n          siblingDoc,\n        }),\n      )\n    }\n\n    // Execute access control\n    let allowDefaultValue = true\n    if (triggerAccessControl && field.access && field.access.read) {\n      const canReadField = overrideAccess\n        ? true\n        : await field.access.read({\n            id: doc.id as number | string,\n            blockData,\n            data: doc,\n            doc,\n            req,\n            siblingData: siblingDoc,\n          })\n\n      if (!canReadField) {\n        allowDefaultValue = false\n        delete siblingDoc[field.name!]\n      }\n    }\n\n    // Set defaultValue on the field for globals being returned without being first created\n    // or collection documents created prior to having a default\n    if (\n      !removedFieldValue &&\n      allowDefaultValue &&\n      typeof siblingDoc[field.name!] === 'undefined' &&\n      typeof field.defaultValue !== 'undefined'\n    ) {\n      siblingDoc[field.name!] = await getDefaultValue({\n        defaultValue: field.defaultValue,\n        locale: locale!,\n        req,\n        user: req.user,\n        value: siblingDoc[field.name!],\n      })\n    }\n\n    if (field.type === 'relationship' || field.type === 'upload' || field.type === 'join') {\n      populationPromises.push(\n        relationshipPopulationPromise({\n          currentDepth,\n          depth,\n          draft,\n          fallbackLocale,\n          field,\n          locale,\n          overrideAccess,\n          parentIsLocalized: parentIsLocalized!,\n          populate,\n          req,\n          showHiddenFields,\n          siblingDoc,\n        }),\n      )\n    }\n  }\n\n  switch (field.type) {\n    case 'array': {\n      const rows = siblingDoc[field.name] as JsonObject\n\n      let arraySelect = select?.[field.name]\n\n      if (selectMode === 'include' && typeof arraySelect === 'object') {\n        arraySelect = {\n          ...arraySelect,\n          id: true,\n        }\n      }\n\n      if (Array.isArray(rows) && rows.length > 0) {\n        rows.forEach((row, rowIndex) => {\n          traverseFields({\n            blockData,\n            collection,\n            context,\n            currentDepth,\n            depth,\n            doc,\n            draft,\n            fallbackLocale,\n            fieldPromises,\n            fields: field.fields,\n            findMany,\n            flattenLocales,\n            global,\n            locale,\n            overrideAccess,\n            parentIndexPath: '',\n            parentIsLocalized: parentIsLocalized || field.localized,\n            parentPath: path + '.' + rowIndex,\n            parentSchemaPath: schemaPath,\n            populate,\n            populationPromises,\n            req,\n            select: typeof arraySelect === 'object' ? arraySelect : undefined,\n            selectMode,\n            showHiddenFields,\n            siblingDoc: row || {},\n            triggerAccessControl,\n            triggerHooks,\n          })\n        })\n      } else if (!shouldHoistLocalizedValue && typeof rows === 'object' && rows !== null) {\n        Object.values(rows).forEach((localeRows) => {\n          if (Array.isArray(localeRows)) {\n            localeRows.forEach((row, rowIndex) => {\n              traverseFields({\n                blockData,\n                collection,\n                context,\n                currentDepth,\n                depth,\n                doc,\n                draft,\n                fallbackLocale,\n                fieldPromises,\n                fields: field.fields,\n                findMany,\n                flattenLocales,\n                global,\n                locale,\n                overrideAccess,\n                parentIndexPath: '',\n                parentIsLocalized: parentIsLocalized || field.localized,\n                parentPath: path + '.' + rowIndex,\n                parentSchemaPath: schemaPath,\n                populate,\n                populationPromises,\n                req,\n                showHiddenFields,\n                siblingDoc: (row as JsonObject) || {},\n                triggerAccessControl,\n                triggerHooks,\n              })\n            })\n          }\n        })\n      } else if (shouldHoistLocalizedValue && (!rows || rows.length === 0)) {\n        siblingDoc[field.name] = null\n      } else if (field.hidden !== true || showHiddenFields === true) {\n        siblingDoc[field.name] = []\n      }\n      break\n    }\n\n    case 'blocks': {\n      const rows = siblingDoc[field.name]\n\n      if (Array.isArray(rows) && rows.length > 0) {\n        rows.forEach((row, rowIndex) => {\n          const blockTypeToMatch = (row as JsonObject).blockType\n\n          const block: Block | undefined =\n            req.payload.blocks[blockTypeToMatch] ??\n            ((field.blockReferences ?? field.blocks).find(\n              (curBlock) => typeof curBlock !== 'string' && curBlock.slug === blockTypeToMatch,\n            ) as Block | undefined)\n\n          const { blockSelect, blockSelectMode } = getBlockSelect({\n            block: block!,\n            // TODO: fix this\n            // eslint-disable-next-line @typescript-eslint/no-non-null-asserted-optional-chain\n            select: select?.[field.name]!,\n            selectMode: selectMode!,\n          })\n\n          if (block) {\n            traverseFields({\n              blockData: row,\n              collection,\n              context,\n              currentDepth,\n              depth,\n              doc,\n              draft,\n              fallbackLocale,\n              fieldPromises,\n              fields: block.fields,\n              findMany,\n              flattenLocales,\n              global,\n              locale,\n              overrideAccess,\n              parentIndexPath: '',\n              parentIsLocalized: parentIsLocalized || field.localized,\n              parentPath: path + '.' + rowIndex,\n              parentSchemaPath: schemaPath + '.' + block.slug,\n              populate,\n              populationPromises,\n              req,\n              select: typeof blockSelect === 'object' ? blockSelect : undefined,\n              selectMode: blockSelectMode,\n              showHiddenFields,\n              siblingDoc: (row as JsonObject) || {},\n              triggerAccessControl,\n              triggerHooks,\n            })\n          }\n        })\n      } else if (!shouldHoistLocalizedValue && typeof rows === 'object' && rows !== null) {\n        Object.values(rows).forEach((localeRows) => {\n          if (Array.isArray(localeRows)) {\n            localeRows.forEach((row, rowIndex) => {\n              const blockTypeToMatch = row.blockType\n\n              const block: Block | undefined =\n                req.payload.blocks[blockTypeToMatch] ??\n                ((field.blockReferences ?? field.blocks).find(\n                  (curBlock) => typeof curBlock !== 'string' && curBlock.slug === blockTypeToMatch,\n                ) as Block | undefined)\n\n              if (block) {\n                traverseFields({\n                  blockData: row,\n                  collection,\n                  context,\n                  currentDepth,\n                  depth,\n                  doc,\n                  draft,\n                  fallbackLocale,\n                  fieldPromises,\n                  fields: block.fields,\n                  findMany,\n                  flattenLocales,\n                  global,\n                  locale,\n                  overrideAccess,\n                  parentIndexPath: '',\n                  parentIsLocalized: parentIsLocalized || field.localized,\n                  parentPath: path + '.' + rowIndex,\n                  parentSchemaPath: schemaPath + '.' + block.slug,\n                  populate,\n                  populationPromises,\n                  req,\n                  showHiddenFields,\n                  siblingDoc: (row as JsonObject) || {},\n                  triggerAccessControl,\n                  triggerHooks,\n                })\n              }\n            })\n          }\n        })\n      } else if (shouldHoistLocalizedValue && (!rows || rows.length === 0)) {\n        siblingDoc[field.name] = null\n      } else if (field.hidden !== true || showHiddenFields === true) {\n        siblingDoc[field.name] = []\n      }\n\n      break\n    }\n\n    case 'collapsible':\n    case 'row': {\n      traverseFields({\n        blockData,\n        collection,\n        context,\n        currentDepth,\n        depth,\n        doc,\n        draft,\n        fallbackLocale,\n        fieldPromises,\n        fields: field.fields,\n        findMany,\n        flattenLocales,\n        global,\n        locale,\n        overrideAccess,\n        parentIndexPath: indexPath,\n        parentIsLocalized,\n        parentPath,\n        parentSchemaPath: schemaPath,\n        populate,\n        populationPromises,\n        req,\n        select,\n        selectMode,\n        showHiddenFields,\n        siblingDoc,\n        triggerAccessControl,\n        triggerHooks,\n      })\n\n      break\n    }\n\n    case 'group': {\n      if (fieldAffectsDataResult) {\n        let groupDoc = siblingDoc[field.name] as JsonObject\n\n        if (typeof siblingDoc[field.name] !== 'object') {\n          groupDoc = {}\n        }\n\n        const groupSelect = select?.[field.name]\n\n        traverseFields({\n          blockData,\n          collection,\n          context,\n          currentDepth,\n          depth,\n          doc,\n          draft,\n          fallbackLocale,\n          fieldPromises,\n          fields: field.fields,\n          findMany,\n          flattenLocales,\n          global,\n          locale,\n          overrideAccess,\n          parentIndexPath: '',\n          parentIsLocalized: parentIsLocalized || field.localized,\n          parentPath: path,\n          parentSchemaPath: schemaPath,\n          populate,\n          populationPromises,\n          req,\n          select: typeof groupSelect === 'object' ? groupSelect : undefined,\n          selectMode,\n          showHiddenFields,\n          siblingDoc: groupDoc,\n          triggerAccessControl,\n          triggerHooks,\n        })\n      } else {\n        traverseFields({\n          blockData,\n          collection,\n          context,\n          currentDepth,\n          depth,\n          doc,\n          draft,\n          fallbackLocale,\n          fieldPromises,\n          fields: field.fields,\n          findMany,\n          flattenLocales,\n          global,\n          locale,\n          overrideAccess,\n          parentIndexPath: indexPath,\n          parentIsLocalized,\n          parentPath,\n          parentSchemaPath: schemaPath,\n          populate,\n          populationPromises,\n          req,\n          select,\n          selectMode,\n          showHiddenFields,\n          siblingDoc,\n          triggerAccessControl,\n          triggerHooks,\n        })\n      }\n\n      break\n    }\n\n    case 'richText': {\n      if (!field?.editor) {\n        throw new MissingEditorProp(field) // while we allow disabling editor functionality, you should not have any richText fields defined if you do not have an editor\n      }\n\n      if (typeof field?.editor === 'function') {\n        throw new Error('Attempted to access unsanitized rich text editor.')\n      }\n\n      const editor: RichTextAdapter = field?.editor\n\n      if (editor?.hooks?.afterRead?.length) {\n        for (const hook of editor.hooks.afterRead) {\n          if (shouldRunHookOnAllLocales) {\n            const localesAndValues = Object.entries(siblingDoc[field.name])\n\n            await Promise.all(\n              localesAndValues.map(async ([locale, value]) => {\n                const hookedValue = await hook({\n                  collection,\n                  context,\n                  currentDepth,\n                  data: doc,\n                  depth,\n                  draft,\n                  fallbackLocale: fallbackLocale!,\n                  field,\n                  fieldPromises,\n                  findMany,\n                  flattenLocales,\n                  global,\n                  indexPath: indexPathSegments,\n                  locale,\n                  operation: 'read',\n                  originalDoc: doc,\n                  overrideAccess,\n                  parentIsLocalized: parentIsLocalized!,\n                  path: pathSegments,\n                  populate,\n                  populationPromises,\n                  req,\n                  schemaPath: schemaPathSegments,\n                  showHiddenFields,\n                  siblingData: siblingDoc,\n                  triggerAccessControl,\n                  triggerHooks,\n                  value,\n                })\n\n                if (hookedValue !== undefined) {\n                  siblingDoc[field.name][locale] = hookedValue\n                }\n              }),\n            )\n          } else {\n            const hookedValue = await hook({\n              collection,\n              context,\n              currentDepth,\n              data: doc,\n              depth,\n              draft,\n              fallbackLocale: fallbackLocale!,\n              field,\n              fieldPromises,\n              findMany,\n              flattenLocales,\n              global,\n              indexPath: indexPathSegments,\n              locale: locale!,\n              operation: 'read',\n              originalDoc: doc,\n              overrideAccess,\n              parentIsLocalized: parentIsLocalized!,\n              path: pathSegments,\n              populate,\n              populationPromises,\n              req,\n              schemaPath: schemaPathSegments,\n              showHiddenFields,\n              siblingData: siblingDoc,\n              triggerAccessControl,\n              triggerHooks,\n              value: siblingDoc[field.name],\n            })\n\n            if (hookedValue !== undefined) {\n              siblingDoc[field.name] = hookedValue\n            }\n          }\n        }\n      }\n      break\n    }\n\n    case 'tab': {\n      let tabDoc = siblingDoc\n      let tabSelect: SelectType | undefined\n\n      const isNamedTab = tabHasName(field)\n\n      if (isNamedTab) {\n        tabDoc = siblingDoc[field.name] as JsonObject\n\n        if (typeof siblingDoc[field.name] !== 'object') {\n          tabDoc = {}\n        }\n\n        if (typeof select?.[field.name] === 'object') {\n          tabSelect = select?.[field.name] as SelectType\n        }\n      } else {\n        tabSelect = select\n      }\n\n      traverseFields({\n        blockData,\n        collection,\n        context,\n        currentDepth,\n        depth,\n        doc,\n        draft,\n        fallbackLocale,\n        fieldPromises,\n        fields: field.fields,\n        findMany,\n        flattenLocales,\n        global,\n        locale,\n        overrideAccess,\n        parentIndexPath: isNamedTab ? '' : indexPath,\n        parentIsLocalized: parentIsLocalized || field.localized,\n        parentPath: isNamedTab ? path : parentPath,\n        parentSchemaPath: schemaPath,\n        populate,\n        populationPromises,\n        req,\n        select: tabSelect,\n        selectMode,\n        showHiddenFields,\n        siblingDoc: tabDoc,\n        triggerAccessControl,\n        triggerHooks,\n      })\n\n      break\n    }\n\n    case 'tabs': {\n      traverseFields({\n        blockData,\n        collection,\n        context,\n        currentDepth,\n        depth,\n        doc,\n        draft,\n        fallbackLocale,\n        fieldPromises,\n        fields: field.tabs.map((tab) => ({ ...tab, type: 'tab' })),\n        findMany,\n        flattenLocales,\n        global,\n        locale,\n        overrideAccess,\n        parentIndexPath: indexPath,\n        parentIsLocalized,\n        parentPath: path,\n        parentSchemaPath: schemaPath,\n        populate,\n        populationPromises,\n        req,\n        select,\n        selectMode,\n        showHiddenFields,\n        siblingDoc,\n        triggerAccessControl,\n        triggerHooks,\n      })\n\n      break\n    }\n    default: {\n      break\n    }\n  }\n}\n"],"names":["MissingEditorProp","getBlockSelect","stripUnselectedFields","fieldAffectsData","fieldShouldBeLocalized","tabHasName","getDefaultValue","getFieldPathsModified","getFieldPaths","relationshipPopulationPromise","traverseFields","virtualFieldPopulationPromise","promise","blockData","collection","context","currentDepth","depth","doc","draft","fallbackLocale","field","fieldIndex","fieldPromises","findMany","flattenLocales","global","locale","overrideAccess","parentIndexPath","parentIsLocalized","parentPath","parentSchemaPath","populate","populationPromises","req","select","selectMode","showHiddenFields","siblingDoc","siblingFields","triggerAccessControl","triggerHooks","indexPath","path","schemaPath","index","fieldAffectsDataResult","pathSegments","split","schemaPathSegments","indexPathSegments","filter","Boolean","map","Number","removedFieldValue","hidden","name","shouldContinue","shouldHoistLocalizedValue","payload","config","localization","value","hoistedValue","fallbackValue","isNullOrUndefined","Array","isArray","val","undefined","type","pointDoc","coordinates","length","editor","Error","tabs","forEach","tab","shouldRunHookOnAllLocales","hooks","afterRead","hook","localesAndValues","Object","entries","Promise","all","localeKey","hookedValue","data","operation","originalDoc","siblingData","virtual","push","fields","flattenedFields","ref","segments","allowDefaultValue","access","read","canReadField","id","defaultValue","user","rows","arraySelect","row","rowIndex","localized","values","localeRows","blockTypeToMatch","blockType","block","blocks","blockReferences","find","curBlock","slug","blockSelect","blockSelectMode","groupDoc","groupSelect","tabDoc","tabSelect","isNamedTab"],"mappings":"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"}