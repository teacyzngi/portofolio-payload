{"version":3,"sources":["../../../src/auth/endpoints/resetPassword.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { generatePayloadCookie } from '../cookies.js'\nimport { resetPasswordOperation } from '../operations/resetPassword.js'\n\nexport const resetPasswordHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n  const { searchParams, t } = req\n  const depth = searchParams.get('depth')\n\n  const result = await resetPasswordOperation({\n    collection,\n    data: {\n      password: typeof req.data?.password === 'string' ? req.data.password : '',\n      token: typeof req.data?.token === 'string' ? req.data.token : '',\n    },\n    depth: depth ? Number(depth) : undefined,\n    req,\n  })\n\n  const cookie = generatePayloadCookie({\n    collectionAuthConfig: collection.config.auth,\n    cookiePrefix: req.payload.config.cookiePrefix,\n    token: result.token!,\n  })\n\n  if (collection.config.auth.removeTokenFromResponses) {\n    delete result.token\n  }\n\n  return Response.json(\n    {\n      message: t('authentication:passwordResetSuccessfully'),\n      ...result,\n    },\n    {\n      headers: headersWithCors({\n        headers: new Headers({\n          'Set-Cookie': cookie,\n        }),\n        req,\n      }),\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["status","httpStatus","getRequestCollection","headersWithCors","generatePayloadCookie","resetPasswordOperation","resetPasswordHandler","req","collection","searchParams","t","depth","get","result","data","password","token","Number","undefined","cookie","collectionAuthConfig","config","auth","cookiePrefix","payload","removeTokenFromResponses","Response","json","message","headers","Headers","OK"],"mappings":"AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,qBAAqB,QAAQ,gBAAe;AACrD,SAASC,sBAAsB,QAAQ,iCAAgC;AAEvE,OAAO,MAAMC,uBAAuC,OAAOC;IACzD,MAAMC,aAAaN,qBAAqBK;IACxC,MAAM,EAAEE,YAAY,EAAEC,CAAC,EAAE,GAAGH;IAC5B,MAAMI,QAAQF,aAAaG,GAAG,CAAC;IAE/B,MAAMC,SAAS,MAAMR,uBAAuB;QAC1CG;QACAM,MAAM;YACJC,UAAU,OAAOR,IAAIO,IAAI,EAAEC,aAAa,WAAWR,IAAIO,IAAI,CAACC,QAAQ,GAAG;YACvEC,OAAO,OAAOT,IAAIO,IAAI,EAAEE,UAAU,WAAWT,IAAIO,IAAI,CAACE,KAAK,GAAG;QAChE;QACAL,OAAOA,QAAQM,OAAON,SAASO;QAC/BX;IACF;IAEA,MAAMY,SAASf,sBAAsB;QACnCgB,sBAAsBZ,WAAWa,MAAM,CAACC,IAAI;QAC5CC,cAAchB,IAAIiB,OAAO,CAACH,MAAM,CAACE,YAAY;QAC7CP,OAAOH,OAAOG,KAAK;IACrB;IAEA,IAAIR,WAAWa,MAAM,CAACC,IAAI,CAACG,wBAAwB,EAAE;QACnD,OAAOZ,OAAOG,KAAK;IACrB;IAEA,OAAOU,SAASC,IAAI,CAClB;QACEC,SAASlB,EAAE;QACX,GAAGG,MAAM;IACX,GACA;QACEgB,SAAS1B,gBAAgB;YACvB0B,SAAS,IAAIC,QAAQ;gBACnB,cAAcX;YAChB;YACAZ;QACF;QACAP,QAAQC,WAAW8B,EAAE;IACvB;AAEJ,EAAC"}