{"version":3,"sources":["../../../src/auth/endpoints/logout.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { generateExpiredPayloadCookie } from '../cookies.js'\nimport { logoutOperation } from '../operations/logout.js'\n\nexport const logoutHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n  const { searchParams, t } = req\n\n  const result = await logoutOperation({\n    allSessions: searchParams.get('allSessions') === 'true',\n    collection,\n    req,\n  })\n\n  const headers = headersWithCors({\n    headers: new Headers(),\n    req,\n  })\n\n  if (!result) {\n    return Response.json(\n      {\n        message: t('error:logoutFailed'),\n      },\n      {\n        headers,\n        status: httpStatus.BAD_REQUEST,\n      },\n    )\n  }\n\n  const expiredCookie = generateExpiredPayloadCookie({\n    collectionAuthConfig: collection.config.auth,\n    config: req.payload.config,\n    cookiePrefix: req.payload.config.cookiePrefix,\n  })\n\n  headers.set('Set-Cookie', expiredCookie)\n\n  return Response.json(\n    {\n      message: t('authentication:logoutSuccessful'),\n    },\n    {\n      headers,\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["status","httpStatus","getRequestCollection","headersWithCors","generateExpiredPayloadCookie","logoutOperation","logoutHandler","req","collection","searchParams","t","result","allSessions","get","headers","Headers","Response","json","message","BAD_REQUEST","expiredCookie","collectionAuthConfig","config","auth","payload","cookiePrefix","set","OK"],"mappings":"AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,4BAA4B,QAAQ,gBAAe;AAC5D,SAASC,eAAe,QAAQ,0BAAyB;AAEzD,OAAO,MAAMC,gBAAgC,OAAOC;IAClD,MAAMC,aAAaN,qBAAqBK;IACxC,MAAM,EAAEE,YAAY,EAAEC,CAAC,EAAE,GAAGH;IAE5B,MAAMI,SAAS,MAAMN,gBAAgB;QACnCO,aAAaH,aAAaI,GAAG,CAAC,mBAAmB;QACjDL;QACAD;IACF;IAEA,MAAMO,UAAUX,gBAAgB;QAC9BW,SAAS,IAAIC;QACbR;IACF;IAEA,IAAI,CAACI,QAAQ;QACX,OAAOK,SAASC,IAAI,CAClB;YACEC,SAASR,EAAE;QACb,GACA;YACEI;YACAd,QAAQC,WAAWkB,WAAW;QAChC;IAEJ;IAEA,MAAMC,gBAAgBhB,6BAA6B;QACjDiB,sBAAsBb,WAAWc,MAAM,CAACC,IAAI;QAC5CD,QAAQf,IAAIiB,OAAO,CAACF,MAAM;QAC1BG,cAAclB,IAAIiB,OAAO,CAACF,MAAM,CAACG,YAAY;IAC/C;IAEAX,QAAQY,GAAG,CAAC,cAAcN;IAE1B,OAAOJ,SAASC,IAAI,CAClB;QACEC,SAASR,EAAE;IACb,GACA;QACEI;QACAd,QAAQC,WAAW0B,EAAE;IACvB;AAEJ,EAAC"}