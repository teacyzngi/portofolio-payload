{"version":3,"sources":["../../src/config/find.ts"],"sourcesContent":["import { getTsconfig } from 'get-tsconfig'\nimport path from 'path'\n\nimport { findUpSync } from '../utilities/findUp.js'\n\n/**\n * List of all filenames to detect as a Payload configuration file.\n */\nexport const payloadConfigFileNames = ['payload.config.js', 'payload.config.ts']\n\n/**\n * Returns the source and output paths from the nearest tsconfig.json file.\n * If no tsconfig.json file is found, returns the current working directory.\n * @returns An object containing the source and output paths.\n */\nconst getTSConfigPaths = (): {\n  configPath?: string\n  outPath?: string\n  rootPath?: string\n  srcPath?: string\n  tsConfigPath?: string\n} => {\n  const tsConfigResult = getTsconfig()!\n  const tsConfig = tsConfigResult.config\n  const tsConfigDir = path.dirname(tsConfigResult.path)\n\n  try {\n    const rootConfigDir = path.resolve(tsConfigDir, tsConfig.compilerOptions!.baseUrl || '')\n    const srcPath = tsConfig.compilerOptions?.rootDir || path.resolve(process.cwd(), 'src')\n    const outPath = tsConfig.compilerOptions?.outDir || path.resolve(process.cwd(), 'dist')\n    let configPath = tsConfig.compilerOptions?.paths?.['@payload-config']?.[0]\n\n    if (configPath) {\n      configPath = path.resolve(rootConfigDir, configPath)\n    }\n    return {\n      configPath,\n      outPath,\n      rootPath: rootConfigDir,\n      srcPath,\n      tsConfigPath: tsConfigResult.path,\n    }\n  } catch (error) {\n    console.error(`Error parsing tsconfig.json: ${error}`) // Do not throw the error, as we can still continue with the other config path finding methods\n    return {\n      rootPath: process.cwd(),\n    }\n  }\n}\n\n/**\n * Searches for a Payload configuration file.\n * @returns The absolute path to the Payload configuration file.\n * @throws An error if no configuration file is found.\n */\nexport const findConfig = (): string => {\n  // If the developer has specified a config path,\n  // format it if relative and use it directly if absolute\n  if (process.env.PAYLOAD_CONFIG_PATH) {\n    if (path.isAbsolute(process.env.PAYLOAD_CONFIG_PATH)) {\n      return process.env.PAYLOAD_CONFIG_PATH\n    }\n\n    return path.resolve(process.cwd(), process.env.PAYLOAD_CONFIG_PATH)\n  }\n\n  const { configPath, outPath, rootPath, srcPath } = getTSConfigPaths()\n\n  // if configPath is absolute file, not folder, return it\n  if (configPath && (path.extname(configPath) === '.js' || path.extname(configPath) === '.ts')) {\n    return configPath\n  }\n\n  const searchPaths =\n    process.env.NODE_ENV === 'production'\n      ? [configPath, outPath, srcPath, rootPath]\n      : [configPath, srcPath, rootPath]\n\n  for (const searchPath of searchPaths) {\n    if (!searchPath) {\n      continue\n    }\n\n    const configPath = findUpSync({\n      dir: searchPath,\n      fileNames: payloadConfigFileNames,\n    })\n\n    if (configPath) {\n      return configPath\n    }\n  }\n\n  // If no config file is found in the directories defined by tsconfig.json,\n  // try searching in the 'src' and 'dist' directory as a last resort, as they are most commonly used\n  if (process.env.NODE_ENV === 'production') {\n    const distConfigPath = findUpSync({\n      dir: path.resolve(process.cwd(), 'dist'),\n      fileNames: ['payload.config.js'],\n    })\n\n    if (distConfigPath) {\n      return distConfigPath\n    }\n  } else {\n    const srcConfigPath = findUpSync({\n      dir: path.resolve(process.cwd(), 'src'),\n      fileNames: payloadConfigFileNames,\n    })\n\n    if (srcConfigPath) {\n      return srcConfigPath\n    }\n  }\n\n  throw new Error(\n    'Error: cannot find Payload config. Please create a configuration file located at the root of your current working directory called \"payload.config.js\" or \"payload.config.ts\".',\n  )\n}\n"],"names":["getTsconfig","path","findUpSync","payloadConfigFileNames","getTSConfigPaths","tsConfigResult","tsConfig","config","tsConfigDir","dirname","rootConfigDir","resolve","compilerOptions","baseUrl","srcPath","rootDir","process","cwd","outPath","outDir","configPath","paths","rootPath","tsConfigPath","error","console","findConfig","env","PAYLOAD_CONFIG_PATH","isAbsolute","extname","searchPaths","NODE_ENV","searchPath","dir","fileNames","distConfigPath","srcConfigPath","Error"],"mappings":"AAAA,SAASA,WAAW,QAAQ,eAAc;AAC1C,OAAOC,UAAU,OAAM;AAEvB,SAASC,UAAU,QAAQ,yBAAwB;AAEnD;;CAEC,GACD,OAAO,MAAMC,yBAAyB;IAAC;IAAqB;CAAoB,CAAA;AAEhF;;;;CAIC,GACD,MAAMC,mBAAmB;IAOvB,MAAMC,iBAAiBL;IACvB,MAAMM,WAAWD,eAAeE,MAAM;IACtC,MAAMC,cAAcP,KAAKQ,OAAO,CAACJ,eAAeJ,IAAI;IAEpD,IAAI;QACF,MAAMS,gBAAgBT,KAAKU,OAAO,CAACH,aAAaF,SAASM,eAAe,CAAEC,OAAO,IAAI;QACrF,MAAMC,UAAUR,SAASM,eAAe,EAAEG,WAAWd,KAAKU,OAAO,CAACK,QAAQC,GAAG,IAAI;QACjF,MAAMC,UAAUZ,SAASM,eAAe,EAAEO,UAAUlB,KAAKU,OAAO,CAACK,QAAQC,GAAG,IAAI;QAChF,IAAIG,aAAad,SAASM,eAAe,EAAES,OAAO,CAAC,kBAAkB,EAAE,CAAC,EAAE;QAE1E,IAAID,YAAY;YACdA,aAAanB,KAAKU,OAAO,CAACD,eAAeU;QAC3C;QACA,OAAO;YACLA;YACAF;YACAI,UAAUZ;YACVI;YACAS,cAAclB,eAAeJ,IAAI;QACnC;IACF,EAAE,OAAOuB,OAAO;QACdC,QAAQD,KAAK,CAAC,CAAC,6BAA6B,EAAEA,OAAO,EAAE,8FAA8F;;QACrJ,OAAO;YACLF,UAAUN,QAAQC,GAAG;QACvB;IACF;AACF;AAEA;;;;CAIC,GACD,OAAO,MAAMS,aAAa;IACxB,gDAAgD;IAChD,wDAAwD;IACxD,IAAIV,QAAQW,GAAG,CAACC,mBAAmB,EAAE;QACnC,IAAI3B,KAAK4B,UAAU,CAACb,QAAQW,GAAG,CAACC,mBAAmB,GAAG;YACpD,OAAOZ,QAAQW,GAAG,CAACC,mBAAmB;QACxC;QAEA,OAAO3B,KAAKU,OAAO,CAACK,QAAQC,GAAG,IAAID,QAAQW,GAAG,CAACC,mBAAmB;IACpE;IAEA,MAAM,EAAER,UAAU,EAAEF,OAAO,EAAEI,QAAQ,EAAER,OAAO,EAAE,GAAGV;IAEnD,wDAAwD;IACxD,IAAIgB,cAAenB,CAAAA,KAAK6B,OAAO,CAACV,gBAAgB,SAASnB,KAAK6B,OAAO,CAACV,gBAAgB,KAAI,GAAI;QAC5F,OAAOA;IACT;IAEA,MAAMW,cACJf,QAAQW,GAAG,CAACK,QAAQ,KAAK,eACrB;QAACZ;QAAYF;QAASJ;QAASQ;KAAS,GACxC;QAACF;QAAYN;QAASQ;KAAS;IAErC,KAAK,MAAMW,cAAcF,YAAa;QACpC,IAAI,CAACE,YAAY;YACf;QACF;QAEA,MAAMb,aAAalB,WAAW;YAC5BgC,KAAKD;YACLE,WAAWhC;QACb;QAEA,IAAIiB,YAAY;YACd,OAAOA;QACT;IACF;IAEA,0EAA0E;IAC1E,mGAAmG;IACnG,IAAIJ,QAAQW,GAAG,CAACK,QAAQ,KAAK,cAAc;QACzC,MAAMI,iBAAiBlC,WAAW;YAChCgC,KAAKjC,KAAKU,OAAO,CAACK,QAAQC,GAAG,IAAI;YACjCkB,WAAW;gBAAC;aAAoB;QAClC;QAEA,IAAIC,gBAAgB;YAClB,OAAOA;QACT;IACF,OAAO;QACL,MAAMC,gBAAgBnC,WAAW;YAC/BgC,KAAKjC,KAAKU,OAAO,CAACK,QAAQC,GAAG,IAAI;YACjCkB,WAAWhC;QACb;QAEA,IAAIkC,eAAe;YACjB,OAAOA;QACT;IACF;IAEA,MAAM,IAAIC,MACR;AAEJ,EAAC"}