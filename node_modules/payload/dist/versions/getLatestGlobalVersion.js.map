{"version":3,"sources":["../../src/versions/getLatestGlobalVersion.ts"],"sourcesContent":["import type { SanitizedGlobalConfig } from '../globals/config/types.js'\nimport type { Document, Payload, PayloadRequest, Where } from '../types/index.js'\nimport type { TypeWithVersion } from './types.js'\n\ntype Args = {\n  config: SanitizedGlobalConfig\n  locale?: string\n  payload: Payload\n  published?: boolean\n  req?: PayloadRequest\n  slug: string\n  where: Where\n}\n\nexport const getLatestGlobalVersion = async ({\n  slug,\n  config,\n  locale,\n  payload,\n  published,\n  req,\n  where,\n}: Args): Promise<{ global: Document; globalExists: boolean }> => {\n  let latestVersion: TypeWithVersion<Document> | undefined\n\n  const whereQuery = published\n    ? { 'version._status': { equals: 'published' } }\n    : { latest: { equals: true } }\n\n  if (config.versions?.drafts) {\n    latestVersion = (\n      await payload.db.findGlobalVersions({\n        global: slug,\n        limit: 1,\n        locale,\n        pagination: false,\n        req,\n        where: whereQuery as unknown as Where,\n      })\n    ).docs[0]\n  }\n\n  const global = await payload.db.findGlobal({\n    slug,\n    locale,\n    req,\n    where,\n  })\n  const globalExists = Boolean(global)\n\n  if (!latestVersion) {\n    return {\n      global,\n      globalExists,\n    }\n  }\n\n  if (!latestVersion.version.createdAt) {\n    latestVersion.version.createdAt = latestVersion.createdAt\n  }\n\n  if (!latestVersion.version.updatedAt) {\n    latestVersion.version.updatedAt = latestVersion.updatedAt\n  }\n\n  return {\n    global: latestVersion.version,\n    globalExists,\n  }\n}\n"],"names":["getLatestGlobalVersion","slug","config","locale","payload","published","req","where","latestVersion","whereQuery","equals","latest","versions","drafts","db","findGlobalVersions","global","limit","pagination","docs","findGlobal","globalExists","Boolean","version","createdAt","updatedAt"],"mappings":"AAcA,OAAO,MAAMA,yBAAyB,OAAO,EAC3CC,IAAI,EACJC,MAAM,EACNC,MAAM,EACNC,OAAO,EACPC,SAAS,EACTC,GAAG,EACHC,KAAK,EACA;IACL,IAAIC;IAEJ,MAAMC,aAAaJ,YACf;QAAE,mBAAmB;YAAEK,QAAQ;QAAY;IAAE,IAC7C;QAAEC,QAAQ;YAAED,QAAQ;QAAK;IAAE;IAE/B,IAAIR,OAAOU,QAAQ,EAAEC,QAAQ;QAC3BL,gBAAgB,AACd,CAAA,MAAMJ,QAAQU,EAAE,CAACC,kBAAkB,CAAC;YAClCC,QAAQf;YACRgB,OAAO;YACPd;YACAe,YAAY;YACZZ;YACAC,OAAOE;QACT,EAAC,EACDU,IAAI,CAAC,EAAE;IACX;IAEA,MAAMH,SAAS,MAAMZ,QAAQU,EAAE,CAACM,UAAU,CAAC;QACzCnB;QACAE;QACAG;QACAC;IACF;IACA,MAAMc,eAAeC,QAAQN;IAE7B,IAAI,CAACR,eAAe;QAClB,OAAO;YACLQ;YACAK;QACF;IACF;IAEA,IAAI,CAACb,cAAce,OAAO,CAACC,SAAS,EAAE;QACpChB,cAAce,OAAO,CAACC,SAAS,GAAGhB,cAAcgB,SAAS;IAC3D;IAEA,IAAI,CAAChB,cAAce,OAAO,CAACE,SAAS,EAAE;QACpCjB,cAAce,OAAO,CAACE,SAAS,GAAGjB,cAAciB,SAAS;IAC3D;IAEA,OAAO;QACLT,QAAQR,cAAce,OAAO;QAC7BF;IACF;AACF,EAAC"}