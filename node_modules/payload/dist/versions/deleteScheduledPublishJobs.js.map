{"version":3,"sources":["../../src/versions/deleteScheduledPublishJobs.ts"],"sourcesContent":["import type { PayloadRequest } from '../types/index.js'\n\nimport { type Payload } from '../index.js'\nimport { jobsCollectionSlug } from '../queues/config/collection.js'\n\ntype Args = {\n  id?: number | string\n  payload: Payload\n  req?: PayloadRequest\n  slug: string\n}\n\nexport const deleteScheduledPublishJobs = async ({\n  id,\n  slug,\n  payload,\n  req,\n}: Args): Promise<void> => {\n  try {\n    await payload.db.deleteMany({\n      collection: jobsCollectionSlug,\n      req,\n      where: {\n        and: [\n          // only want to delete jobs have not run yet\n          {\n            completedAt: {\n              exists: false,\n            },\n          },\n          {\n            processing: {\n              equals: false,\n            },\n          },\n          {\n            'input.doc.value': {\n              equals: id,\n            },\n          },\n          {\n            'input.doc.relationTo': {\n              equals: slug,\n            },\n          },\n          // data.type narrows scheduled publish jobs in case of another job having input.doc.value\n          {\n            taskSlug: {\n              equals: 'schedulePublish',\n            },\n          },\n        ],\n      },\n    })\n  } catch (err) {\n    payload.logger.error({\n      err,\n      msg: `There was an error deleting scheduled publish jobs from the queue for ${slug} document with ID ${id}.`,\n    })\n  }\n}\n"],"names":["jobsCollectionSlug","deleteScheduledPublishJobs","id","slug","payload","req","db","deleteMany","collection","where","and","completedAt","exists","processing","equals","taskSlug","err","logger","error","msg"],"mappings":"AAGA,SAASA,kBAAkB,QAAQ,iCAAgC;AASnE,OAAO,MAAMC,6BAA6B,OAAO,EAC/CC,EAAE,EACFC,IAAI,EACJC,OAAO,EACPC,GAAG,EACE;IACL,IAAI;QACF,MAAMD,QAAQE,EAAE,CAACC,UAAU,CAAC;YAC1BC,YAAYR;YACZK;YACAI,OAAO;gBACLC,KAAK;oBACH,4CAA4C;oBAC5C;wBACEC,aAAa;4BACXC,QAAQ;wBACV;oBACF;oBACA;wBACEC,YAAY;4BACVC,QAAQ;wBACV;oBACF;oBACA;wBACE,mBAAmB;4BACjBA,QAAQZ;wBACV;oBACF;oBACA;wBACE,wBAAwB;4BACtBY,QAAQX;wBACV;oBACF;oBACA,yFAAyF;oBACzF;wBACEY,UAAU;4BACRD,QAAQ;wBACV;oBACF;iBACD;YACH;QACF;IACF,EAAE,OAAOE,KAAK;QACZZ,QAAQa,MAAM,CAACC,KAAK,CAAC;YACnBF;YACAG,KAAK,CAAC,sEAAsE,EAAEhB,KAAK,kBAAkB,EAAED,GAAG,CAAC,CAAC;QAC9G;IACF;AACF,EAAC"}