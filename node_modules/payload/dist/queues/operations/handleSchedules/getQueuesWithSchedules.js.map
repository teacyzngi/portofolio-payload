{"version":3,"sources":["../../../../src/queues/operations/handleSchedules/getQueuesWithSchedules.ts"],"sourcesContent":["import type { SanitizedJobsConfig, ScheduleConfig } from '../../config/types/index.js'\nimport type { TaskConfig } from '../../config/types/taskTypes.js'\nimport type { WorkflowConfig } from '../../config/types/workflowTypes.js'\n\ntype QueuesWithSchedules = {\n  [queue: string]: {\n    schedules: {\n      scheduleConfig: ScheduleConfig\n      taskConfig?: TaskConfig\n      workflowConfig?: WorkflowConfig\n    }[]\n  }\n}\n\nexport const getQueuesWithSchedules = ({\n  jobsConfig,\n}: {\n  jobsConfig: SanitizedJobsConfig\n}): QueuesWithSchedules => {\n  const tasksWithSchedules =\n    jobsConfig.tasks?.filter((task) => {\n      return task.schedule?.length\n    }) ?? []\n\n  const workflowsWithSchedules =\n    jobsConfig.workflows?.filter((workflow) => {\n      return workflow.schedule?.length\n    }) ?? []\n\n  const queuesWithSchedules: QueuesWithSchedules = {}\n\n  for (const task of tasksWithSchedules) {\n    for (const schedule of task.schedule ?? []) {\n      ;(queuesWithSchedules[schedule.queue] ??= { schedules: [] }).schedules.push({\n        scheduleConfig: schedule,\n        taskConfig: task,\n      })\n    }\n  }\n  for (const workflow of workflowsWithSchedules) {\n    for (const schedule of workflow.schedule ?? []) {\n      ;(queuesWithSchedules[schedule.queue] ??= { schedules: [] }).schedules.push({\n        scheduleConfig: schedule,\n        workflowConfig: workflow,\n      })\n    }\n  }\n\n  return queuesWithSchedules\n}\n"],"names":["getQueuesWithSchedules","jobsConfig","tasksWithSchedules","tasks","filter","task","schedule","length","workflowsWithSchedules","workflows","workflow","queuesWithSchedules","queue","schedules","push","scheduleConfig","taskConfig","workflowConfig"],"mappings":"AAcA,OAAO,MAAMA,yBAAyB,CAAC,EACrCC,UAAU,EAGX;IACC,MAAMC,qBACJD,WAAWE,KAAK,EAAEC,OAAO,CAACC;QACxB,OAAOA,KAAKC,QAAQ,EAAEC;IACxB,MAAM,EAAE;IAEV,MAAMC,yBACJP,WAAWQ,SAAS,EAAEL,OAAO,CAACM;QAC5B,OAAOA,SAASJ,QAAQ,EAAEC;IAC5B,MAAM,EAAE;IAEV,MAAMI,sBAA2C,CAAC;IAElD,KAAK,MAAMN,QAAQH,mBAAoB;QACrC,KAAK,MAAMI,YAAYD,KAAKC,QAAQ,IAAI,EAAE,CAAE;;YACxCK,CAAAA,mBAAmB,CAACL,SAASM,KAAK,CAAC,KAAK;gBAAEC,WAAW,EAAE;YAAC,CAAA,EAAGA,SAAS,CAACC,IAAI,CAAC;gBAC1EC,gBAAgBT;gBAChBU,YAAYX;YACd;QACF;IACF;IACA,KAAK,MAAMK,YAAYF,uBAAwB;QAC7C,KAAK,MAAMF,YAAYI,SAASJ,QAAQ,IAAI,EAAE,CAAE;;YAC5CK,CAAAA,mBAAmB,CAACL,SAASM,KAAK,CAAC,KAAK;gBAAEC,WAAW,EAAE;YAAC,CAAA,EAAGA,SAAS,CAACC,IAAI,CAAC;gBAC1EC,gBAAgBT;gBAChBW,gBAAgBP;YAClB;QACF;IACF;IAEA,OAAOC;AACT,EAAC"}