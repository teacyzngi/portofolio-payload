{"version":3,"sources":["../../../src/queues/errors/calculateBackoffWaitUntil.ts"],"sourcesContent":["import type { RetryConfig } from '../config/types/taskTypes.js'\n\nimport { getCurrentDate } from '../utilities/getCurrentDate.js'\n\nexport function calculateBackoffWaitUntil({\n  retriesConfig,\n  totalTried,\n}: {\n  retriesConfig: number | RetryConfig\n  totalTried: number\n}): Date {\n  let waitUntil: Date = getCurrentDate()\n  if (typeof retriesConfig === 'object') {\n    if (retriesConfig.backoff) {\n      if (retriesConfig.backoff.type === 'fixed') {\n        waitUntil = retriesConfig.backoff.delay\n          ? new Date(getCurrentDate().getTime() + retriesConfig.backoff.delay)\n          : getCurrentDate()\n      } else if (retriesConfig.backoff.type === 'exponential') {\n        // 2 ^ (attempts - 1) * delay (current attempt is not included in totalTried, thus no need for -1)\n        const delay = retriesConfig.backoff.delay ? retriesConfig.backoff.delay : 0\n        waitUntil = new Date(getCurrentDate().getTime() + Math.pow(2, totalTried) * delay)\n      }\n    }\n  }\n\n  /*\n  const differenceInMSBetweenNowAndWaitUntil = waitUntil.getTime() - getCurrentDate().getTime()\n\n  const differenceInSBetweenNowAndWaitUntil = differenceInMSBetweenNowAndWaitUntil / 1000\n  console.log('Calculated backoff', {\n    differenceInMSBetweenNowAndWaitUntil,\n    differenceInSBetweenNowAndWaitUntil,\n    retriesConfig,\n    totalTried,\n  })*/\n  return waitUntil\n}\n"],"names":["getCurrentDate","calculateBackoffWaitUntil","retriesConfig","totalTried","waitUntil","backoff","type","delay","Date","getTime","Math","pow"],"mappings":"AAEA,SAASA,cAAc,QAAQ,iCAAgC;AAE/D,OAAO,SAASC,0BAA0B,EACxCC,aAAa,EACbC,UAAU,EAIX;IACC,IAAIC,YAAkBJ;IACtB,IAAI,OAAOE,kBAAkB,UAAU;QACrC,IAAIA,cAAcG,OAAO,EAAE;YACzB,IAAIH,cAAcG,OAAO,CAACC,IAAI,KAAK,SAAS;gBAC1CF,YAAYF,cAAcG,OAAO,CAACE,KAAK,GACnC,IAAIC,KAAKR,iBAAiBS,OAAO,KAAKP,cAAcG,OAAO,CAACE,KAAK,IACjEP;YACN,OAAO,IAAIE,cAAcG,OAAO,CAACC,IAAI,KAAK,eAAe;gBACvD,kGAAkG;gBAClG,MAAMC,QAAQL,cAAcG,OAAO,CAACE,KAAK,GAAGL,cAAcG,OAAO,CAACE,KAAK,GAAG;gBAC1EH,YAAY,IAAII,KAAKR,iBAAiBS,OAAO,KAAKC,KAAKC,GAAG,CAAC,GAAGR,cAAcI;YAC9E;QACF;IACF;IAEA;;;;;;;;;IASE,GACF,OAAOH;AACT"}