{"version":3,"file":"Input.js","names":["dequal","formatAdminURL","wordBoundariesRegex","qs","React","useCallback","useEffect","useMemo","useReducer","useRef","useState","AddNewRelation","useDocumentDrawer","useListDrawer","ReactSelect","RenderCustomComponent","FieldDescription","FieldError","FieldLabel","useDebouncedCallback","useEffectEvent","useQueues","useAuth","useConfig","useLocale","useTranslation","sanitizeFilterOptionsQuery","fieldBaseClass","createRelationMap","findOptionsByValue","optionsReducer","MultiValueLabel","SingleValue","baseClass","RelationshipInput","props","AfterInput","allowCreate","allowEdit","appearance","BeforeInput","className","description","Description","Error","filterOptions","formatDisplayedOptions","hasMany","initialValue","isSortable","label","Label","localized","maxResultsPerRequest","onChange","path","placeholder","readOnly","relationTo","required","showError","sortOptions","style","value","config","getEntityConfig","routes","api","serverURL","i18n","t","permissions","code","locale","currentlyOpenRelationship","setCurrentlyOpenRelationship","id","undefined","collectionSlug","hasReadPermission","lastFullyLoadedRelation","setLastFullyLoadedRelation","lastLoadedPage","setLastLoadedPage","errorLoading","setErrorLoading","search","setSearch","isLoading","setIsLoading","enableWordBoundarySearch","setEnableWordBoundarySearch","menuIsOpen","setMenuIsOpen","hasLoadedFirstPageRef","queueTask","options","dispatchOptions","valueRef","DocumentDrawer","isDrawerOpen","openDrawer","listDrawerFilterOptions","newFilterOptions","valuesByRelation","reduce","acc","val","push","Array","isArray","forEach","relation","not_in","ListDrawer","closeDrawer","closeListDrawer","isListDrawerOpen","openListDrawer","collectionSlugs","onListSelect","doc","openDrawerWhenRelationChanges","updateResults","hasManyArg","lastFullyLoadedRelationArg","lastLoadedPageArg","onSuccess","searchArg","sort","valueArg","lastFullyLoadedRelationToUse","relations","relationsToFetch","slice","resultsFetched","relationMap","priorRelation","relationFilterOption","lastLoadedPageToUse","indexOf","Promise","resolve","collection","fieldToSearch","admin","useAsTitle","fieldToSort","defaultSort","query","depth","draft","limit","page","select","where","and","like","response","fetch","body","stringify","credentials","headers","language","method","ok","data","json","prevState","nextPage","docs","length","type","status","ids","updateSearch","updateResultsEffectEvent","handleInputChange","handleValueChange","Object","entries","idsToLoad","filter","find","optionGroup","option","fieldToSelect","in","onSave","args","collectionConfig","docID","currentValue","valuesToSet","map","slug","onDuplicate","concat","onDelete","filterOption","item","searchFilter","r","breakApartThreshold","labelString","String","indexOfSpace","test","onDocumentOpen","openInNewTab","docUrl","adminRoute","window","open","current","exemptValues","prevValue","isFirstRenderRef","isIdOnly","idOnly","valueToRender","_jsxs","Boolean","join","replace","_jsx","CustomComponent","Fallback","backspaceRemovesValue","components","DropdownIndicator","customProps","disableKeyDown","disableMouseDown","disabled","getOptionValue","isMulti","isSearchable","selected","onInputChange","newSearch","onMenuClose","onMenuOpen","onMenuScrollToBottom","enableRowSelections","onSelect"],"sources":["../../../src/fields/Relationship/Input.tsx"],"sourcesContent":["'use client'\nimport type { FilterOptionsResult, PaginatedDocs, ValueWithRelation, Where } from 'payload'\n\nimport { dequal } from 'dequal/lite'\nimport { formatAdminURL, wordBoundariesRegex } from 'payload/shared'\nimport * as qs from 'qs-esm'\nimport React, { useCallback, useEffect, useMemo, useReducer, useRef, useState } from 'react'\n\nimport type { DocumentDrawerProps } from '../../elements/DocumentDrawer/types.js'\nimport type { ListDrawerProps } from '../../elements/ListDrawer/types.js'\nimport type { ReactSelectAdapterProps } from '../../elements/ReactSelect/types.js'\nimport type { HasManyValueUnion, Option, RelationshipInputProps, UpdateResults } from './types.js'\n\nimport { AddNewRelation } from '../../elements/AddNewRelation/index.js'\nimport { useDocumentDrawer } from '../../elements/DocumentDrawer/index.js'\nimport { useListDrawer } from '../../elements/ListDrawer/index.js'\nimport { ReactSelect } from '../../elements/ReactSelect/index.js'\nimport { RenderCustomComponent } from '../../elements/RenderCustomComponent/index.js'\nimport { FieldDescription } from '../../fields/FieldDescription/index.js'\nimport { FieldError } from '../../fields/FieldError/index.js'\nimport { FieldLabel } from '../../fields/FieldLabel/index.js'\nimport { useDebouncedCallback } from '../../hooks/useDebouncedCallback.js'\nimport { useEffectEvent } from '../../hooks/useEffectEvent.js'\nimport { useQueues } from '../../hooks/useQueues.js'\nimport { useAuth } from '../../providers/Auth/index.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { useLocale } from '../../providers/Locale/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { sanitizeFilterOptionsQuery } from '../../utilities/sanitizeFilterOptionsQuery.js'\nimport { fieldBaseClass } from '../shared/index.js'\nimport { createRelationMap } from './createRelationMap.js'\nimport { findOptionsByValue } from './findOptionsByValue.js'\nimport { optionsReducer } from './optionsReducer.js'\nimport { MultiValueLabel } from './select-components/MultiValueLabel/index.js'\nimport './index.scss'\nimport { SingleValue } from './select-components/SingleValue/index.js'\n\nconst baseClass = 'relationship'\n\nexport const RelationshipInput: React.FC<RelationshipInputProps> = (props) => {\n  const {\n    AfterInput,\n    allowCreate = true,\n    allowEdit = true,\n    appearance = 'select',\n    BeforeInput,\n    className,\n    description,\n    Description,\n    Error,\n    filterOptions,\n    formatDisplayedOptions,\n    hasMany,\n    initialValue,\n    isSortable = true,\n    label,\n    Label,\n    localized,\n    maxResultsPerRequest = 10,\n    onChange,\n    path,\n    placeholder,\n    readOnly,\n    relationTo,\n    required,\n    showError,\n    sortOptions,\n    style,\n    value,\n  } = props\n\n  const { config, getEntityConfig } = useConfig()\n\n  const {\n    routes: { api },\n    serverURL,\n  } = config\n\n  const { i18n, t } = useTranslation()\n  const { permissions } = useAuth()\n  const { code: locale } = useLocale()\n\n  const [currentlyOpenRelationship, setCurrentlyOpenRelationship] = useState<\n    Parameters<ReactSelectAdapterProps['customProps']['onDocumentOpen']>[0]\n  >({\n    id: undefined,\n    collectionSlug: undefined,\n    hasReadPermission: false,\n  })\n\n  const [lastFullyLoadedRelation, setLastFullyLoadedRelation] = useState(-1)\n  const [lastLoadedPage, setLastLoadedPage] = useState<Record<string, number>>({})\n  const [errorLoading, setErrorLoading] = useState('')\n  const [search, setSearch] = useState('')\n  const [isLoading, setIsLoading] = useState(false)\n  const [enableWordBoundarySearch, setEnableWordBoundarySearch] = useState(false)\n  const [menuIsOpen, setMenuIsOpen] = useState(false)\n  const hasLoadedFirstPageRef = useRef(false)\n  const { queueTask } = useQueues()\n\n  const [options, dispatchOptions] = useReducer(optionsReducer, [])\n\n  const valueRef = useRef(value)\n\n  const [DocumentDrawer, , { isDrawerOpen, openDrawer }] = useDocumentDrawer({\n    id: currentlyOpenRelationship.id,\n    collectionSlug: currentlyOpenRelationship.collectionSlug,\n  })\n\n  // Filter selected values from displaying in the list drawer\n  const listDrawerFilterOptions = useMemo<FilterOptionsResult>(() => {\n    let newFilterOptions = filterOptions\n\n    if (value) {\n      const valuesByRelation = (hasMany === false ? [value] : value).reduce((acc, val) => {\n        if (!acc[val.relationTo]) {\n          acc[val.relationTo] = []\n        }\n        acc[val.relationTo].push(val.value)\n        return acc\n      }, {})\n\n      ;(Array.isArray(relationTo) ? relationTo : [relationTo]).forEach((relation) => {\n        newFilterOptions = {\n          ...(newFilterOptions || {}),\n          [relation]: {\n            ...(typeof filterOptions?.[relation] === 'object' ? filterOptions[relation] : {}),\n            ...(valuesByRelation[relation]\n              ? {\n                  id: {\n                    not_in: valuesByRelation[relation],\n                  },\n                }\n              : {}),\n          },\n        }\n      })\n    }\n\n    return newFilterOptions\n  }, [filterOptions, value, hasMany, relationTo])\n\n  const [\n    ListDrawer,\n    ,\n    { closeDrawer: closeListDrawer, isDrawerOpen: isListDrawerOpen, openDrawer: openListDrawer },\n  ] = useListDrawer({\n    collectionSlugs: relationTo,\n    filterOptions: listDrawerFilterOptions,\n  })\n\n  const onListSelect = useCallback<NonNullable<ListDrawerProps['onSelect']>>(\n    ({ collectionSlug, doc }) => {\n      if (hasMany) {\n        onChange([\n          ...(Array.isArray(value) ? value : []),\n          {\n            relationTo: collectionSlug,\n            value: doc.id,\n          },\n        ])\n      } else if (hasMany === false) {\n        onChange({\n          relationTo: collectionSlug,\n          value: doc.id,\n        })\n      }\n\n      closeListDrawer()\n    },\n    [hasMany, onChange, closeListDrawer, value],\n  )\n\n  const openDrawerWhenRelationChanges = useRef(false)\n\n  const updateResults: UpdateResults = useCallback(\n    ({\n      filterOptions,\n      hasMany: hasManyArg,\n      lastFullyLoadedRelation: lastFullyLoadedRelationArg,\n      lastLoadedPage: lastLoadedPageArg,\n      onSuccess,\n      search: searchArg,\n      sort,\n      value: valueArg,\n    }) => {\n      if (!permissions) {\n        return\n      }\n      queueTask(async () => {\n        const lastFullyLoadedRelationToUse =\n          typeof lastFullyLoadedRelationArg !== 'undefined' ? lastFullyLoadedRelationArg : -1\n\n        const relations = Array.isArray(relationTo) ? relationTo : [relationTo]\n        const relationsToFetch =\n          lastFullyLoadedRelationToUse === -1\n            ? relations\n            : relations.slice(lastFullyLoadedRelationToUse + 1)\n\n        let resultsFetched = 0\n        const relationMap = createRelationMap(\n          hasManyArg === true\n            ? {\n                hasMany: true,\n                relationTo,\n                value: valueArg,\n              }\n            : {\n                hasMany: false,\n                relationTo,\n                value: valueArg,\n              },\n        )\n\n        if (!errorLoading) {\n          await relationsToFetch.reduce(async (priorRelation, relation) => {\n            const relationFilterOption = filterOptions?.[relation]\n\n            let lastLoadedPageToUse\n            if (search !== searchArg) {\n              lastLoadedPageToUse = 1\n            } else {\n              lastLoadedPageToUse = lastLoadedPageArg[relation] + 1\n            }\n            await priorRelation\n\n            if (relationFilterOption === false) {\n              setLastFullyLoadedRelation(relations.indexOf(relation))\n              return Promise.resolve()\n            }\n\n            if (resultsFetched < 10) {\n              const collection = getEntityConfig({ collectionSlug: relation })\n              const fieldToSearch = collection?.admin?.useAsTitle || 'id'\n              let fieldToSort = collection?.defaultSort || 'id'\n              if (typeof sortOptions === 'string') {\n                fieldToSort = sortOptions\n              } else if (sortOptions?.[relation]) {\n                fieldToSort = sortOptions[relation]\n              }\n\n              const query: {\n                [key: string]: unknown\n                where: Where\n              } = {\n                depth: 0,\n                draft: true,\n                limit: maxResultsPerRequest,\n                locale,\n                page: lastLoadedPageToUse,\n                select: {\n                  [fieldToSearch]: true,\n                },\n                sort: fieldToSort,\n                where: {\n                  and: [\n                    {\n                      id: {\n                        not_in: relationMap[relation],\n                      },\n                    },\n                  ],\n                },\n              }\n\n              if (searchArg) {\n                query.where.and.push({\n                  [fieldToSearch]: {\n                    like: searchArg,\n                  },\n                })\n              }\n\n              if (relationFilterOption && typeof relationFilterOption !== 'boolean') {\n                query.where.and.push(relationFilterOption)\n              }\n\n              sanitizeFilterOptionsQuery(query.where)\n\n              const response = await fetch(`${serverURL}${api}/${relation}`, {\n                body: qs.stringify(query),\n                credentials: 'include',\n                headers: {\n                  'Accept-Language': i18n.language,\n                  'Content-Type': 'application/x-www-form-urlencoded',\n                  'X-Payload-HTTP-Method-Override': 'GET',\n                },\n                method: 'POST',\n              })\n\n              if (response.ok) {\n                const data: PaginatedDocs<unknown> = await response.json()\n                setLastLoadedPage((prevState) => {\n                  return {\n                    ...prevState,\n                    [relation]: lastLoadedPageToUse,\n                  }\n                })\n\n                if (!data.nextPage) {\n                  setLastFullyLoadedRelation(relations.indexOf(relation))\n                }\n\n                if (data.docs.length > 0) {\n                  resultsFetched += data.docs.length\n\n                  dispatchOptions({\n                    type: 'ADD',\n                    collection,\n                    config,\n                    docs: data.docs,\n                    i18n,\n                    sort,\n                  })\n                }\n              } else if (response.status === 403) {\n                setLastFullyLoadedRelation(relations.indexOf(relation))\n                dispatchOptions({\n                  type: 'ADD',\n                  collection,\n                  config,\n                  docs: [],\n                  i18n,\n                  ids: relationMap[relation],\n                  sort,\n                })\n              } else {\n                setErrorLoading(t('error:unspecific'))\n              }\n            }\n          }, Promise.resolve())\n\n          if (typeof onSuccess === 'function') {\n            onSuccess()\n          }\n        }\n      })\n    },\n    [\n      permissions,\n      queueTask,\n      relationTo,\n      errorLoading,\n      search,\n      getEntityConfig,\n      sortOptions,\n      maxResultsPerRequest,\n      locale,\n      serverURL,\n      api,\n      i18n,\n      config,\n      t,\n    ],\n  )\n\n  const updateSearch = useDebouncedCallback<{ search: string } & HasManyValueUnion>(\n    ({ hasMany: hasManyArg, search: searchArg, value }) => {\n      updateResultsEffectEvent({\n        filterOptions,\n        lastLoadedPage: {},\n        onSuccess: () => {\n          setIsLoading(false)\n        },\n        search: searchArg,\n        sort: true,\n        ...(hasManyArg === true\n          ? {\n              hasMany: hasManyArg,\n              value,\n            }\n          : {\n              hasMany: hasManyArg,\n              value,\n            }),\n      })\n      setSearch(searchArg)\n    },\n    300,\n  )\n\n  const handleInputChange = useCallback(\n    (options: { search: string } & HasManyValueUnion) => {\n      if (search !== options.search) {\n        setIsLoading(true)\n        setLastLoadedPage({})\n        updateSearch(options)\n      }\n    },\n    [search, updateSearch],\n  )\n\n  const handleValueChange = useEffectEvent(({ hasMany: hasManyArg, value }: HasManyValueUnion) => {\n    const relationMap = createRelationMap(\n      hasManyArg === true\n        ? {\n            hasMany: hasManyArg,\n            relationTo,\n            value,\n          }\n        : {\n            hasMany: hasManyArg,\n            relationTo,\n            value,\n          },\n    )\n\n    void Object.entries(relationMap).reduce(async (priorRelation, [relation, ids]) => {\n      await priorRelation\n\n      const idsToLoad = ids.filter((id) => {\n        return !options.find((optionGroup) =>\n          optionGroup?.options?.find(\n            (option) => option.value === id && option.relationTo === relation,\n          ),\n        )\n      })\n\n      if (idsToLoad.length > 0) {\n        const collection = getEntityConfig({ collectionSlug: relation })\n        const fieldToSelect = collection?.admin?.useAsTitle || 'id'\n\n        const query = {\n          depth: 0,\n          draft: true,\n          limit: idsToLoad.length,\n          locale,\n          select: {\n            [fieldToSelect]: true,\n          },\n          where: {\n            id: {\n              in: idsToLoad,\n            },\n          },\n        }\n\n        if (!errorLoading) {\n          const response = await fetch(`${serverURL}${api}/${relation}`, {\n            body: qs.stringify(query),\n            credentials: 'include',\n            headers: {\n              'Accept-Language': i18n.language,\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'X-Payload-HTTP-Method-Override': 'GET',\n            },\n            method: 'POST',\n          })\n          let docs = []\n\n          if (response.ok) {\n            const data = await response.json()\n            docs = data.docs\n          }\n\n          dispatchOptions({\n            type: 'ADD',\n            collection,\n            config,\n            docs,\n            i18n,\n            ids: idsToLoad,\n            sort: true,\n          })\n        }\n      }\n    }, Promise.resolve())\n  })\n\n  const onSave = useCallback<DocumentDrawerProps['onSave']>(\n    (args) => {\n      dispatchOptions({\n        type: 'UPDATE',\n        collection: args.collectionConfig,\n        config,\n        doc: args.doc,\n        i18n,\n      })\n\n      const docID = args.doc.id\n\n      if (hasMany) {\n        const currentValue = value ? (Array.isArray(value) ? value : [value]) : []\n\n        const valuesToSet = currentValue.map((option: ValueWithRelation) => {\n          return {\n            relationTo: option.value === docID ? args.collectionConfig.slug : option.relationTo,\n            value: option.value,\n          }\n        })\n\n        onChange(valuesToSet)\n      } else if (hasMany === false) {\n        onChange({ relationTo: args.collectionConfig.slug, value: docID })\n      }\n    },\n    [i18n, config, hasMany, onChange, value],\n  )\n\n  const onDuplicate = useCallback<DocumentDrawerProps['onDuplicate']>(\n    (args) => {\n      dispatchOptions({\n        type: 'ADD',\n        collection: args.collectionConfig,\n        config,\n        docs: [args.doc],\n        i18n,\n        sort: true,\n      })\n\n      if (hasMany) {\n        onChange(\n          value\n            ? value.concat({\n                relationTo: args.collectionConfig.slug,\n                value: args.doc.id,\n              })\n            : null,\n        )\n      } else if (hasMany === false) {\n        onChange({\n          relationTo: args.collectionConfig.slug,\n          value: args.doc.id,\n        })\n      }\n    },\n    [i18n, config, hasMany, onChange, value],\n  )\n\n  const onDelete = useCallback<DocumentDrawerProps['onDelete']>(\n    (args) => {\n      dispatchOptions({\n        id: args.id,\n        type: 'REMOVE',\n        collection: args.collectionConfig,\n        config,\n        i18n,\n      })\n\n      if (hasMany) {\n        onChange(\n          value\n            ? value.filter((option) => {\n                return option.value !== args.id\n              })\n            : null,\n        )\n      } else {\n        onChange(null)\n      }\n\n      return\n    },\n    [i18n, config, hasMany, onChange, value],\n  )\n\n  const filterOption = useCallback((item: Option, searchFilter: string) => {\n    if (!searchFilter) {\n      return true\n    }\n    const r = wordBoundariesRegex(searchFilter || '')\n    // breaking the labels to search into smaller parts increases performance\n    const breakApartThreshold = 250\n    let labelString = String(item.label)\n    // strings less than breakApartThreshold length won't be chunked\n    while (labelString.length > breakApartThreshold) {\n      // slicing by the next space after the length of the search input prevents slicing the string up by partial words\n      const indexOfSpace = labelString.indexOf(' ', searchFilter.length)\n      if (\n        r.test(labelString.slice(0, indexOfSpace === -1 ? searchFilter.length : indexOfSpace + 1))\n      ) {\n        return true\n      }\n      labelString = labelString.slice(indexOfSpace === -1 ? searchFilter.length : indexOfSpace + 1)\n    }\n    return r.test(labelString.slice(-breakApartThreshold))\n  }, [])\n\n  const onDocumentOpen = useCallback<ReactSelectAdapterProps['customProps']['onDocumentOpen']>(\n    ({ id, collectionSlug, hasReadPermission, openInNewTab }) => {\n      if (openInNewTab) {\n        if (hasReadPermission && id && collectionSlug) {\n          const docUrl = formatAdminURL({\n            adminRoute: config.routes.admin,\n            path: `/collections/${collectionSlug}/${id}`,\n          })\n\n          window.open(docUrl, '_blank')\n        }\n      } else {\n        openDrawerWhenRelationChanges.current = true\n\n        setCurrentlyOpenRelationship({\n          id,\n          collectionSlug,\n          hasReadPermission,\n        })\n      }\n    },\n    [config.routes.admin],\n  )\n\n  const updateResultsEffectEvent: UpdateResults = useEffectEvent((args) => {\n    return updateResults(args)\n  })\n\n  // When (`relationTo` || `filterOptions` || `locale`) changes, reset component\n  // Note - effect should not run on first run\n  useEffect(() => {\n    // If the menu is open while filterOptions changes\n    // due to latency of form state and fast clicking into this field,\n    // re-fetch options\n    if (hasLoadedFirstPageRef.current && menuIsOpen) {\n      setIsLoading(true)\n      void updateResultsEffectEvent({\n        filterOptions,\n        lastLoadedPage: {},\n        onSuccess: () => {\n          hasLoadedFirstPageRef.current = true\n          setIsLoading(false)\n        },\n        ...(hasMany === true\n          ? {\n              hasMany,\n              value: valueRef.current as ValueWithRelation[],\n            }\n          : {\n              hasMany,\n              value: valueRef.current as ValueWithRelation,\n            }),\n      })\n    }\n\n    // If the menu is not open, still reset the field state\n    // because we need to get new options next time the menu opens\n    dispatchOptions({\n      type: 'CLEAR',\n      exemptValues: valueRef.current,\n    })\n\n    setLastFullyLoadedRelation(-1)\n    setLastLoadedPage({})\n  }, [relationTo, filterOptions, locale, path, menuIsOpen, hasMany])\n\n  const prevValue = useRef(value)\n  const isFirstRenderRef = useRef(true)\n\n  // ///////////////////////////////////\n  // Ensure we have an option for each value\n  // ///////////////////////////////////\n  useEffect(() => {\n    if (isFirstRenderRef.current || !dequal(value, prevValue.current)) {\n      handleValueChange(hasMany === true ? { hasMany, value } : { hasMany, value })\n    }\n    isFirstRenderRef.current = false\n    prevValue.current = value\n  }, [value, hasMany])\n\n  // Determine if we should switch to word boundary search\n  useEffect(() => {\n    const relations = Array.isArray(relationTo) ? relationTo : [relationTo]\n    const isIdOnly = relations.reduce((idOnly, relation) => {\n      const collection = getEntityConfig({ collectionSlug: relation })\n      const fieldToSearch = collection?.admin?.useAsTitle || 'id'\n      return fieldToSearch === 'id' && idOnly\n    }, true)\n    setEnableWordBoundarySearch(!isIdOnly)\n  }, [relationTo, getEntityConfig])\n\n  useEffect(() => {\n    if (openDrawerWhenRelationChanges.current) {\n      openDrawer()\n      openDrawerWhenRelationChanges.current = false\n    }\n  }, [openDrawer, currentlyOpenRelationship])\n\n  useEffect(() => {\n    // needed to sync the ref value when other fields influence the value\n    // i.e. when a drawer is opened and the value is set\n    valueRef.current = value\n  }, [value])\n\n  const valueToRender = findOptionsByValue({ allowEdit, options, value })\n\n  if (!Array.isArray(valueToRender) && valueToRender?.value === 'null') {\n    valueToRender.value = null\n  }\n\n  return (\n    <div\n      className={[\n        fieldBaseClass,\n        baseClass,\n        className,\n        showError && 'error',\n        errorLoading && 'error-loading',\n        readOnly && `${baseClass}--read-only`,\n        !readOnly && allowCreate && `${baseClass}--allow-create`,\n      ]\n        .filter(Boolean)\n        .join(' ')}\n      id={`field-${path.replace(/\\./g, '__')}`}\n      style={style}\n    >\n      <RenderCustomComponent\n        CustomComponent={Label}\n        Fallback={\n          <FieldLabel label={label} localized={localized} path={path} required={required} />\n        }\n      />\n      <div className={`${fieldBaseClass}__wrap`}>\n        <RenderCustomComponent\n          CustomComponent={Error}\n          Fallback={<FieldError path={path} showError={showError} />}\n        />\n        {BeforeInput}\n        {errorLoading ? (\n          <div className={`${baseClass}__error-loading`}>{errorLoading}</div>\n        ) : (\n          <div className={`${baseClass}__wrap`}>\n            <ReactSelect\n              backspaceRemovesValue={!(isDrawerOpen || isListDrawerOpen)}\n              components={{\n                MultiValueLabel,\n                SingleValue,\n                ...(appearance !== 'select' && { DropdownIndicator: null }),\n              }}\n              customProps={{\n                disableKeyDown: isDrawerOpen || isListDrawerOpen,\n                disableMouseDown: isDrawerOpen || isListDrawerOpen,\n                onDocumentOpen,\n                onSave,\n              }}\n              disabled={readOnly || isDrawerOpen || isListDrawerOpen}\n              filterOption={enableWordBoundarySearch ? filterOption : undefined}\n              getOptionValue={(option: ValueWithRelation) => {\n                if (!option) {\n                  return undefined\n                }\n                return hasMany && Array.isArray(relationTo)\n                  ? `${option.relationTo}_${option.value}`\n                  : (option.value as string)\n              }}\n              isLoading={appearance === 'select' && isLoading}\n              isMulti={hasMany}\n              isSearchable={appearance === 'select'}\n              isSortable={isSortable}\n              menuIsOpen={appearance === 'select' ? menuIsOpen : false}\n              onChange={\n                !readOnly\n                  ? (selected) => {\n                      if (hasMany) {\n                        if (selected === null) {\n                          valueRef.current = []\n                          onChange([])\n                        } else {\n                          valueRef.current = selected as ValueWithRelation[]\n                          onChange(selected as ValueWithRelation[])\n                        }\n                      } else if (hasMany === false) {\n                        if (selected === null) {\n                          valueRef.current = null\n                          onChange(null)\n                        } else {\n                          valueRef.current = selected as ValueWithRelation\n                          onChange(selected as ValueWithRelation)\n                        }\n                      }\n                    }\n                  : undefined\n              }\n              onInputChange={(newSearch) =>\n                handleInputChange({\n                  search: newSearch,\n                  ...(hasMany === true\n                    ? {\n                        hasMany,\n                        value,\n                      }\n                    : {\n                        hasMany,\n                        value,\n                      }),\n                })\n              }\n              onMenuClose={() => {\n                setMenuIsOpen(false)\n              }}\n              onMenuOpen={() => {\n                if (appearance === 'drawer') {\n                  openListDrawer()\n                } else if (appearance === 'select') {\n                  setMenuIsOpen(true)\n                  if (!hasLoadedFirstPageRef.current) {\n                    setIsLoading(true)\n                    updateResultsEffectEvent({\n                      filterOptions,\n                      lastLoadedPage: {},\n                      onSuccess: () => {\n                        hasLoadedFirstPageRef.current = true\n                        setIsLoading(false)\n                      },\n                      ...(hasMany === true\n                        ? {\n                            hasMany,\n                            value,\n                          }\n                        : {\n                            hasMany,\n                            value,\n                          }),\n                    })\n                  }\n                }\n              }}\n              onMenuScrollToBottom={() => {\n                setIsLoading(true)\n                updateResultsEffectEvent({\n                  filterOptions,\n                  lastFullyLoadedRelation,\n                  lastLoadedPage,\n                  onSuccess: () => {\n                    setIsLoading(false)\n                  },\n                  search,\n                  sort: false,\n                  ...(hasMany === true\n                    ? {\n                        hasMany,\n                        value: initialValue,\n                      }\n                    : {\n                        hasMany,\n                        value: initialValue,\n                      }),\n                })\n              }}\n              options={\n                typeof formatDisplayedOptions === 'function'\n                  ? formatDisplayedOptions(options)\n                  : options\n              }\n              placeholder={placeholder}\n              showError={showError}\n              value={valueToRender ?? null}\n            />\n            {!readOnly && allowCreate && (\n              <AddNewRelation\n                path={path}\n                relationTo={relationTo}\n                {...(hasMany === true\n                  ? {\n                      hasMany,\n                      onChange,\n                      value,\n                    }\n                  : {\n                      hasMany,\n                      onChange,\n                      value,\n                    })}\n              />\n            )}\n          </div>\n        )}\n        {AfterInput}\n        <RenderCustomComponent\n          CustomComponent={Description}\n          Fallback={<FieldDescription description={description} path={path} />}\n        />\n      </div>\n      {currentlyOpenRelationship.collectionSlug && currentlyOpenRelationship.hasReadPermission && (\n        <DocumentDrawer onDelete={onDelete} onDuplicate={onDuplicate} onSave={onSave} />\n      )}\n      {appearance === 'drawer' && !readOnly && (\n        <ListDrawer allowCreate={allowCreate} enableRowSelections={false} onSelect={onListSelect} />\n      )}\n    </div>\n  )\n}\n"],"mappings":"AAAA;;;AAGA,SAASA,MAAM,QAAQ;AACvB,SAASC,cAAc,EAAEC,mBAAmB,QAAQ;AACpD,YAAYC,EAAA,MAAQ;AACpB,OAAOC,KAAA,IAASC,WAAW,EAAEC,SAAS,EAAEC,OAAO,EAAEC,UAAU,EAAEC,MAAM,EAAEC,QAAQ,QAAQ;AAOrF,SAASC,cAAc,QAAQ;AAC/B,SAASC,iBAAiB,QAAQ;AAClC,SAASC,aAAa,QAAQ;AAC9B,SAASC,WAAW,QAAQ;AAC5B,SAASC,qBAAqB,QAAQ;AACtC,SAASC,gBAAgB,QAAQ;AACjC,SAASC,UAAU,QAAQ;AAC3B,SAASC,UAAU,QAAQ;AAC3B,SAASC,oBAAoB,QAAQ;AACrC,SAASC,cAAc,QAAQ;AAC/B,SAASC,SAAS,QAAQ;AAC1B,SAASC,OAAO,QAAQ;AACxB,SAASC,SAAS,QAAQ;AAC1B,SAASC,SAAS,QAAQ;AAC1B,SAASC,cAAc,QAAQ;AAC/B,SAASC,0BAA0B,QAAQ;AAC3C,SAASC,cAAc,QAAQ;AAC/B,SAASC,iBAAiB,QAAQ;AAClC,SAASC,kBAAkB,QAAQ;AACnC,SAASC,cAAc,QAAQ;AAC/B,SAASC,eAAe,QAAQ;AAChC,OAAO;AACP,SAASC,WAAW,QAAQ;AAE5B,MAAMC,SAAA,GAAY;AAElB,OAAO,MAAMC,iBAAA,GAAuDC,KAAA;EAClE,MAAM;IACJC,UAAU;IACVC,WAAA,GAAc,IAAI;IAClBC,SAAA,GAAY,IAAI;IAChBC,UAAA,GAAa,QAAQ;IACrBC,WAAW;IACXC,SAAS;IACTC,WAAW;IACXC,WAAW;IACXC,KAAK;IACLC,aAAa;IACbC,sBAAsB;IACtBC,OAAO;IACPC,YAAY;IACZC,UAAA,GAAa,IAAI;IACjBC,KAAK;IACLC,KAAK;IACLC,SAAS;IACTC,oBAAA,GAAuB,EAAE;IACzBC,QAAQ;IACRC,IAAI;IACJC,WAAW;IACXC,QAAQ;IACRC,UAAU;IACVC,QAAQ;IACRC,SAAS;IACTC,WAAW;IACXC,KAAK;IACLC;EAAK,CACN,GAAG5B,KAAA;EAEJ,MAAM;IAAE6B,MAAM;IAAEC;EAAe,CAAE,GAAG1C,SAAA;EAEpC,MAAM;IACJ2C,MAAA,EAAQ;MAAEC;IAAG,CAAE;IACfC;EAAS,CACV,GAAGJ,MAAA;EAEJ,MAAM;IAAEK,IAAI;IAAEC;EAAC,CAAE,GAAG7C,cAAA;EACpB,MAAM;IAAE8C;EAAW,CAAE,GAAGjD,OAAA;EACxB,MAAM;IAAEkD,IAAA,EAAMC;EAAM,CAAE,GAAGjD,SAAA;EAEzB,MAAM,CAACkD,yBAAA,EAA2BC,4BAAA,CAA6B,GAAGjE,QAAA,CAEhE;IACAkE,EAAA,EAAIC,SAAA;IACJC,cAAA,EAAgBD,SAAA;IAChBE,iBAAA,EAAmB;EACrB;EAEA,MAAM,CAACC,uBAAA,EAAyBC,0BAAA,CAA2B,GAAGvE,QAAA,CAAS,CAAC;EACxE,MAAM,CAACwE,cAAA,EAAgBC,iBAAA,CAAkB,GAAGzE,QAAA,CAAiC,CAAC;EAC9E,MAAM,CAAC0E,YAAA,EAAcC,eAAA,CAAgB,GAAG3E,QAAA,CAAS;EACjD,MAAM,CAAC4E,MAAA,EAAQC,SAAA,CAAU,GAAG7E,QAAA,CAAS;EACrC,MAAM,CAAC8E,SAAA,EAAWC,YAAA,CAAa,GAAG/E,QAAA,CAAS;EAC3C,MAAM,CAACgF,wBAAA,EAA0BC,2BAAA,CAA4B,GAAGjF,QAAA,CAAS;EACzE,MAAM,CAACkF,UAAA,EAAYC,aAAA,CAAc,GAAGnF,QAAA,CAAS;EAC7C,MAAMoF,qBAAA,GAAwBrF,MAAA,CAAO;EACrC,MAAM;IAAEsF;EAAS,CAAE,GAAG1E,SAAA;EAEtB,MAAM,CAAC2E,OAAA,EAASC,eAAA,CAAgB,GAAGzF,UAAA,CAAWsB,cAAA,EAAgB,EAAE;EAEhE,MAAMoE,QAAA,GAAWzF,MAAA,CAAOsD,KAAA;EAExB,MAAM,CAACoC,cAAA,GAAkB;IAAEC,YAAY;IAAEC;EAAU,CAAE,CAAC,GAAGzF,iBAAA,CAAkB;IACzEgE,EAAA,EAAIF,yBAAA,CAA0BE,EAAE;IAChCE,cAAA,EAAgBJ,yBAAA,CAA0BI;EAC5C;EAEA;EACA,MAAMwB,uBAAA,GAA0B/F,OAAA,CAA6B;IAC3D,IAAIgG,gBAAA,GAAmB1D,aAAA;IAEvB,IAAIkB,KAAA,EAAO;MACT,MAAMyC,gBAAA,GAAmB,CAACzD,OAAA,KAAY,QAAQ,CAACgB,KAAA,CAAM,GAAGA,KAAI,EAAG0C,MAAM,CAAC,CAACC,GAAA,EAAKC,GAAA;QAC1E,IAAI,CAACD,GAAG,CAACC,GAAA,CAAIjD,UAAU,CAAC,EAAE;UACxBgD,GAAG,CAACC,GAAA,CAAIjD,UAAU,CAAC,GAAG,EAAE;QAC1B;QACAgD,GAAG,CAACC,GAAA,CAAIjD,UAAU,CAAC,CAACkD,IAAI,CAACD,GAAA,CAAI5C,KAAK;QAClC,OAAO2C,GAAA;MACT,GAAG,CAAC;MAEF,CAAAG,KAAA,CAAMC,OAAO,CAACpD,UAAA,IAAcA,UAAA,GAAa,CAACA,UAAA,CAAW,EAAEqD,OAAO,CAAEC,QAAA;QAChET,gBAAA,GAAmB;UACjB,IAAIA,gBAAA,IAAoB,CAAC,CAAC;UAC1B,CAACS,QAAA,GAAW;YACV,IAAI,OAAOnE,aAAA,GAAgBmE,QAAA,CAAS,KAAK,WAAWnE,aAAa,CAACmE,QAAA,CAAS,GAAG,CAAC,CAAC;YAChF,IAAIR,gBAAgB,CAACQ,QAAA,CAAS,GAC1B;cACEpC,EAAA,EAAI;gBACFqC,MAAA,EAAQT,gBAAgB,CAACQ,QAAA;cAC3B;YACF,IACA,CAAC,CAAC;UACR;QACF;MACF;IACF;IAEA,OAAOT,gBAAA;EACT,GAAG,CAAC1D,aAAA,EAAekB,KAAA,EAAOhB,OAAA,EAASW,UAAA,CAAW;EAE9C,MAAM,CACJwD,UAAA,GAEA;IAAEC,WAAA,EAAaC,eAAe;IAAEhB,YAAA,EAAciB,gBAAgB;IAAEhB,UAAA,EAAYiB;EAAc,CAAE,CAC7F,GAAGzG,aAAA,CAAc;IAChB0G,eAAA,EAAiB7D,UAAA;IACjBb,aAAA,EAAeyD;EACjB;EAEA,MAAMkB,YAAA,GAAenH,WAAA,CACnB,CAAC;IAAEyE,cAAc;IAAE2C;EAAG,CAAE;IACtB,IAAI1E,OAAA,EAAS;MACXO,QAAA,CAAS,C,IACHuD,KAAA,CAAMC,OAAO,CAAC/C,KAAA,IAASA,KAAA,GAAQ,EAAE,GACrC;QACEL,UAAA,EAAYoB,cAAA;QACZf,KAAA,EAAO0D,GAAA,CAAI7C;MACb,EACD;IACH,OAAO,IAAI7B,OAAA,KAAY,OAAO;MAC5BO,QAAA,CAAS;QACPI,UAAA,EAAYoB,cAAA;QACZf,KAAA,EAAO0D,GAAA,CAAI7C;MACb;IACF;IAEAwC,eAAA;EACF,GACA,CAACrE,OAAA,EAASO,QAAA,EAAU8D,eAAA,EAAiBrD,KAAA,CAAM;EAG7C,MAAM2D,6BAAA,GAAgCjH,MAAA,CAAO;EAE7C,MAAMkH,aAAA,GAA+BtH,WAAA,CACnC,CAAC;IACCwC,aAAa,EAAbA,eAAa;IACbE,OAAA,EAAS6E,UAAU;IACnB5C,uBAAA,EAAyB6C,0BAA0B;IACnD3C,cAAA,EAAgB4C,iBAAiB;IACjCC,SAAS;IACTzC,MAAA,EAAQ0C,SAAS;IACjBC,IAAI;IACJlE,KAAA,EAAOmE;EAAQ,CAChB;IACC,IAAI,CAAC3D,WAAA,EAAa;MAChB;IACF;IACAwB,SAAA,CAAU;MACR,MAAMoC,4BAAA,GACJ,OAAON,0BAAA,KAA+B,cAAcA,0BAAA,GAA6B,CAAC;MAEpF,MAAMO,SAAA,GAAYvB,KAAA,CAAMC,OAAO,CAACpD,UAAA,IAAcA,UAAA,GAAa,CAACA,UAAA,CAAW;MACvE,MAAM2E,gBAAA,GACJF,4BAAA,KAAiC,CAAC,IAC9BC,SAAA,GACAA,SAAA,CAAUE,KAAK,CAACH,4BAAA,GAA+B;MAErD,IAAII,cAAA,GAAiB;MACrB,MAAMC,WAAA,GAAc5G,iBAAA,CAClBgG,UAAA,KAAe,OACX;QACE7E,OAAA,EAAS;QACTW,UAAA;QACAK,KAAA,EAAOmE;MACT,IACA;QACEnF,OAAA,EAAS;QACTW,UAAA;QACAK,KAAA,EAAOmE;MACT;MAGN,IAAI,CAAC9C,YAAA,EAAc;QACjB,MAAMiD,gBAAA,CAAiB5B,MAAM,CAAC,OAAOgC,aAAA,EAAezB,UAAA;UAClD,MAAM0B,oBAAA,GAAuB7F,eAAA,GAAgBmE,UAAA,CAAS;UAEtD,IAAI2B,mBAAA;UACJ,IAAIrD,MAAA,KAAW0C,SAAA,EAAW;YACxBW,mBAAA,GAAsB;UACxB,OAAO;YACLA,mBAAA,GAAsBb,iBAAiB,CAACd,UAAA,CAAS,GAAG;UACtD;UACA,MAAMyB,aAAA;UAEN,IAAIC,oBAAA,KAAyB,OAAO;YAClCzD,0BAAA,CAA2BmD,SAAA,CAAUQ,OAAO,CAAC5B,UAAA;YAC7C,OAAO6B,OAAA,CAAQC,OAAO;UACxB;UAEA,IAAIP,cAAA,GAAiB,IAAI;YACvB,MAAMQ,UAAA,GAAa9E,eAAA,CAAgB;cAAEa,cAAA,EAAgBkC;YAAS;YAC9D,MAAMgC,aAAA,GAAgBD,UAAA,EAAYE,KAAA,EAAOC,UAAA,IAAc;YACvD,IAAIC,WAAA,GAAcJ,UAAA,EAAYK,WAAA,IAAe;YAC7C,IAAI,OAAOvF,WAAA,KAAgB,UAAU;cACnCsF,WAAA,GAActF,WAAA;YAChB,OAAO,IAAIA,WAAA,GAAcmD,UAAA,CAAS,EAAE;cAClCmC,WAAA,GAActF,WAAW,CAACmD,UAAA,CAAS;YACrC;YAEA,MAAMqC,KAAA,GAGF;cACFC,KAAA,EAAO;cACPC,KAAA,EAAO;cACPC,KAAA,EAAOnG,oBAAA;cACPoB,MAAA;cACAgF,IAAA,EAAMd,mBAAA;cACNe,MAAA,EAAQ;gBACN,CAACV,aAAA,GAAgB;cACnB;cACAf,IAAA,EAAMkB,WAAA;cACNQ,KAAA,EAAO;gBACLC,GAAA,EAAK,CACH;kBACEhF,EAAA,EAAI;oBACFqC,MAAA,EAAQuB,WAAW,CAACxB,UAAA;kBACtB;gBACF;cAEJ;YACF;YAEA,IAAIgB,SAAA,EAAW;cACbqB,KAAA,CAAMM,KAAK,CAACC,GAAG,CAAChD,IAAI,CAAC;gBACnB,CAACoC,aAAA,GAAgB;kBACfa,IAAA,EAAM7B;gBACR;cACF;YACF;YAEA,IAAIU,oBAAA,IAAwB,OAAOA,oBAAA,KAAyB,WAAW;cACrEW,KAAA,CAAMM,KAAK,CAACC,GAAG,CAAChD,IAAI,CAAC8B,oBAAA;YACvB;YAEAhH,0BAAA,CAA2B2H,KAAA,CAAMM,KAAK;YAEtC,MAAMG,QAAA,GAAW,MAAMC,KAAA,CAAM,GAAG3F,SAAA,GAAYD,GAAA,IAAO6C,UAAA,EAAU,EAAE;cAC7DgD,IAAA,EAAM7J,EAAA,CAAG8J,SAAS,CAACZ,KAAA;cACnBa,WAAA,EAAa;cACbC,OAAA,EAAS;gBACP,mBAAmB9F,IAAA,CAAK+F,QAAQ;gBAChC,gBAAgB;gBAChB,kCAAkC;cACpC;cACAC,MAAA,EAAQ;YACV;YAEA,IAAIP,QAAA,CAASQ,EAAE,EAAE;cACf,MAAMC,IAAA,GAA+B,MAAMT,QAAA,CAASU,IAAI;cACxDrF,iBAAA,CAAmBsF,SAAA;gBACjB,OAAO;kBACL,GAAGA,SAAS;kBACZ,CAACzD,UAAA,GAAW2B;gBACd;cACF;cAEA,IAAI,CAAC4B,IAAA,CAAKG,QAAQ,EAAE;gBAClBzF,0BAAA,CAA2BmD,SAAA,CAAUQ,OAAO,CAAC5B,UAAA;cAC/C;cAEA,IAAIuD,IAAA,CAAKI,IAAI,CAACC,MAAM,GAAG,GAAG;gBACxBrC,cAAA,IAAkBgC,IAAA,CAAKI,IAAI,CAACC,MAAM;gBAElC3E,eAAA,CAAgB;kBACd4E,IAAA,EAAM;kBACN9B,UAAA;kBACA/E,MAAA;kBACA2G,IAAA,EAAMJ,IAAA,CAAKI,IAAI;kBACftG,IAAA;kBACA4D;gBACF;cACF;YACF,OAAO,IAAI6B,QAAA,CAASgB,MAAM,KAAK,KAAK;cAClC7F,0BAAA,CAA2BmD,SAAA,CAAUQ,OAAO,CAAC5B,UAAA;cAC7Cf,eAAA,CAAgB;gBACd4E,IAAA,EAAM;gBACN9B,UAAA;gBACA/E,MAAA;gBACA2G,IAAA,EAAM,EAAE;gBACRtG,IAAA;gBACA0G,GAAA,EAAKvC,WAAW,CAACxB,UAAA,CAAS;gBAC1BiB;cACF;YACF,OAAO;cACL5C,eAAA,CAAgBf,CAAA,CAAE;YACpB;UACF;QACF,GAAGuE,OAAA,CAAQC,OAAO;QAElB,IAAI,OAAOf,SAAA,KAAc,YAAY;UACnCA,SAAA;QACF;MACF;IACF;EACF,GACA,CACExD,WAAA,EACAwB,SAAA,EACArC,UAAA,EACA0B,YAAA,EACAE,MAAA,EACArB,eAAA,EACAJ,WAAA,EACAR,oBAAA,EACAoB,MAAA,EACAL,SAAA,EACAD,GAAA,EACAE,IAAA,EACAL,MAAA,EACAM,CAAA,CACD;EAGH,MAAM0G,YAAA,GAAe7J,oBAAA,CACnB,CAAC;IAAE4B,OAAA,EAAS6E,YAAU;IAAEtC,MAAA,EAAQ0C,WAAS;IAAEjE,KAAK,EAALA;EAAK,CAAE;IAChDkH,wBAAA,CAAyB;MACvBpI,aAAA;MACAqC,cAAA,EAAgB,CAAC;MACjB6C,SAAA,EAAWA,CAAA;QACTtC,YAAA,CAAa;MACf;MACAH,MAAA,EAAQ0C,WAAA;MACRC,IAAA,EAAM;MACN,IAAIL,YAAA,KAAe,OACf;QACE7E,OAAA,EAAS6E,YAAA;QACT7D,KAAA,EAAAA;MACF,IACA;QACEhB,OAAA,EAAS6E,YAAA;QACT7D,KAAA,EAAAA;MACF,CAAC;IACP;IACAwB,SAAA,CAAUyC,WAAA;EACZ,GACA;EAGF,MAAMkD,iBAAA,GAAoB7K,WAAA,CACvB2F,SAAA;IACC,IAAIV,MAAA,KAAWU,SAAA,CAAQV,MAAM,EAAE;MAC7BG,YAAA,CAAa;MACbN,iBAAA,CAAkB,CAAC;MACnB6F,YAAA,CAAahF,SAAA;IACf;EACF,GACA,CAACV,MAAA,EAAQ0F,YAAA,CAAa;EAGxB,MAAMG,iBAAA,GAAoB/J,cAAA,CAAe,CAAC;IAAE2B,OAAA,EAAS6E,YAAU;IAAE7D,KAAK,EAALA;EAAK,CAAqB;IACzF,MAAMyE,aAAA,GAAc5G,iBAAA,CAClBgG,YAAA,KAAe,OACX;MACE7E,OAAA,EAAS6E,YAAA;MACTlE,UAAA;MACAK,KAAA,EAAAA;IACF,IACA;MACEhB,OAAA,EAAS6E,YAAA;MACTlE,UAAA;MACAK,KAAA,EAAAA;IACF;IAGN,KAAKqH,MAAA,CAAOC,OAAO,CAAC7C,aAAA,EAAa/B,MAAM,CAAC,OAAOgC,eAAA,EAAe,CAACzB,UAAA,EAAU+D,GAAA,CAAI;MAC3E,MAAMtC,eAAA;MAEN,MAAM6C,SAAA,GAAYP,GAAA,CAAIQ,MAAM,CAAE3G,EAAA;QAC5B,OAAO,CAACoB,OAAA,CAAQwF,IAAI,CAAEC,WAAA,IACpBA,WAAA,EAAazF,OAAA,EAASwF,IAAA,CACnBE,MAAA,IAAWA,MAAA,CAAO3H,KAAK,KAAKa,EAAA,IAAM8G,MAAA,CAAOhI,UAAU,KAAKsD,UAAA;MAG/D;MAEA,IAAIsE,SAAA,CAAUV,MAAM,GAAG,GAAG;QACxB,MAAM7B,YAAA,GAAa9E,eAAA,CAAgB;UAAEa,cAAA,EAAgBkC;QAAS;QAC9D,MAAM2E,aAAA,GAAgB5C,YAAA,EAAYE,KAAA,EAAOC,UAAA,IAAc;QAEvD,MAAMG,OAAA,GAAQ;UACZC,KAAA,EAAO;UACPC,KAAA,EAAO;UACPC,KAAA,EAAO8B,SAAA,CAAUV,MAAM;UACvBnG,MAAA;UACAiF,MAAA,EAAQ;YACN,CAACiC,aAAA,GAAgB;UACnB;UACAhC,KAAA,EAAO;YACL/E,EAAA,EAAI;cACFgH,EAAA,EAAIN;YACN;UACF;QACF;QAEA,IAAI,CAAClG,YAAA,EAAc;UACjB,MAAM0E,UAAA,GAAW,MAAMC,KAAA,CAAM,GAAG3F,SAAA,GAAYD,GAAA,IAAO6C,UAAA,EAAU,EAAE;YAC7DgD,IAAA,EAAM7J,EAAA,CAAG8J,SAAS,CAACZ,OAAA;YACnBa,WAAA,EAAa;YACbC,OAAA,EAAS;cACP,mBAAmB9F,IAAA,CAAK+F,QAAQ;cAChC,gBAAgB;cAChB,kCAAkC;YACpC;YACAC,MAAA,EAAQ;UACV;UACA,IAAIM,IAAA,GAAO,EAAE;UAEb,IAAIb,UAAA,CAASQ,EAAE,EAAE;YACf,MAAMC,MAAA,GAAO,MAAMT,UAAA,CAASU,IAAI;YAChCG,IAAA,GAAOJ,MAAA,CAAKI,IAAI;UAClB;UAEA1E,eAAA,CAAgB;YACd4E,IAAA,EAAM;YACN9B,UAAA,EAAAA,YAAA;YACA/E,MAAA;YACA2G,IAAA;YACAtG,IAAA;YACA0G,GAAA,EAAKO,SAAA;YACLrD,IAAA,EAAM;UACR;QACF;MACF;IACF,GAAGY,OAAA,CAAQC,OAAO;EACpB;EAEA,MAAM+C,MAAA,GAASxL,WAAA,CACZyL,IAAA;IACC7F,eAAA,CAAgB;MACd4E,IAAA,EAAM;MACN9B,UAAA,EAAY+C,IAAA,CAAKC,gBAAgB;MACjC/H,MAAA;MACAyD,GAAA,EAAKqE,IAAA,CAAKrE,GAAG;MACbpD;IACF;IAEA,MAAM2H,KAAA,GAAQF,IAAA,CAAKrE,GAAG,CAAC7C,EAAE;IAEzB,IAAI7B,OAAA,EAAS;MACX,MAAMkJ,YAAA,GAAelI,KAAA,GAAS8C,KAAA,CAAMC,OAAO,CAAC/C,KAAA,IAASA,KAAA,GAAQ,CAACA,KAAA,CAAM,GAAI,EAAE;MAE1E,MAAMmI,WAAA,GAAcD,YAAA,CAAaE,GAAG,CAAET,QAAA;QACpC,OAAO;UACLhI,UAAA,EAAYgI,QAAA,CAAO3H,KAAK,KAAKiI,KAAA,GAAQF,IAAA,CAAKC,gBAAgB,CAACK,IAAI,GAAGV,QAAA,CAAOhI,UAAU;UACnFK,KAAA,EAAO2H,QAAA,CAAO3H;QAChB;MACF;MAEAT,QAAA,CAAS4I,WAAA;IACX,OAAO,IAAInJ,OAAA,KAAY,OAAO;MAC5BO,QAAA,CAAS;QAAEI,UAAA,EAAYoI,IAAA,CAAKC,gBAAgB,CAACK,IAAI;QAAErI,KAAA,EAAOiI;MAAM;IAClE;EACF,GACA,CAAC3H,IAAA,EAAML,MAAA,EAAQjB,OAAA,EAASO,QAAA,EAAUS,KAAA,CAAM;EAG1C,MAAMsI,WAAA,GAAchM,WAAA,CACjByL,MAAA;IACC7F,eAAA,CAAgB;MACd4E,IAAA,EAAM;MACN9B,UAAA,EAAY+C,MAAA,CAAKC,gBAAgB;MACjC/H,MAAA;MACA2G,IAAA,EAAM,CAACmB,MAAA,CAAKrE,GAAG,CAAC;MAChBpD,IAAA;MACA4D,IAAA,EAAM;IACR;IAEA,IAAIlF,OAAA,EAAS;MACXO,QAAA,CACES,KAAA,GACIA,KAAA,CAAMuI,MAAM,CAAC;QACX5I,UAAA,EAAYoI,MAAA,CAAKC,gBAAgB,CAACK,IAAI;QACtCrI,KAAA,EAAO+H,MAAA,CAAKrE,GAAG,CAAC7C;MAClB,KACA;IAER,OAAO,IAAI7B,OAAA,KAAY,OAAO;MAC5BO,QAAA,CAAS;QACPI,UAAA,EAAYoI,MAAA,CAAKC,gBAAgB,CAACK,IAAI;QACtCrI,KAAA,EAAO+H,MAAA,CAAKrE,GAAG,CAAC7C;MAClB;IACF;EACF,GACA,CAACP,IAAA,EAAML,MAAA,EAAQjB,OAAA,EAASO,QAAA,EAAUS,KAAA,CAAM;EAG1C,MAAMwI,QAAA,GAAWlM,WAAA,CACdyL,MAAA;IACC7F,eAAA,CAAgB;MACdrB,EAAA,EAAIkH,MAAA,CAAKlH,EAAE;MACXiG,IAAA,EAAM;MACN9B,UAAA,EAAY+C,MAAA,CAAKC,gBAAgB;MACjC/H,MAAA;MACAK;IACF;IAEA,IAAItB,OAAA,EAAS;MACXO,QAAA,CACES,KAAA,GACIA,KAAA,CAAMwH,MAAM,CAAEG,QAAA;QACZ,OAAOA,QAAA,CAAO3H,KAAK,KAAK+H,MAAA,CAAKlH,EAAE;MACjC,KACA;IAER,OAAO;MACLtB,QAAA,CAAS;IACX;IAEA;EACF,GACA,CAACe,IAAA,EAAML,MAAA,EAAQjB,OAAA,EAASO,QAAA,EAAUS,KAAA,CAAM;EAG1C,MAAMyI,YAAA,GAAenM,WAAA,CAAY,CAACoM,IAAA,EAAcC,YAAA;IAC9C,IAAI,CAACA,YAAA,EAAc;MACjB,OAAO;IACT;IACA,MAAMC,CAAA,GAAIzM,mBAAA,CAAoBwM,YAAA,IAAgB;IAC9C;IACA,MAAME,mBAAA,GAAsB;IAC5B,IAAIC,WAAA,GAAcC,MAAA,CAAOL,IAAA,CAAKvJ,KAAK;IACnC;IACA,OAAO2J,WAAA,CAAYjC,MAAM,GAAGgC,mBAAA,EAAqB;MAC/C;MACA,MAAMG,YAAA,GAAeF,WAAA,CAAYjE,OAAO,CAAC,KAAK8D,YAAA,CAAa9B,MAAM;MACjE,IACE+B,CAAA,CAAEK,IAAI,CAACH,WAAA,CAAYvE,KAAK,CAAC,GAAGyE,YAAA,KAAiB,CAAC,IAAIL,YAAA,CAAa9B,MAAM,GAAGmC,YAAA,GAAe,KACvF;QACA,OAAO;MACT;MACAF,WAAA,GAAcA,WAAA,CAAYvE,KAAK,CAACyE,YAAA,KAAiB,CAAC,IAAIL,YAAA,CAAa9B,MAAM,GAAGmC,YAAA,GAAe;IAC7F;IACA,OAAOJ,CAAA,CAAEK,IAAI,CAACH,WAAA,CAAYvE,KAAK,CAAC,CAACsE,mBAAA;EACnC,GAAG,EAAE;EAEL,MAAMK,cAAA,GAAiB5M,WAAA,CACrB,CAAC;IAAEuE,EAAE,EAAFA,IAAE;IAAEE,cAAc,EAAdA,gBAAc;IAAEC,iBAAiB;IAAEmI;EAAY,CAAE;IACtD,IAAIA,YAAA,EAAc;MAChB,IAAInI,iBAAA,IAAqBH,IAAA,IAAME,gBAAA,EAAgB;QAC7C,MAAMqI,MAAA,GAASlN,cAAA,CAAe;UAC5BmN,UAAA,EAAYpJ,MAAA,CAAOE,MAAM,CAAC+E,KAAK;UAC/B1F,IAAA,EAAM,gBAAgBuB,gBAAA,IAAkBF,IAAA;QAC1C;QAEAyI,MAAA,CAAOC,IAAI,CAACH,MAAA,EAAQ;MACtB;IACF,OAAO;MACLzF,6BAAA,CAA8B6F,OAAO,GAAG;MAExC5I,4BAAA,CAA6B;QAC3BC,EAAA,EAAAA,IAAA;QACAE,cAAA,EAAAA,gBAAA;QACAC;MACF;IACF;EACF,GACA,CAACf,MAAA,CAAOE,MAAM,CAAC+E,KAAK,CAAC;EAGvB,MAAMgC,wBAAA,GAA0C7J,cAAA,CAAgB0K,MAAA;IAC9D,OAAOnE,aAAA,CAAcmE,MAAA;EACvB;EAEA;EACA;EACAxL,SAAA,CAAU;IACR;IACA;IACA;IACA,IAAIwF,qBAAA,CAAsByH,OAAO,IAAI3H,UAAA,EAAY;MAC/CH,YAAA,CAAa;MACb,KAAKwF,wBAAA,CAAyB;QAC5BpI,aAAA;QACAqC,cAAA,EAAgB,CAAC;QACjB6C,SAAA,EAAWA,CAAA;UACTjC,qBAAA,CAAsByH,OAAO,GAAG;UAChC9H,YAAA,CAAa;QACf;QACA,IAAI1C,OAAA,KAAY,OACZ;UACEA,OAAA;UACAgB,KAAA,EAAOmC,QAAA,CAASqH;QAClB,IACA;UACExK,OAAA;UACAgB,KAAA,EAAOmC,QAAA,CAASqH;QAClB,CAAC;MACP;IACF;IAEA;IACA;IACAtH,eAAA,CAAgB;MACd4E,IAAA,EAAM;MACN2C,YAAA,EAActH,QAAA,CAASqH;IACzB;IAEAtI,0BAAA,CAA2B,CAAC;IAC5BE,iBAAA,CAAkB,CAAC;EACrB,GAAG,CAACzB,UAAA,EAAYb,aAAA,EAAe4B,MAAA,EAAQlB,IAAA,EAAMqC,UAAA,EAAY7C,OAAA,CAAQ;EAEjE,MAAM0K,SAAA,GAAYhN,MAAA,CAAOsD,KAAA;EACzB,MAAM2J,gBAAA,GAAmBjN,MAAA,CAAO;EAEhC;EACA;EACA;EACAH,SAAA,CAAU;IACR,IAAIoN,gBAAA,CAAiBH,OAAO,IAAI,CAACvN,MAAA,CAAO+D,KAAA,EAAO0J,SAAA,CAAUF,OAAO,GAAG;MACjEpC,iBAAA,CAAkBpI,OAAA,KAAY,OAAO;QAAEA,OAAA;QAASgB;MAAM,IAAI;QAAEhB,OAAA;QAASgB;MAAM;IAC7E;IACA2J,gBAAA,CAAiBH,OAAO,GAAG;IAC3BE,SAAA,CAAUF,OAAO,GAAGxJ,KAAA;EACtB,GAAG,CAACA,KAAA,EAAOhB,OAAA,CAAQ;EAEnB;EACAzC,SAAA,CAAU;IACR,MAAM8H,WAAA,GAAYvB,KAAA,CAAMC,OAAO,CAACpD,UAAA,IAAcA,UAAA,GAAa,CAACA,UAAA,CAAW;IACvE,MAAMiK,QAAA,GAAWvF,WAAA,CAAU3B,MAAM,CAAC,CAACmH,MAAA,EAAQ5G,UAAA;MACzC,MAAM+B,YAAA,GAAa9E,eAAA,CAAgB;QAAEa,cAAA,EAAgBkC;MAAS;MAC9D,MAAMgC,eAAA,GAAgBD,YAAA,EAAYE,KAAA,EAAOC,UAAA,IAAc;MACvD,OAAOF,eAAA,KAAkB,QAAQ4E,MAAA;IACnC,GAAG;IACHjI,2BAAA,CAA4B,CAACgI,QAAA;EAC/B,GAAG,CAACjK,UAAA,EAAYO,eAAA,CAAgB;EAEhC3D,SAAA,CAAU;IACR,IAAIoH,6BAAA,CAA8B6F,OAAO,EAAE;MACzClH,UAAA;MACAqB,6BAAA,CAA8B6F,OAAO,GAAG;IAC1C;EACF,GAAG,CAAClH,UAAA,EAAY3B,yBAAA,CAA0B;EAE1CpE,SAAA,CAAU;IACR;IACA;IACA4F,QAAA,CAASqH,OAAO,GAAGxJ,KAAA;EACrB,GAAG,CAACA,KAAA,CAAM;EAEV,MAAM8J,aAAA,GAAgBhM,kBAAA,CAAmB;IAAES,SAAA;IAAW0D,OAAA;IAASjC;EAAM;EAErE,IAAI,CAAC8C,KAAA,CAAMC,OAAO,CAAC+G,aAAA,KAAkBA,aAAA,EAAe9J,KAAA,KAAU,QAAQ;IACpE8J,aAAA,CAAc9J,KAAK,GAAG;EACxB;EAEA,oBACE+J,KAAA,CAAC;IACCrL,SAAA,EAAW,CACTd,cAAA,EACAM,SAAA,EACAQ,SAAA,EACAmB,SAAA,IAAa,SACbwB,YAAA,IAAgB,iBAChB3B,QAAA,IAAY,GAAGxB,SAAA,aAAsB,EACrC,CAACwB,QAAA,IAAYpB,WAAA,IAAe,GAAGJ,SAAA,gBAAyB,CACzD,CACEsJ,MAAM,CAACwC,OAAA,EACPC,IAAI,CAAC;IACRpJ,EAAA,EAAI,SAASrB,IAAA,CAAK0K,OAAO,CAAC,OAAO,OAAO;IACxCnK,KAAA,EAAOA,KAAA;4BAEPoK,IAAA,CAACnN,qBAAA;MACCoN,eAAA,EAAiBhL,KAAA;MACjBiL,QAAA,eACEF,IAAA,CAAChN,UAAA;QAAWgC,KAAA,EAAOA,KAAA;QAAOE,SAAA,EAAWA,SAAA;QAAWG,IAAA,EAAMA,IAAA;QAAMI,QAAA,EAAUA;;qBAG1EmK,KAAA,CAAC;MAAIrL,SAAA,EAAW,GAAGd,cAAA,QAAsB;8BACvCuM,IAAA,CAACnN,qBAAA;QACCoN,eAAA,EAAiBvL,KAAA;QACjBwL,QAAA,eAAUF,IAAA,CAACjN,UAAA;UAAWsC,IAAA,EAAMA,IAAA;UAAMK,SAAA,EAAWA;;UAE9CpB,WAAA,EACA4C,YAAA,gBACC8I,IAAA,CAAC;QAAIzL,SAAA,EAAW,GAAGR,SAAA,iBAA0B;kBAAGmD;wBAEhD0I,KAAA,CAAC;QAAIrL,SAAA,EAAW,GAAGR,SAAA,QAAiB;gCAClCiM,IAAA,CAACpN,WAAA;UACCuN,qBAAA,EAAuB,EAAEjI,YAAA,IAAgBiB,gBAAe;UACxDiH,UAAA,EAAY;YACVvM,eAAA;YACAC,WAAA;YACA,IAAIO,UAAA,KAAe,YAAY;cAAEgM,iBAAA,EAAmB;YAAK,CAAC;UAC5D;UACAC,WAAA,EAAa;YACXC,cAAA,EAAgBrI,YAAA,IAAgBiB,gBAAA;YAChCqH,gBAAA,EAAkBtI,YAAA,IAAgBiB,gBAAA;YAClC4F,cAAA;YACApB;UACF;UACA8C,QAAA,EAAUlL,QAAA,IAAY2C,YAAA,IAAgBiB,gBAAA;UACtCmF,YAAA,EAAc9G,wBAAA,GAA2B8G,YAAA,GAAe3H,SAAA;UACxD+J,cAAA,EAAiBlD,QAAA;YACf,IAAI,CAACA,QAAA,EAAQ;cACX,OAAO7G,SAAA;YACT;YACA,OAAO9B,OAAA,IAAW8D,KAAA,CAAMC,OAAO,CAACpD,UAAA,IAC5B,GAAGgI,QAAA,CAAOhI,UAAU,IAAIgI,QAAA,CAAO3H,KAAK,EAAE,GACrC2H,QAAA,CAAO3H,KAAK;UACnB;UACAyB,SAAA,EAAWjD,UAAA,KAAe,YAAYiD,SAAA;UACtCqJ,OAAA,EAAS9L,OAAA;UACT+L,YAAA,EAAcvM,UAAA,KAAe;UAC7BU,UAAA,EAAYA,UAAA;UACZ2C,UAAA,EAAYrD,UAAA,KAAe,WAAWqD,UAAA,GAAa;UACnDtC,QAAA,EACE,CAACG,QAAA,GACIsL,QAAA;YACC,IAAIhM,OAAA,EAAS;cACX,IAAIgM,QAAA,KAAa,MAAM;gBACrB7I,QAAA,CAASqH,OAAO,GAAG,EAAE;gBACrBjK,QAAA,CAAS,EAAE;cACb,OAAO;gBACL4C,QAAA,CAASqH,OAAO,GAAGwB,QAAA;gBACnBzL,QAAA,CAASyL,QAAA;cACX;YACF,OAAO,IAAIhM,OAAA,KAAY,OAAO;cAC5B,IAAIgM,QAAA,KAAa,MAAM;gBACrB7I,QAAA,CAASqH,OAAO,GAAG;gBACnBjK,QAAA,CAAS;cACX,OAAO;gBACL4C,QAAA,CAASqH,OAAO,GAAGwB,QAAA;gBACnBzL,QAAA,CAASyL,QAAA;cACX;YACF;UACF,IACAlK,SAAA;UAENmK,aAAA,EAAgBC,SAAA,IACd/D,iBAAA,CAAkB;YAChB5F,MAAA,EAAQ2J,SAAA;YACR,IAAIlM,OAAA,KAAY,OACZ;cACEA,OAAA;cACAgB;YACF,IACA;cACEhB,OAAA;cACAgB;YACF,CAAC;UACP;UAEFmL,WAAA,EAAaA,CAAA;YACXrJ,aAAA,CAAc;UAChB;UACAsJ,UAAA,EAAYA,CAAA;YACV,IAAI5M,UAAA,KAAe,UAAU;cAC3B+E,cAAA;YACF,OAAO,IAAI/E,UAAA,KAAe,UAAU;cAClCsD,aAAA,CAAc;cACd,IAAI,CAACC,qBAAA,CAAsByH,OAAO,EAAE;gBAClC9H,YAAA,CAAa;gBACbwF,wBAAA,CAAyB;kBACvBpI,aAAA;kBACAqC,cAAA,EAAgB,CAAC;kBACjB6C,SAAA,EAAWA,CAAA;oBACTjC,qBAAA,CAAsByH,OAAO,GAAG;oBAChC9H,YAAA,CAAa;kBACf;kBACA,IAAI1C,OAAA,KAAY,OACZ;oBACEA,OAAA;oBACAgB;kBACF,IACA;oBACEhB,OAAA;oBACAgB;kBACF,CAAC;gBACP;cACF;YACF;UACF;UACAqL,oBAAA,EAAsBA,CAAA;YACpB3J,YAAA,CAAa;YACbwF,wBAAA,CAAyB;cACvBpI,aAAA;cACAmC,uBAAA;cACAE,cAAA;cACA6C,SAAA,EAAWA,CAAA;gBACTtC,YAAA,CAAa;cACf;cACAH,MAAA;cACA2C,IAAA,EAAM;cACN,IAAIlF,OAAA,KAAY,OACZ;gBACEA,OAAA;gBACAgB,KAAA,EAAOf;cACT,IACA;gBACED,OAAA;gBACAgB,KAAA,EAAOf;cACT,CAAC;YACP;UACF;UACAgD,OAAA,EACE,OAAOlD,sBAAA,KAA2B,aAC9BA,sBAAA,CAAuBkD,OAAA,IACvBA,OAAA;UAENxC,WAAA,EAAaA,WAAA;UACbI,SAAA,EAAWA,SAAA;UACXG,KAAA,EAAO8J,aAAA,IAAiB;YAEzB,CAACpK,QAAA,IAAYpB,WAAA,iBACZ6L,IAAA,CAACvN,cAAA;UACC4C,IAAA,EAAMA,IAAA;UACNG,UAAA,EAAYA,UAAA;UACX,IAAIX,OAAA,KAAY,OACb;YACEA,OAAA;YACAO,QAAA;YACAS;UACF,IACA;YACEhB,OAAA;YACAO,QAAA;YACAS;UACF,CAAC;;UAKZ3B,UAAA,E,aACD8L,IAAA,CAACnN,qBAAA;QACCoN,eAAA,EAAiBxL,WAAA;QACjByL,QAAA,eAAUF,IAAA,CAAClN,gBAAA;UAAiB0B,WAAA,EAAaA,WAAA;UAAaa,IAAA,EAAMA;;;QAG/DmB,yBAAA,CAA0BI,cAAc,IAAIJ,yBAAA,CAA0BK,iBAAiB,iBACtFmJ,IAAA,CAAC/H,cAAA;MAAeoG,QAAA,EAAUA,QAAA;MAAUF,WAAA,EAAaA,WAAA;MAAaR,MAAA,EAAQA;QAEvEtJ,UAAA,KAAe,YAAY,CAACkB,QAAA,iBAC3ByK,IAAA,CAAChH,UAAA;MAAW7E,WAAA,EAAaA,WAAA;MAAagN,mBAAA,EAAqB;MAAOC,QAAA,EAAU9H;;;AAIpF","ignoreList":[]}