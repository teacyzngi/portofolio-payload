{"version":3,"file":"index.js","names":["React","useCallback","useEffect","useMemo","useState","CodeEditor","RenderCustomComponent","FieldDescription","FieldError","FieldLabel","useField","withCondition","mergeFieldStyles","fieldBaseClass","prismToMonacoLanguageMap","js","ts","tsx","baseClass","CodeFieldComponent","props","field","admin","className","description","editorOptions","editorProps","language","label","localized","required","onMount","path","pathFromProps","readOnly","validate","inputChangeFromRef","useRef","recalculatedHeightAt","setRecalculatedHeightAt","Date","now","memoizedValidate","value","options","customComponents","AfterInput","BeforeInput","Description","Error","Label","disabled","initialValue","setValue","showError","potentiallyStalePath","stringValueRef","undefined","handleChange","val","current","e","styles","_jsxs","filter","Boolean","join","style","_jsx","CustomComponent","Fallback","defaultLanguage","onChange","wrapperProps","id","replace","CodeField"],"sources":["../../../src/fields/Code/index.tsx"],"sourcesContent":["'use client'\nimport type { CodeFieldClientComponent } from 'payload'\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react'\n\nimport { CodeEditor } from '../../elements/CodeEditor/index.js'\nimport { RenderCustomComponent } from '../../elements/RenderCustomComponent/index.js'\nimport { FieldDescription } from '../../fields/FieldDescription/index.js'\nimport { FieldError } from '../../fields/FieldError/index.js'\nimport { FieldLabel } from '../../fields/FieldLabel/index.js'\nimport { useField } from '../../forms/useField/index.js'\nimport { withCondition } from '../../forms/withCondition/index.js'\nimport { mergeFieldStyles } from '../mergeFieldStyles.js'\nimport { fieldBaseClass } from '../shared/index.js'\nimport './index.scss'\n\nconst prismToMonacoLanguageMap = {\n  js: 'javascript',\n  ts: 'typescript',\n  tsx: 'typescript',\n}\n\nconst baseClass = 'code-field'\n\nconst CodeFieldComponent: CodeFieldClientComponent = (props) => {\n  const {\n    field,\n    field: {\n      admin: { className, description, editorOptions, editorProps, language = 'javascript' } = {},\n      label,\n      localized,\n      required,\n    },\n    onMount,\n    path: pathFromProps,\n    readOnly,\n    validate,\n  } = props\n\n  const inputChangeFromRef = React.useRef<'formState' | 'internalEditor'>('formState')\n  const [recalculatedHeightAt, setRecalculatedHeightAt] = useState<number | undefined>(Date.now())\n\n  const memoizedValidate = useCallback(\n    (value, options) => {\n      if (typeof validate === 'function') {\n        return validate(value, { ...options, required })\n      }\n    },\n    [validate, required],\n  )\n\n  const {\n    customComponents: { AfterInput, BeforeInput, Description, Error, Label } = {},\n    disabled,\n    initialValue,\n    path,\n    setValue,\n    showError,\n    value,\n  } = useField<string>({\n    potentiallyStalePath: pathFromProps,\n    validate: memoizedValidate,\n  })\n\n  const stringValueRef = React.useRef<string>(\n    (value || initialValue) !== undefined ? (value ?? initialValue) : undefined,\n  )\n\n  const handleChange = useCallback(\n    (val: string) => {\n      if (readOnly || disabled) {\n        return\n      }\n      inputChangeFromRef.current = 'internalEditor'\n\n      try {\n        setValue(val ? val : null)\n        stringValueRef.current = val\n      } catch (e) {\n        setValue(val ? val : null)\n        stringValueRef.current = val\n      }\n    },\n    [readOnly, disabled, setValue],\n  )\n\n  useEffect(() => {\n    if (inputChangeFromRef.current === 'formState') {\n      stringValueRef.current =\n        (value || initialValue) !== undefined ? (value ?? initialValue) : undefined\n      setRecalculatedHeightAt(Date.now())\n    }\n\n    inputChangeFromRef.current = 'formState'\n  }, [initialValue, path, value])\n\n  const styles = useMemo(() => mergeFieldStyles(field), [field])\n\n  return (\n    <div\n      className={[\n        fieldBaseClass,\n        baseClass,\n        className,\n        showError && 'error',\n        (readOnly || disabled) && 'read-only',\n      ]\n        .filter(Boolean)\n        .join(' ')}\n      style={styles}\n    >\n      <RenderCustomComponent\n        CustomComponent={Label}\n        Fallback={\n          <FieldLabel label={label} localized={localized} path={path} required={required} />\n        }\n      />\n      <div className={`${fieldBaseClass}__wrap`}>\n        <RenderCustomComponent\n          CustomComponent={Error}\n          Fallback={<FieldError path={path} showError={showError} />}\n        />\n        {BeforeInput}\n        <CodeEditor\n          defaultLanguage={prismToMonacoLanguageMap[language] || language}\n          onChange={handleChange}\n          onMount={onMount}\n          options={editorOptions}\n          readOnly={readOnly || disabled}\n          recalculatedHeightAt={recalculatedHeightAt}\n          value={stringValueRef.current}\n          wrapperProps={{\n            id: `field-${path?.replace(/\\./g, '__')}`,\n          }}\n          {...(editorProps || {})}\n        />\n        {AfterInput}\n      </div>\n      <RenderCustomComponent\n        CustomComponent={Description}\n        Fallback={<FieldDescription description={description} path={path} />}\n      />\n    </div>\n  )\n}\n\nexport const CodeField = withCondition(CodeFieldComponent)\n"],"mappings":"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","ignoreList":[]}