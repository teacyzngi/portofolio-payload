{"version":3,"file":"renderCell.js","names":["MissingEditorProp","formatAdminURL","RenderCustomComponent","RenderServerComponent","DefaultCell","RenderDefaultCell","hasOptionLabelJSXElement","findValueFromPath","renderCell","clientField","collectionSlug","columnIndex","customCellProps","doc","enableRowSelections","i18n","isLinkedColumn","payload","req","rowIndex","serverField","viewType","baseCellClientProps","cellData","undefined","field","rowData","accessor","name","shouldLink","customLinkURL","collectionConfig","collections","config","formatDocURL","admin","adminRoute","routes","defaultURL","path","encodeURIComponent","String","id","customURL","cellClientProps","link","linkURL","cellServerProps","className","onClick","CustomCell","type","editor","Error","components","clientProps","Component","CellComponent","importMap","serverProps","CustomCellComponent","Cell","_jsx","CustomComponent","Fallback"],"sources":["../../../../src/providers/TableColumns/buildColumnState/renderCell.tsx"],"sourcesContent":["import type { I18nClient } from '@payloadcms/translations'\nimport type {\n  ClientField,\n  DefaultCellComponentProps,\n  DefaultServerCellComponentProps,\n  Document,\n  Field,\n  Payload,\n  PayloadRequest,\n  ViewTypes,\n} from 'payload'\n\nimport { MissingEditorProp } from 'payload'\nimport { formatAdminURL } from 'payload/shared'\n\nimport { RenderCustomComponent } from '../../../elements/RenderCustomComponent/index.js'\nimport { RenderServerComponent } from '../../../elements/RenderServerComponent/index.js'\nimport {\n  DefaultCell,\n  RenderDefaultCell,\n  // eslint-disable-next-line payload/no-imports-from-exports-dir -- MUST reference the exports dir: https://github.com/payloadcms/payload/issues/12002#issuecomment-2791493587\n} from '../../../exports/client/index.js'\nimport { hasOptionLabelJSXElement } from '../../../utilities/hasOptionLabelJSXElement.js'\nimport { findValueFromPath } from './findValueFromPath.js'\n\ntype RenderCellArgs = {\n  readonly clientField: ClientField\n  readonly collectionSlug: string\n  readonly columnIndex: number\n  readonly customCellProps: DefaultCellComponentProps['customCellProps']\n  readonly doc: Document\n  readonly enableRowSelections: boolean\n  readonly i18n: I18nClient\n  readonly isLinkedColumn: boolean\n  readonly payload: Payload\n  readonly req?: PayloadRequest\n  readonly rowIndex: number\n  readonly serverField: Field\n  readonly viewType?: ViewTypes\n}\nexport function renderCell({\n  clientField,\n  collectionSlug,\n  columnIndex,\n  customCellProps,\n  doc,\n  enableRowSelections,\n  i18n,\n  isLinkedColumn,\n  payload,\n  req,\n  rowIndex,\n  serverField,\n  viewType,\n}: RenderCellArgs) {\n  const baseCellClientProps: DefaultCellComponentProps = {\n    cellData: undefined,\n    collectionSlug,\n    customCellProps,\n    field: clientField,\n    rowData: undefined,\n    viewType,\n  }\n\n  const accessor: string | undefined =\n    ('accessor' in clientField ? (clientField.accessor as string) : undefined) ??\n    ('name' in clientField ? clientField.name : undefined)\n\n  // Check if there's a custom formatDocURL function for this linked column\n  let shouldLink = isLinkedColumn\n  let customLinkURL: string | undefined\n\n  if (isLinkedColumn && req) {\n    const collectionConfig = payload.collections[collectionSlug]?.config\n    const formatDocURL = collectionConfig?.admin?.formatDocURL\n\n    if (typeof formatDocURL === 'function') {\n      // Generate the default URL that would normally be used\n      const adminRoute = req.payload.config.routes?.admin || '/admin'\n      const defaultURL = formatAdminURL({\n        adminRoute,\n        path: `/collections/${collectionSlug}${viewType === 'trash' ? '/trash' : ''}/${encodeURIComponent(String(doc.id))}`,\n      })\n\n      const customURL = formatDocURL({\n        collectionSlug,\n        defaultURL,\n        doc,\n        req,\n        viewType,\n      })\n\n      if (customURL === null) {\n        // formatDocURL returned null = disable linking entirely\n        shouldLink = false\n      } else if (typeof customURL === 'string') {\n        // formatDocURL returned a string = use custom URL\n        shouldLink = true\n        customLinkURL = customURL\n      } else {\n        // formatDocURL returned unexpected type = disable linking for safety\n        shouldLink = false\n      }\n    }\n  }\n\n  const cellClientProps: DefaultCellComponentProps = {\n    ...baseCellClientProps,\n    cellData: 'name' in clientField ? findValueFromPath(doc, accessor) : undefined,\n    link: shouldLink,\n    linkURL: customLinkURL,\n    rowData: doc,\n  }\n\n  const cellServerProps: DefaultServerCellComponentProps = {\n    cellData: cellClientProps.cellData,\n    className: baseCellClientProps.className,\n    collectionConfig: payload.collections[collectionSlug].config,\n    collectionSlug,\n    columnIndex,\n    customCellProps: baseCellClientProps.customCellProps,\n    field: serverField,\n    i18n,\n    link: shouldLink,\n    linkURL: customLinkURL,\n    onClick: baseCellClientProps.onClick,\n    payload,\n    rowData: doc,\n  }\n\n  let CustomCell = null\n\n  if (serverField?.type === 'richText') {\n    if (!serverField?.editor) {\n      throw new MissingEditorProp(serverField) // while we allow disabling editor functionality, you should not have any richText fields defined if you do not have an editor\n    }\n\n    if (typeof serverField?.editor === 'function') {\n      throw new Error('Attempted to access unsanitized rich text editor.')\n    }\n\n    if (!serverField.admin) {\n      serverField.admin = {}\n    }\n\n    if (!serverField.admin.components) {\n      serverField.admin.components = {}\n    }\n\n    CustomCell = RenderServerComponent({\n      clientProps: cellClientProps,\n      Component: serverField.editor.CellComponent,\n      importMap: payload.importMap,\n      serverProps: cellServerProps,\n    })\n  } else {\n    const CustomCellComponent = serverField?.admin?.components?.Cell\n\n    if (CustomCellComponent) {\n      CustomCell = RenderServerComponent({\n        clientProps: cellClientProps,\n        Component: CustomCellComponent,\n        importMap: payload.importMap,\n        serverProps: cellServerProps,\n      })\n    } else if (\n      cellClientProps.cellData &&\n      cellClientProps.field &&\n      hasOptionLabelJSXElement(cellClientProps)\n    ) {\n      CustomCell = RenderServerComponent({\n        clientProps: cellClientProps,\n        Component: DefaultCell,\n        importMap: payload.importMap,\n      })\n    } else {\n      const CustomCellComponent = serverField?.admin?.components?.Cell\n\n      if (CustomCellComponent) {\n        CustomCell = RenderServerComponent({\n          clientProps: cellClientProps,\n          Component: CustomCellComponent,\n          importMap: payload.importMap,\n          serverProps: cellServerProps,\n        })\n      } else {\n        CustomCell = undefined\n      }\n    }\n  }\n\n  return (\n    <RenderCustomComponent\n      CustomComponent={CustomCell}\n      Fallback={\n        <RenderDefaultCell\n          clientProps={cellClientProps}\n          columnIndex={columnIndex}\n          enableRowSelections={enableRowSelections}\n          isLinkedColumn={isLinkedColumn}\n        />\n      }\n      key={`${rowIndex}-${columnIndex}`}\n    />\n  )\n}\n"],"mappings":"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","ignoreList":[]}