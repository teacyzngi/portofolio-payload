{"version":3,"file":"getColumns.js","names":["flattenTopLevelFields","fieldAffectsData","filterFieldsWithPermissions","getInitialColumns","getColumns","clientConfig","collectionConfig","collectionSlug","columns","i18n","permissions","isPolymorphic","Array","isArray","fields","collection","clientCollectionConfig","collections","find","each","slug","field","fieldPermissions","some","name","push","filter","column","keepPresentationalFields","moveSubFieldsToTop","accessor","undefined","admin","useAsTitle","defaultColumns"],"sources":["../../src/utilities/getColumns.ts"],"sourcesContent":["import type { I18nClient } from '@payloadcms/translations'\nimport type {\n  ClientCollectionConfig,\n  ClientConfig,\n  ColumnPreference,\n  SanitizedPermissions,\n} from 'payload'\n\nimport { flattenTopLevelFields } from 'payload'\nimport { fieldAffectsData } from 'payload/shared'\n\nimport { filterFieldsWithPermissions } from '../providers/TableColumns/buildColumnState/filterFieldsWithPermissions.js'\nimport { getInitialColumns } from '../providers/TableColumns/getInitialColumns.js'\n\nexport const getColumns = ({\n  clientConfig,\n  collectionConfig,\n  collectionSlug,\n  columns,\n  i18n,\n  permissions,\n}: {\n  clientConfig: ClientConfig\n  collectionConfig?: ClientCollectionConfig\n  collectionSlug: string | string[]\n  columns: ColumnPreference[]\n  i18n: I18nClient\n  permissions?: SanitizedPermissions\n}) => {\n  const isPolymorphic = Array.isArray(collectionSlug)\n\n  const fields = !isPolymorphic ? (collectionConfig?.fields ?? []) : []\n\n  if (isPolymorphic) {\n    for (const collection of collectionSlug) {\n      const clientCollectionConfig = clientConfig.collections.find(\n        (each) => each.slug === collection,\n      )\n\n      for (const field of filterFieldsWithPermissions({\n        fieldPermissions: permissions?.collections?.[collection]?.fields || true,\n        fields: clientCollectionConfig.fields,\n      })) {\n        if (fieldAffectsData(field)) {\n          if (fields.some((each) => fieldAffectsData(each) && each.name === field.name)) {\n            continue\n          }\n        }\n\n        fields.push(field)\n      }\n    }\n  }\n\n  return columns\n    ? columns?.filter((column) =>\n        flattenTopLevelFields(fields, {\n          i18n,\n          keepPresentationalFields: true,\n          moveSubFieldsToTop: true,\n        })?.some((field) => {\n          const accessor =\n            'accessor' in field ? field.accessor : 'name' in field ? field.name : undefined\n          return accessor === column.accessor\n        }),\n      )\n    : getInitialColumns(\n        isPolymorphic\n          ? fields\n          : filterFieldsWithPermissions({\n              fieldPermissions:\n                typeof collectionSlug === 'string' &&\n                permissions?.collections?.[collectionSlug]?.fields\n                  ? permissions.collections[collectionSlug].fields\n                  : true,\n              fields,\n            }),\n        collectionConfig?.admin?.useAsTitle,\n        isPolymorphic ? [] : collectionConfig?.admin?.defaultColumns,\n      )\n}\n"],"mappings":"AAQA,SAASA,qBAAqB,QAAQ;AACtC,SAASC,gBAAgB,QAAQ;AAEjC,SAASC,2BAA2B,QAAQ;AAC5C,SAASC,iBAAiB,QAAQ;AAElC,OAAO,MAAMC,UAAA,GAAaA,CAAC;EACzBC,YAAY;EACZC,gBAAgB;EAChBC,cAAc;EACdC,OAAO;EACPC,IAAI;EACJC;AAAW,CAQZ;EACC,MAAMC,aAAA,GAAgBC,KAAA,CAAMC,OAAO,CAACN,cAAA;EAEpC,MAAMO,MAAA,GAAS,CAACH,aAAA,GAAiBL,gBAAA,EAAkBQ,MAAA,IAAU,EAAE,GAAI,EAAE;EAErE,IAAIH,aAAA,EAAe;IACjB,KAAK,MAAMI,UAAA,IAAcR,cAAA,EAAgB;MACvC,MAAMS,sBAAA,GAAyBX,YAAA,CAAaY,WAAW,CAACC,IAAI,CACzDC,IAAA,IAASA,IAAA,CAAKC,IAAI,KAAKL,UAAA;MAG1B,KAAK,MAAMM,KAAA,IAASnB,2BAAA,CAA4B;QAC9CoB,gBAAA,EAAkBZ,WAAA,EAAaO,WAAA,GAAcF,UAAA,CAAW,EAAED,MAAA,IAAU;QACpEA,MAAA,EAAQE,sBAAA,CAAuBF;MACjC,IAAI;QACF,IAAIb,gBAAA,CAAiBoB,KAAA,GAAQ;UAC3B,IAAIP,MAAA,CAAOS,IAAI,CAAEJ,IAAA,IAASlB,gBAAA,CAAiBkB,IAAA,KAASA,IAAA,CAAKK,IAAI,KAAKH,KAAA,CAAMG,IAAI,GAAG;YAC7E;UACF;QACF;QAEAV,MAAA,CAAOW,IAAI,CAACJ,KAAA;MACd;IACF;EACF;EAEA,OAAOb,OAAA,GACHA,OAAA,EAASkB,MAAA,CAAQC,MAAA,IACf3B,qBAAA,CAAsBc,MAAA,EAAQ;IAC5BL,IAAA;IACAmB,wBAAA,EAA0B;IAC1BC,kBAAA,EAAoB;EACtB,IAAIN,IAAA,CAAMF,KAAA;IACR,MAAMS,QAAA,GACJ,cAAcT,KAAA,GAAQA,KAAA,CAAMS,QAAQ,GAAG,UAAUT,KAAA,GAAQA,KAAA,CAAMG,IAAI,GAAGO,SAAA;IACxE,OAAOD,QAAA,KAAaH,MAAA,CAAOG,QAAQ;EACrC,MAEF3B,iBAAA,CACEQ,aAAA,GACIG,MAAA,GACAZ,2BAAA,CAA4B;IAC1BoB,gBAAA,EACE,OAAOf,cAAA,KAAmB,YAC1BG,WAAA,EAAaO,WAAA,GAAcV,cAAA,CAAe,EAAEO,MAAA,GACxCJ,WAAA,CAAYO,WAAW,CAACV,cAAA,CAAe,CAACO,MAAM,GAC9C;IACNA;EACF,IACJR,gBAAA,EAAkB0B,KAAA,EAAOC,UAAA,EACzBtB,aAAA,GAAgB,EAAE,GAAGL,gBAAA,EAAkB0B,KAAA,EAAOE,cAAA;AAEtD","ignoreList":[]}