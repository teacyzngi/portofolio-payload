{"version":3,"file":"renderTable.js","names":["getTranslation","fieldAffectsData","fieldIsHiddenOrDisabled","React","RenderServerComponent","GroupByHeader","GroupByPageControls","OrderableTable","Pill","SelectAll","SelectionProvider","SelectRow","SortHeader","SortRow","Table","filterFieldsWithPermissions","buildColumnState","renderFilters","fields","importMap","reduce","acc","field","admin","components","Filter","set","name","Component","Map","renderTable","clientCollectionConfig","clientConfig","collectionConfig","collections","columns","customCellProps","data","enableRowSelections","fieldPermissions","groupByFieldPath","groupByValue","heading","i18n","key","orderableFieldName","payload","query","renderRowTypes","req","tableAppearance","useAsTitle","viewType","columnState","clientFields","serverFields","isPolymorphic","isGroupingBy","Boolean","groupBy","collection","find","each","slug","some","push","serverCollectionConfig","config","sharedArgs","collectionSlug","undefined","dataType","docs","columnsToUse","unshift","accessor","active","disabled","hidden","Heading","t","renderedCells","map","doc","i","_jsx","size","relationTo","labels","singular","_","rowData","className","filter","join","_jsxs","totalDocs","appearance"],"sources":["../../src/utilities/renderTable.tsx"],"sourcesContent":["import type {\n  ClientCollectionConfig,\n  ClientConfig,\n  ClientField,\n  CollectionConfig,\n  Column,\n  ColumnPreference,\n  Field,\n  ImportMap,\n  ListQuery,\n  PaginatedDocs,\n  Payload,\n  PayloadRequest,\n  SanitizedCollectionConfig,\n  SanitizedFieldsPermissions,\n  ViewTypes,\n} from 'payload'\n\nimport { getTranslation, type I18nClient } from '@payloadcms/translations'\nimport { fieldAffectsData, fieldIsHiddenOrDisabled } from 'payload/shared'\nimport React from 'react'\n\nimport type { BuildColumnStateArgs } from '../providers/TableColumns/buildColumnState/index.js'\n\nimport { RenderServerComponent } from '../elements/RenderServerComponent/index.js'\nimport {\n  GroupByHeader,\n  GroupByPageControls,\n  OrderableTable,\n  Pill,\n  SelectAll,\n  SelectionProvider,\n  SelectRow,\n  SortHeader,\n  SortRow,\n  Table,\n  // eslint-disable-next-line payload/no-imports-from-exports-dir -- these MUST reference the exports dir: https://github.com/payloadcms/payload/issues/12002#issuecomment-2791493587\n} from '../exports/client/index.js'\nimport { filterFieldsWithPermissions } from '../providers/TableColumns/buildColumnState/filterFieldsWithPermissions.js'\nimport { buildColumnState } from '../providers/TableColumns/buildColumnState/index.js'\n\nexport const renderFilters = (\n  fields: Field[],\n  importMap: ImportMap,\n): Map<string, React.ReactNode> =>\n  fields.reduce(\n    (acc, field) => {\n      if (fieldIsHiddenOrDisabled(field)) {\n        return acc\n      }\n\n      if ('name' in field && field.admin?.components?.Filter) {\n        acc.set(\n          field.name,\n          RenderServerComponent({\n            Component: field.admin.components?.Filter,\n            importMap,\n          }),\n        )\n      }\n\n      return acc\n    },\n    new Map() as Map<string, React.ReactNode>,\n  )\n\nexport const renderTable = ({\n  clientCollectionConfig,\n  clientConfig,\n  collectionConfig,\n  collections,\n  columns,\n  customCellProps,\n  data,\n  enableRowSelections,\n  fieldPermissions,\n  groupByFieldPath,\n  groupByValue,\n  heading,\n  i18n,\n  key = 'table',\n  orderableFieldName,\n  payload,\n  query,\n  renderRowTypes,\n  req,\n  tableAppearance,\n  useAsTitle,\n  viewType,\n}: {\n  clientCollectionConfig?: ClientCollectionConfig\n  clientConfig?: ClientConfig\n  collectionConfig?: SanitizedCollectionConfig\n  collections?: string[]\n  columns: ColumnPreference[]\n  customCellProps?: Record<string, unknown>\n  data?: PaginatedDocs | undefined\n  drawerSlug?: string\n  enableRowSelections: boolean\n  fieldPermissions?: SanitizedFieldsPermissions\n  groupByFieldPath?: string\n  groupByValue?: string\n  heading?: string\n  i18n: I18nClient\n  key?: string\n  orderableFieldName: string\n  payload: Payload\n  query?: ListQuery\n  renderRowTypes?: boolean\n  req?: PayloadRequest\n  tableAppearance?: 'condensed' | 'default'\n  useAsTitle: CollectionConfig['admin']['useAsTitle']\n  viewType?: ViewTypes\n}): {\n  columnState: Column[]\n  Table: React.ReactNode\n} => {\n  // Ensure that columns passed as args comply with the field config, i.e. `hidden`, `disableListColumn`, etc.\n\n  let columnState: Column[]\n  let clientFields: ClientField[] = clientCollectionConfig?.fields || []\n  let serverFields: Field[] = collectionConfig?.fields || []\n  const isPolymorphic = collections\n\n  const isGroupingBy = Boolean(collectionConfig?.admin?.groupBy && query?.groupBy)\n\n  if (isPolymorphic) {\n    clientFields = []\n    serverFields = []\n\n    for (const collection of collections) {\n      const clientCollectionConfig = clientConfig.collections.find(\n        (each) => each.slug === collection,\n      )\n\n      for (const field of filterFieldsWithPermissions({\n        fieldPermissions,\n        fields: clientCollectionConfig.fields,\n      })) {\n        if (fieldAffectsData(field)) {\n          if (clientFields.some((each) => fieldAffectsData(each) && each.name === field.name)) {\n            continue\n          }\n        }\n\n        clientFields.push(field)\n      }\n\n      const serverCollectionConfig = payload.collections[collection].config\n\n      for (const field of filterFieldsWithPermissions<Field>({\n        fieldPermissions,\n        fields: serverCollectionConfig.fields,\n      })) {\n        if (fieldAffectsData(field)) {\n          if (serverFields.some((each) => fieldAffectsData(each) && each.name === field.name)) {\n            continue\n          }\n        }\n\n        serverFields.push(field)\n      }\n    }\n  }\n\n  const sharedArgs: Pick<\n    BuildColumnStateArgs,\n    | 'clientFields'\n    | 'columns'\n    | 'customCellProps'\n    | 'enableRowSelections'\n    | 'fieldPermissions'\n    | 'i18n'\n    | 'payload'\n    | 'req'\n    | 'serverFields'\n    | 'useAsTitle'\n    | 'viewType'\n  > = {\n    clientFields,\n    columns,\n    enableRowSelections,\n    fieldPermissions,\n    i18n,\n    // sortColumnProps,\n    customCellProps,\n    payload,\n    req,\n    serverFields,\n    useAsTitle,\n    viewType,\n  }\n\n  if (isPolymorphic) {\n    columnState = buildColumnState({\n      ...sharedArgs,\n      collectionSlug: undefined,\n      dataType: 'polymorphic',\n      docs: data?.docs || [],\n    })\n  } else {\n    columnState = buildColumnState({\n      ...sharedArgs,\n      collectionSlug: clientCollectionConfig.slug,\n      dataType: 'monomorphic',\n      docs: data?.docs || [],\n    })\n  }\n\n  const columnsToUse = [...columnState]\n\n  if (renderRowTypes) {\n    columnsToUse.unshift({\n      accessor: 'collection',\n      active: true,\n      field: {\n        admin: {\n          disabled: true,\n        },\n        hidden: true,\n      },\n      Heading: i18n.t('version:type'),\n      renderedCells: (data?.docs || []).map((doc, i) => (\n        <Pill key={i} size=\"small\">\n          {getTranslation(\n            collections\n              ? payload.collections[doc.relationTo].config.labels.singular\n              : clientCollectionConfig.labels.singular,\n            i18n,\n          )}\n        </Pill>\n      )),\n    } as Column)\n  }\n\n  if (enableRowSelections) {\n    columnsToUse.unshift({\n      accessor: '_select',\n      active: true,\n      field: {\n        admin: {\n          disabled: true,\n        },\n        hidden: true,\n      },\n      Heading: <SelectAll />,\n      renderedCells: (data?.docs || []).map((_, i) => (\n        <SelectRow key={i} rowData={data?.docs[i]} />\n      )),\n    } as Column)\n  }\n\n  if (isGroupingBy) {\n    return {\n      columnState,\n      // key is required since Next.js 15.2.0 to prevent React key error\n      Table: (\n        <div\n          className={['table-wrap', groupByValue !== undefined && `table-wrap--group-by`]\n            .filter(Boolean)\n            .join(' ')}\n          key={key}\n        >\n          <SelectionProvider docs={data?.docs || []} totalDocs={data?.totalDocs || 0}>\n            <GroupByHeader\n              collectionConfig={clientCollectionConfig}\n              groupByFieldPath={groupByFieldPath}\n              groupByValue={groupByValue}\n              heading={heading}\n            />\n            <Table appearance={tableAppearance} columns={columnsToUse} data={data?.docs || []} />\n            <GroupByPageControls\n              collectionConfig={clientCollectionConfig}\n              data={data}\n              groupByValue={groupByValue}\n            />\n          </SelectionProvider>\n        </div>\n      ),\n    }\n  }\n\n  if (!orderableFieldName) {\n    return {\n      columnState,\n      // key is required since Next.js 15.2.0 to prevent React key error\n      Table: (\n        <div className=\"table-wrap\" key={key}>\n          <Table appearance={tableAppearance} columns={columnsToUse} data={data?.docs || []} />\n        </div>\n      ),\n    }\n  }\n\n  columnsToUse.unshift({\n    accessor: '_dragHandle',\n    active: true,\n    field: {\n      admin: {\n        disabled: true,\n      },\n      hidden: true,\n    },\n    Heading: <SortHeader />,\n    renderedCells: (data?.docs || []).map((_, i) => <SortRow key={i} />),\n  } as Column)\n\n  return {\n    columnState,\n    // key is required since Next.js 15.2.0 to prevent React key error\n    Table: (\n      <div className=\"table-wrap\" key={key}>\n        <OrderableTable\n          appearance={tableAppearance}\n          collection={clientCollectionConfig}\n          columns={columnsToUse}\n          data={data?.docs || []}\n        />\n      </div>\n    ),\n  }\n}\n"],"mappings":"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","ignoreList":[]}