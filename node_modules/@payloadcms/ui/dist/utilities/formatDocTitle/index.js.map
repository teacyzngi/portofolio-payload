{"version":3,"file":"index.js","names":["getTranslation","formatDate","formatLexicalDocTitle","isSerializedLexicalEditor","formatRelationshipTitle","formatDocTitle","collectionConfig","data","dateFormat","dateFormatFromConfig","fallback","globalConfig","i18n","title","useAsTitle","admin","fieldConfig","fields","find","f","name","isDate","type","isRelationship","date","displayFormat","pattern","formattedRelationshipTitle","label","slug","root","children","t"],"sources":["../../../src/utilities/formatDocTitle/index.ts"],"sourcesContent":["import type { I18n } from '@payloadcms/translations'\nimport type {\n  ClientCollectionConfig,\n  ClientGlobalConfig,\n  SanitizedConfig,\n  TypeWithID,\n} from 'payload'\n\nimport { getTranslation } from '@payloadcms/translations'\n\nimport { formatDate } from './formatDateTitle.js'\nimport { formatLexicalDocTitle, isSerializedLexicalEditor } from './formatLexicalDocTitle.js'\nimport { formatRelationshipTitle } from './formatRelationshipTitle.js'\n\nexport const formatDocTitle = ({\n  collectionConfig,\n  data,\n  dateFormat: dateFormatFromConfig,\n  fallback,\n  globalConfig,\n  i18n,\n}: {\n  collectionConfig?: ClientCollectionConfig\n  data: TypeWithID\n  dateFormat: SanitizedConfig['admin']['dateFormat']\n  fallback?: object | string\n  globalConfig?: ClientGlobalConfig\n  i18n: I18n<any, any>\n}): string => {\n  let title: string\n\n  if (collectionConfig) {\n    const useAsTitle = collectionConfig?.admin?.useAsTitle\n\n    if (useAsTitle) {\n      title = data?.[useAsTitle] as string\n\n      if (title) {\n        const fieldConfig = collectionConfig.fields.find(\n          (f) => 'name' in f && f.name === useAsTitle,\n        )\n\n        const isDate = fieldConfig?.type === 'date'\n        const isRelationship = fieldConfig?.type === 'relationship'\n\n        if (isDate) {\n          const dateFormat =\n            ('date' in fieldConfig.admin && fieldConfig?.admin?.date?.displayFormat) ||\n            dateFormatFromConfig\n\n          title = formatDate({ date: title, i18n, pattern: dateFormat }) || title\n        }\n\n        if (isRelationship) {\n          const formattedRelationshipTitle = formatRelationshipTitle(data[useAsTitle])\n          title = formattedRelationshipTitle\n        }\n      }\n    }\n  }\n\n  if (globalConfig) {\n    title = getTranslation(globalConfig?.label, i18n) || globalConfig?.slug\n  }\n\n  // richtext lexical case. We convert the first child of root to plain text\n  if (title && isSerializedLexicalEditor(title)) {\n    title = formatLexicalDocTitle(title.root.children?.[0]?.children || [], '')\n  }\n\n  if (!title && isSerializedLexicalEditor(fallback)) {\n    title = formatLexicalDocTitle(fallback.root.children?.[0]?.children || [], '')\n  }\n\n  if (!title) {\n    title = typeof fallback === 'string' ? fallback : `[${i18n.t('general:untitled')}]`\n  }\n\n  return title\n}\n"],"mappings":"AAQA,SAASA,cAAc,QAAQ;AAE/B,SAASC,UAAU,QAAQ;AAC3B,SAASC,qBAAqB,EAAEC,yBAAyB,QAAQ;AACjE,SAASC,uBAAuB,QAAQ;AAExC,OAAO,MAAMC,cAAA,GAAiBA,CAAC;EAC7BC,gBAAgB;EAChBC,IAAI;EACJC,UAAA,EAAYC,oBAAoB;EAChCC,QAAQ;EACRC,YAAY;EACZC;AAAI,CAQL;EACC,IAAIC,KAAA;EAEJ,IAAIP,gBAAA,EAAkB;IACpB,MAAMQ,UAAA,GAAaR,gBAAA,EAAkBS,KAAA,EAAOD,UAAA;IAE5C,IAAIA,UAAA,EAAY;MACdD,KAAA,GAAQN,IAAA,GAAOO,UAAA,CAAW;MAE1B,IAAID,KAAA,EAAO;QACT,MAAMG,WAAA,GAAcV,gBAAA,CAAiBW,MAAM,CAACC,IAAI,CAC7CC,CAAA,IAAM,UAAUA,CAAA,IAAKA,CAAA,CAAEC,IAAI,KAAKN,UAAA;QAGnC,MAAMO,MAAA,GAASL,WAAA,EAAaM,IAAA,KAAS;QACrC,MAAMC,cAAA,GAAiBP,WAAA,EAAaM,IAAA,KAAS;QAE7C,IAAID,MAAA,EAAQ;UACV,MAAMb,UAAA,GACJ,MAAC,IAAUQ,WAAA,CAAYD,KAAK,IAAIC,WAAA,EAAaD,KAAA,EAAOS,IAAA,EAAMC,aAAA,IAC1DhB,oBAAA;UAEFI,KAAA,GAAQZ,UAAA,CAAW;YAAEuB,IAAA,EAAMX,KAAA;YAAOD,IAAA;YAAMc,OAAA,EAASlB;UAAW,MAAMK,KAAA;QACpE;QAEA,IAAIU,cAAA,EAAgB;UAClB,MAAMI,0BAAA,GAA6BvB,uBAAA,CAAwBG,IAAI,CAACO,UAAA,CAAW;UAC3ED,KAAA,GAAQc,0BAAA;QACV;MACF;IACF;EACF;EAEA,IAAIhB,YAAA,EAAc;IAChBE,KAAA,GAAQb,cAAA,CAAeW,YAAA,EAAciB,KAAA,EAAOhB,IAAA,KAASD,YAAA,EAAckB,IAAA;EACrE;EAEA;EACA,IAAIhB,KAAA,IAASV,yBAAA,CAA0BU,KAAA,GAAQ;IAC7CA,KAAA,GAAQX,qBAAA,CAAsBW,KAAA,CAAMiB,IAAI,CAACC,QAAQ,GAAG,EAAE,EAAEA,QAAA,IAAY,EAAE,EAAE;EAC1E;EAEA,IAAI,CAAClB,KAAA,IAASV,yBAAA,CAA0BO,QAAA,GAAW;IACjDG,KAAA,GAAQX,qBAAA,CAAsBQ,QAAA,CAASoB,IAAI,CAACC,QAAQ,GAAG,EAAE,EAAEA,QAAA,IAAY,EAAE,EAAE;EAC7E;EAEA,IAAI,CAAClB,KAAA,EAAO;IACVA,KAAA,GAAQ,OAAOH,QAAA,KAAa,WAAWA,QAAA,GAAW,IAAIE,IAAA,CAAKoB,CAAC,CAAC,sBAAsB;EACrF;EAEA,OAAOnB,KAAA;AACT","ignoreList":[]}