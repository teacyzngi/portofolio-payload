{"version":3,"file":"schedulePublishHandler.js","names":["canAccessAdmin","schedulePublishHandler","type","date","deleteID","doc","global","locale","req","timezone","i18n","payload","user","delete","collection","where","id","equals","jobs","queue","input","task","waitUntil","err","error","value","relationTo","logger","message","t"],"sources":["../../src/utilities/schedulePublishHandler.ts"],"sourcesContent":["import { canAccessAdmin, type PayloadRequest, type SchedulePublishTaskInput } from 'payload'\n\nexport type SchedulePublishHandlerArgs = {\n  date?: Date\n  /**\n   * The job id to delete to remove a scheduled publish event\n   */\n  deleteID?: number | string\n  req: PayloadRequest\n  timezone?: string\n} & SchedulePublishTaskInput\n\nexport const schedulePublishHandler = async ({\n  type,\n  date,\n  deleteID,\n  doc,\n  global,\n  locale,\n  req,\n  timezone,\n}: SchedulePublishHandlerArgs) => {\n  const { i18n, payload, user } = req\n\n  await canAccessAdmin({ req })\n\n  try {\n    if (deleteID) {\n      await payload.delete({\n        collection: 'payload-jobs',\n        req,\n        where: { id: { equals: deleteID } },\n      })\n    }\n\n    await payload.jobs.queue({\n      input: {\n        type,\n        doc,\n        global,\n        locale,\n        timezone,\n        user: user.id,\n      },\n      task: 'schedulePublish',\n      waitUntil: date,\n    })\n  } catch (err) {\n    let error\n\n    if (deleteID) {\n      error = `Error deleting scheduled publish event with ID ${deleteID}`\n    } else {\n      error = `Error scheduling ${type} for `\n      if (doc) {\n        error += `document with ID ${doc.value} in collection ${doc.relationTo}`\n      }\n    }\n\n    payload.logger.error(error)\n    payload.logger.error(err)\n\n    return {\n      error,\n    }\n  }\n\n  return { message: i18n.t('general:success') }\n}\n"],"mappings":"AAAA,SAASA,cAAc,QAA4D;AAYnF,OAAO,MAAMC,sBAAA,GAAyB,MAAAA,CAAO;EAC3CC,IAAI;EACJC,IAAI;EACJC,QAAQ;EACRC,GAAG;EACHC,MAAM;EACNC,MAAM;EACNC,GAAG;EACHC;AAAQ,CACmB;EAC3B,MAAM;IAAEC,IAAI;IAAEC,OAAO;IAAEC;EAAI,CAAE,GAAGJ,GAAA;EAEhC,MAAMR,cAAA,CAAe;IAAEQ;EAAI;EAE3B,IAAI;IACF,IAAIJ,QAAA,EAAU;MACZ,MAAMO,OAAA,CAAQE,MAAM,CAAC;QACnBC,UAAA,EAAY;QACZN,GAAA;QACAO,KAAA,EAAO;UAAEC,EAAA,EAAI;YAAEC,MAAA,EAAQb;UAAS;QAAE;MACpC;IACF;IAEA,MAAMO,OAAA,CAAQO,IAAI,CAACC,KAAK,CAAC;MACvBC,KAAA,EAAO;QACLlB,IAAA;QACAG,GAAA;QACAC,MAAA;QACAC,MAAA;QACAE,QAAA;QACAG,IAAA,EAAMA,IAAA,CAAKI;MACb;MACAK,IAAA,EAAM;MACNC,SAAA,EAAWnB;IACb;EACF,EAAE,OAAOoB,GAAA,EAAK;IACZ,IAAIC,KAAA;IAEJ,IAAIpB,QAAA,EAAU;MACZoB,KAAA,GAAQ,kDAAkDpB,QAAA,EAAU;IACtE,OAAO;MACLoB,KAAA,GAAQ,oBAAoBtB,IAAA,OAAW;MACvC,IAAIG,GAAA,EAAK;QACPmB,KAAA,IAAS,oBAAoBnB,GAAA,CAAIoB,KAAK,kBAAkBpB,GAAA,CAAIqB,UAAU,EAAE;MAC1E;IACF;IAEAf,OAAA,CAAQgB,MAAM,CAACH,KAAK,CAACA,KAAA;IACrBb,OAAA,CAAQgB,MAAM,CAACH,KAAK,CAACD,GAAA;IAErB,OAAO;MACLC;IACF;EACF;EAEA,OAAO;IAAEI,OAAA,EAASlB,IAAA,CAAKmB,CAAC,CAAC;EAAmB;AAC9C","ignoreList":[]}