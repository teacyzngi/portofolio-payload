{"version":3,"file":"optionsReducer.js","names":["getTranslation","reduceToIDs","options","reduce","ids","option","id","optionsReducer","state","action","type","collection","data","hasMultipleRelations","i18n","relation","labelKey","admin","useAsTitle","loadedIDs","docs","doc","indexOf","push","label","value","newOptions","optionsToAddTo","find","optionGroup","labels","plural","newSubOptions","relationTo","undefined","required","t"],"sources":["../../../../../src/elements/WhereBuilder/Condition/Relationship/optionsReducer.ts"],"sourcesContent":["'use client'\nimport { getTranslation } from '@payloadcms/translations'\n\nimport type { Action, Option } from './types.js'\n\nconst reduceToIDs = (options) =>\n  options.reduce((ids, option) => {\n    if (option.options) {\n      return [...ids, ...reduceToIDs(option.options)]\n    }\n\n    return [...ids, option.id]\n  }, [])\n\nconst optionsReducer = (state: Option[], action: Action): Option[] => {\n  switch (action.type) {\n    case 'ADD': {\n      const { collection, data, hasMultipleRelations, i18n, relation } = action\n\n      const labelKey = collection.admin.useAsTitle || 'id'\n\n      const loadedIDs = reduceToIDs(state)\n\n      if (!hasMultipleRelations) {\n        return [\n          ...state,\n          ...data.docs.reduce((docs, doc) => {\n            if (loadedIDs.indexOf(doc.id) === -1) {\n              loadedIDs.push(doc.id)\n              return [\n                ...docs,\n                {\n                  label: doc[labelKey],\n                  value: doc.id,\n                },\n              ]\n            }\n            return docs\n          }, []),\n        ]\n      }\n\n      const newOptions = [...state]\n      const optionsToAddTo = newOptions.find(\n        (optionGroup) => optionGroup.label === getTranslation(collection.labels.plural, i18n),\n      )\n\n      const newSubOptions = data.docs.reduce((docs, doc) => {\n        if (loadedIDs.indexOf(doc.id) === -1) {\n          loadedIDs.push(doc.id)\n\n          return [\n            ...docs,\n            {\n              label: doc[labelKey],\n              relationTo: relation,\n              value: doc.id,\n            },\n          ]\n        }\n\n        return docs\n      }, [])\n\n      if (optionsToAddTo) {\n        optionsToAddTo.options = [...optionsToAddTo.options, ...newSubOptions]\n      } else {\n        newOptions.push({\n          label: getTranslation(collection.labels.plural, i18n),\n          options: newSubOptions,\n          value: undefined,\n        })\n      }\n\n      return newOptions\n    }\n\n    case 'CLEAR': {\n      return action.required ? [] : [{ label: action.i18n.t('general:none'), value: 'null' }]\n    }\n\n    default: {\n      return state\n    }\n  }\n}\n\nexport default optionsReducer\n"],"mappings":"AAAA;;AACA,SAASA,cAAc,QAAQ;AAI/B,MAAMC,WAAA,GAAeC,OAAA,IACnBA,OAAA,CAAQC,MAAM,CAAC,CAACC,GAAA,EAAKC,MAAA;EACnB,IAAIA,MAAA,CAAOH,OAAO,EAAE;IAClB,OAAO,C,GAAIE,GAAA,E,GAAQH,WAAA,CAAYI,MAAA,CAAOH,OAAO,EAAE;EACjD;EAEA,OAAO,C,GAAIE,GAAA,EAAKC,MAAA,CAAOC,EAAE,CAAC;AAC5B,GAAG,EAAE;AAEP,MAAMC,cAAA,GAAiBA,CAACC,KAAA,EAAiBC,MAAA;EACvC,QAAQA,MAAA,CAAOC,IAAI;IACjB,KAAK;MAAO;QACV,MAAM;UAAEC,UAAU;UAAEC,IAAI;UAAEC,oBAAoB;UAAEC,IAAI;UAAEC;QAAQ,CAAE,GAAGN,MAAA;QAEnE,MAAMO,QAAA,GAAWL,UAAA,CAAWM,KAAK,CAACC,UAAU,IAAI;QAEhD,MAAMC,SAAA,GAAYlB,WAAA,CAAYO,KAAA;QAE9B,IAAI,CAACK,oBAAA,EAAsB;UACzB,OAAO,C,GACFL,KAAA,E,GACAI,IAAA,CAAKQ,IAAI,CAACjB,MAAM,CAAC,CAACiB,IAAA,EAAMC,GAAA;YACzB,IAAIF,SAAA,CAAUG,OAAO,CAACD,GAAA,CAAIf,EAAE,MAAM,CAAC,GAAG;cACpCa,SAAA,CAAUI,IAAI,CAACF,GAAA,CAAIf,EAAE;cACrB,OAAO,C,GACFc,IAAA,EACH;gBACEI,KAAA,EAAOH,GAAG,CAACL,QAAA,CAAS;gBACpBS,KAAA,EAAOJ,GAAA,CAAIf;cACb,EACD;YACH;YACA,OAAOc,IAAA;UACT,GAAG,EAAE,EACN;QACH;QAEA,MAAMM,UAAA,GAAa,C,GAAIlB,KAAA,CAAM;QAC7B,MAAMmB,cAAA,GAAiBD,UAAA,CAAWE,IAAI,CACnCC,WAAA,IAAgBA,WAAA,CAAYL,KAAK,KAAKxB,cAAA,CAAeW,UAAA,CAAWmB,MAAM,CAACC,MAAM,EAAEjB,IAAA;QAGlF,MAAMkB,aAAA,GAAgBpB,IAAA,CAAKQ,IAAI,CAACjB,MAAM,CAAC,CAACiB,IAAA,EAAMC,GAAA;UAC5C,IAAIF,SAAA,CAAUG,OAAO,CAACD,GAAA,CAAIf,EAAE,MAAM,CAAC,GAAG;YACpCa,SAAA,CAAUI,IAAI,CAACF,GAAA,CAAIf,EAAE;YAErB,OAAO,C,GACFc,IAAA,EACH;cACEI,KAAA,EAAOH,GAAG,CAACL,QAAA,CAAS;cACpBiB,UAAA,EAAYlB,QAAA;cACZU,KAAA,EAAOJ,GAAA,CAAIf;YACb,EACD;UACH;UAEA,OAAOc,IAAA;QACT,GAAG,EAAE;QAEL,IAAIO,cAAA,EAAgB;UAClBA,cAAA,CAAezB,OAAO,GAAG,C,GAAIyB,cAAA,CAAezB,OAAO,E,GAAK8B,aAAA,CAAc;QACxE,OAAO;UACLN,UAAA,CAAWH,IAAI,CAAC;YACdC,KAAA,EAAOxB,cAAA,CAAeW,UAAA,CAAWmB,MAAM,CAACC,MAAM,EAAEjB,IAAA;YAChDZ,OAAA,EAAS8B,aAAA;YACTP,KAAA,EAAOS;UACT;QACF;QAEA,OAAOR,UAAA;MACT;IAEA,KAAK;MAAS;QACZ,OAAOjB,MAAA,CAAO0B,QAAQ,GAAG,EAAE,GAAG,CAAC;UAAEX,KAAA,EAAOf,MAAA,CAAOK,IAAI,CAACsB,CAAC,CAAC;UAAiBX,KAAA,EAAO;QAAO,EAAE;MACzF;IAEA;MAAS;QACP,OAAOjB,KAAA;MACT;EACF;AACF;AAEA,eAAeD,cAAA","ignoreList":[]}