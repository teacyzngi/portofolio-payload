{"version":3,"file":"createFormData.js","names":["serialize","reduceFieldsToValues","createFormData","formState","overrides","collectionSlug","uploadHandler","data","file","filename","name","clientUploadContext","updateFilename","value","JSON","stringify","mimeType","type","size","dataWithOverrides","dataToSerialize","_payload","indices","nullsAsUndefineds"],"sources":["../../../../src/elements/BulkUpload/FormsManager/createFormData.ts"],"sourcesContent":["import type { CollectionSlug, FormState } from 'payload'\n\nimport { serialize } from 'object-to-formdata'\nimport { reduceFieldsToValues } from 'payload/shared'\n\nimport type { UploadHandlersContext } from '../../../providers/UploadHandlers/index.js'\n\nexport async function createFormData(\n  formState: FormState = {},\n  overrides: Record<string, any> = {},\n  collectionSlug: CollectionSlug,\n  uploadHandler: ReturnType<UploadHandlersContext['getUploadHandler']>,\n) {\n  const data = reduceFieldsToValues(formState, true)\n  let file = data?.file\n\n  if (file) {\n    delete data.file\n  }\n\n  if (file && typeof uploadHandler === 'function') {\n    let filename = file.name\n\n    const clientUploadContext = await uploadHandler({\n      file,\n      updateFilename: (value) => {\n        filename = value\n      },\n    })\n\n    file = JSON.stringify({\n      clientUploadContext,\n      collectionSlug,\n      filename,\n      mimeType: file.type,\n      size: file.size,\n    })\n  }\n\n  const dataWithOverrides = {\n    ...data,\n    ...overrides,\n  }\n\n  const dataToSerialize = {\n    _payload: JSON.stringify(dataWithOverrides),\n    file,\n  }\n\n  return serialize(dataToSerialize, { indices: true, nullsAsUndefineds: false })\n}\n"],"mappings":"AAEA,SAASA,SAAS,QAAQ;AAC1B,SAASC,oBAAoB,QAAQ;AAIrC,OAAO,eAAeC,eACpBC,SAAA,GAAuB,CAAC,CAAC,EACzBC,SAAA,GAAiC,CAAC,CAAC,EACnCC,cAA8B,EAC9BC,aAAoE;EAEpE,MAAMC,IAAA,GAAON,oBAAA,CAAqBE,SAAA,EAAW;EAC7C,IAAIK,IAAA,GAAOD,IAAA,EAAMC,IAAA;EAEjB,IAAIA,IAAA,EAAM;IACR,OAAOD,IAAA,CAAKC,IAAI;EAClB;EAEA,IAAIA,IAAA,IAAQ,OAAOF,aAAA,KAAkB,YAAY;IAC/C,IAAIG,QAAA,GAAWD,IAAA,CAAKE,IAAI;IAExB,MAAMC,mBAAA,GAAsB,MAAML,aAAA,CAAc;MAC9CE,IAAA;MACAI,cAAA,EAAiBC,KAAA;QACfJ,QAAA,GAAWI,KAAA;MACb;IACF;IAEAL,IAAA,GAAOM,IAAA,CAAKC,SAAS,CAAC;MACpBJ,mBAAA;MACAN,cAAA;MACAI,QAAA;MACAO,QAAA,EAAUR,IAAA,CAAKS,IAAI;MACnBC,IAAA,EAAMV,IAAA,CAAKU;IACb;EACF;EAEA,MAAMC,iBAAA,GAAoB;IACxB,GAAGZ,IAAI;IACP,GAAGH;EACL;EAEA,MAAMgB,eAAA,GAAkB;IACtBC,QAAA,EAAUP,IAAA,CAAKC,SAAS,CAACI,iBAAA;IACzBX;EACF;EAEA,OAAOR,SAAA,CAAUoB,eAAA,EAAiB;IAAEE,OAAA,EAAS;IAAMC,iBAAA,EAAmB;EAAM;AAC9E","ignoreList":[]}