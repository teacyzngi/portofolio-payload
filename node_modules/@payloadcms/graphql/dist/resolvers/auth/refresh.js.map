{"version":3,"sources":["../../../src/resolvers/auth/refresh.ts"],"sourcesContent":["import type { Collection } from 'payload'\n\nimport { generatePayloadCookie, isolateObjectProperty, refreshOperation } from 'payload'\n\nimport type { Context } from '../types.js'\n\nexport function refresh(collection: Collection): any {\n  async function resolver(_, __, context: Context) {\n    const options = {\n      collection,\n      depth: 0,\n      req: isolateObjectProperty(context.req, 'transactionID'),\n    }\n\n    const result = await refreshOperation(options)\n    const cookie = generatePayloadCookie({\n      collectionAuthConfig: collection.config.auth,\n      cookiePrefix: context.req.payload.config.cookiePrefix,\n      token: result.refreshedToken,\n    })\n    context.headers['Set-Cookie'] = cookie\n\n    if (collection.config.auth.removeTokenFromResponses) {\n      delete result.refreshedToken\n    }\n\n    return result\n  }\n\n  return resolver\n}\n"],"names":["generatePayloadCookie","isolateObjectProperty","refreshOperation","refresh","collection","resolver","_","__","context","options","depth","req","result","cookie","collectionAuthConfig","config","auth","cookiePrefix","payload","token","refreshedToken","headers","removeTokenFromResponses"],"mappings":"AAEA,SAASA,qBAAqB,EAAEC,qBAAqB,EAAEC,gBAAgB,QAAQ,UAAS;AAIxF,OAAO,SAASC,QAAQC,UAAsB;IAC5C,eAAeC,SAASC,CAAC,EAAEC,EAAE,EAAEC,OAAgB;QAC7C,MAAMC,UAAU;YACdL;YACAM,OAAO;YACPC,KAAKV,sBAAsBO,QAAQG,GAAG,EAAE;QAC1C;QAEA,MAAMC,SAAS,MAAMV,iBAAiBO;QACtC,MAAMI,SAASb,sBAAsB;YACnCc,sBAAsBV,WAAWW,MAAM,CAACC,IAAI;YAC5CC,cAAcT,QAAQG,GAAG,CAACO,OAAO,CAACH,MAAM,CAACE,YAAY;YACrDE,OAAOP,OAAOQ,cAAc;QAC9B;QACAZ,QAAQa,OAAO,CAAC,aAAa,GAAGR;QAEhC,IAAIT,WAAWW,MAAM,CAACC,IAAI,CAACM,wBAAwB,EAAE;YACnD,OAAOV,OAAOQ,cAAc;QAC9B;QAEA,OAAOR;IACT;IAEA,OAAOP;AACT"}