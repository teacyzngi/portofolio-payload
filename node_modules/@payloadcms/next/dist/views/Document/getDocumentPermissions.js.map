{"version":3,"file":"getDocumentPermissions.js","names":["hasSavePermission","getHasSavePermission","isEditing","getIsEditing","docAccessOperation","docAccessOperationGlobal","logError","getDocumentPermissions","args","id","collectionConfig","data","globalConfig","req","docPermissions","hasPublishPermission","collection","config","_status","versions","drafts","then","permissions","update","err","payload","collectionSlug","slug","globalSlug"],"sources":["../../../src/views/Document/getDocumentPermissions.tsx"],"sourcesContent":["import type {\n  Data,\n  PayloadRequest,\n  SanitizedCollectionConfig,\n  SanitizedDocumentPermissions,\n  SanitizedGlobalConfig,\n} from 'payload'\n\nimport {\n  hasSavePermission as getHasSavePermission,\n  isEditing as getIsEditing,\n} from '@payloadcms/ui/shared'\nimport { docAccessOperation, docAccessOperationGlobal, logError } from 'payload'\n\nexport const getDocumentPermissions = async (args: {\n  collectionConfig?: SanitizedCollectionConfig\n  data: Data\n  globalConfig?: SanitizedGlobalConfig\n  id?: number | string\n  req: PayloadRequest\n}): Promise<{\n  docPermissions: SanitizedDocumentPermissions\n  hasPublishPermission: boolean\n  hasSavePermission: boolean\n}> => {\n  const { id, collectionConfig, data = {}, globalConfig, req } = args\n\n  let docPermissions: SanitizedDocumentPermissions\n  let hasPublishPermission = false\n\n  if (collectionConfig) {\n    try {\n      docPermissions = await docAccessOperation({\n        id,\n        collection: {\n          config: collectionConfig,\n        },\n        req: {\n          ...req,\n          data: {\n            ...data,\n            _status: 'draft',\n          },\n        },\n      })\n\n      if (collectionConfig.versions?.drafts) {\n        hasPublishPermission = await docAccessOperation({\n          id,\n          collection: {\n            config: collectionConfig,\n          },\n          req: {\n            ...req,\n            data: {\n              ...data,\n              _status: 'published',\n            },\n          },\n        }).then((permissions) => permissions.update)\n      }\n    } catch (err) {\n      logError({ err, payload: req.payload })\n    }\n  }\n\n  if (globalConfig) {\n    try {\n      docPermissions = await docAccessOperationGlobal({\n        globalConfig,\n        req: {\n          ...req,\n          data,\n        },\n      })\n\n      if (globalConfig.versions?.drafts) {\n        hasPublishPermission = await docAccessOperationGlobal({\n          globalConfig,\n          req: {\n            ...req,\n            data: {\n              ...data,\n              _status: 'published',\n            },\n          },\n        }).then((permissions) => permissions.update)\n      }\n    } catch (err) {\n      logError({ err, payload: req.payload })\n    }\n  }\n\n  const hasSavePermission = getHasSavePermission({\n    collectionSlug: collectionConfig?.slug,\n    docPermissions,\n    globalSlug: globalConfig?.slug,\n    isEditing: getIsEditing({\n      id,\n      collectionSlug: collectionConfig?.slug,\n      globalSlug: globalConfig?.slug,\n    }),\n  })\n\n  return {\n    docPermissions,\n    hasPublishPermission,\n    hasSavePermission,\n  }\n}\n"],"mappings":"AAQA,SACEA,iBAAA,IAAqBC,oBAAoB,EACzCC,SAAA,IAAaC,YAAY,QACpB;AACP,SAASC,kBAAkB,EAAEC,wBAAwB,EAAEC,QAAQ,QAAQ;AAEvE,OAAO,MAAMC,sBAAA,GAAyB,MAAOC,IAAA;EAW3C,MAAM;IAAEC,EAAE;IAAEC,gBAAgB;IAAEC,IAAA,GAAO,CAAC,CAAC;IAAEC,YAAY;IAAEC;EAAG,CAAE,GAAGL,IAAA;EAE/D,IAAIM,cAAA;EACJ,IAAIC,oBAAA,GAAuB;EAE3B,IAAIL,gBAAA,EAAkB;IACpB,IAAI;MACFI,cAAA,GAAiB,MAAMV,kBAAA,CAAmB;QACxCK,EAAA;QACAO,UAAA,EAAY;UACVC,MAAA,EAAQP;QACV;QACAG,GAAA,EAAK;UACH,GAAGA,GAAG;UACNF,IAAA,EAAM;YACJ,GAAGA,IAAI;YACPO,OAAA,EAAS;UACX;QACF;MACF;MAEA,IAAIR,gBAAA,CAAiBS,QAAQ,EAAEC,MAAA,EAAQ;QACrCL,oBAAA,GAAuB,MAAMX,kBAAA,CAAmB;UAC9CK,EAAA;UACAO,UAAA,EAAY;YACVC,MAAA,EAAQP;UACV;UACAG,GAAA,EAAK;YACH,GAAGA,GAAG;YACNF,IAAA,EAAM;cACJ,GAAGA,IAAI;cACPO,OAAA,EAAS;YACX;UACF;QACF,GAAGG,IAAI,CAAEC,WAAA,IAAgBA,WAAA,CAAYC,MAAM;MAC7C;IACF,EAAE,OAAOC,GAAA,EAAK;MACZlB,QAAA,CAAS;QAAEkB,GAAA;QAAKC,OAAA,EAASZ,GAAA,CAAIY;MAAQ;IACvC;EACF;EAEA,IAAIb,YAAA,EAAc;IAChB,IAAI;MACFE,cAAA,GAAiB,MAAMT,wBAAA,CAAyB;QAC9CO,YAAA;QACAC,GAAA,EAAK;UACH,GAAGA,GAAG;UACNF;QACF;MACF;MAEA,IAAIC,YAAA,CAAaO,QAAQ,EAAEC,MAAA,EAAQ;QACjCL,oBAAA,GAAuB,MAAMV,wBAAA,CAAyB;UACpDO,YAAA;UACAC,GAAA,EAAK;YACH,GAAGA,GAAG;YACNF,IAAA,EAAM;cACJ,GAAGA,IAAI;cACPO,OAAA,EAAS;YACX;UACF;QACF,GAAGG,IAAI,CAAEC,WAAA,IAAgBA,WAAA,CAAYC,MAAM;MAC7C;IACF,EAAE,OAAOC,GAAA,EAAK;MACZlB,QAAA,CAAS;QAAEkB,GAAA;QAAKC,OAAA,EAASZ,GAAA,CAAIY;MAAQ;IACvC;EACF;EAEA,MAAMzB,iBAAA,GAAoBC,oBAAA,CAAqB;IAC7CyB,cAAA,EAAgBhB,gBAAA,EAAkBiB,IAAA;IAClCb,cAAA;IACAc,UAAA,EAAYhB,YAAA,EAAce,IAAA;IAC1BzB,SAAA,EAAWC,YAAA,CAAa;MACtBM,EAAA;MACAiB,cAAA,EAAgBhB,gBAAA,EAAkBiB,IAAA;MAClCC,UAAA,EAAYhB,YAAA,EAAce;IAC5B;EACF;EAEA,OAAO;IACLb,cAAA;IACAC,oBAAA;IACAf;EACF;AACF","ignoreList":[]}