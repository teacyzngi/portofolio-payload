{"version":3,"file":"renderDocumentSlots.js","names":["ViewDescription","RenderServerComponent","getDocumentPermissions","renderDocumentSlots","args","id","collectionConfig","globalConfig","hasSavePermission","req","components","unsavedDraftWithValidations","undefined","isPreviewEnabled","admin","preview","serverProps","i18n","payload","user","BeforeDocumentControls","edit","beforeDocumentControls","elements","Component","importMap","EditMenuItems","editMenuItems","CustomPreviewButton","PreviewButton","LivePreview","views","livePreview","descriptionFromConfig","description","staticDescription","t","CustomDescription","Description","hasDescription","clientProps","collectionSlug","slug","Fallback","versions","drafts","CustomPublishButton","PublishButton","CustomSaveDraftButton","SaveDraftButton","draftsEnabled","autosave","CustomSaveButton","SaveButton","upload","Upload","controls","UploadControls","renderDocumentSlotsHandler","collections","config","Error","docPermissions","data","permissions"],"sources":["../../../src/views/Document/renderDocumentSlots.tsx"],"sourcesContent":["import type {\n  BeforeDocumentControlsServerPropsOnly,\n  DocumentSlots,\n  EditMenuItemsServerPropsOnly,\n  PayloadRequest,\n  PreviewButtonServerPropsOnly,\n  PublishButtonServerPropsOnly,\n  SanitizedCollectionConfig,\n  SanitizedDocumentPermissions,\n  SanitizedGlobalConfig,\n  SaveButtonServerPropsOnly,\n  SaveDraftButtonServerPropsOnly,\n  ServerFunction,\n  ServerProps,\n  StaticDescription,\n  ViewDescriptionClientProps,\n  ViewDescriptionServerPropsOnly,\n} from 'payload'\n\nimport { ViewDescription } from '@payloadcms/ui'\nimport { RenderServerComponent } from '@payloadcms/ui/elements/RenderServerComponent'\n\nimport { getDocumentPermissions } from './getDocumentPermissions.js'\n\nexport const renderDocumentSlots: (args: {\n  collectionConfig?: SanitizedCollectionConfig\n  globalConfig?: SanitizedGlobalConfig\n  hasSavePermission: boolean\n  id?: number | string\n  permissions: SanitizedDocumentPermissions\n  req: PayloadRequest\n}) => DocumentSlots = (args) => {\n  const { id, collectionConfig, globalConfig, hasSavePermission, req } = args\n\n  const components: DocumentSlots = {} as DocumentSlots\n\n  const unsavedDraftWithValidations = undefined\n\n  const isPreviewEnabled = collectionConfig?.admin?.preview || globalConfig?.admin?.preview\n\n  const serverProps: ServerProps = {\n    id,\n    i18n: req.i18n,\n    payload: req.payload,\n    user: req.user,\n    // TODO: Add remaining serverProps\n  }\n\n  const BeforeDocumentControls =\n    collectionConfig?.admin?.components?.edit?.beforeDocumentControls ||\n    globalConfig?.admin?.components?.elements?.beforeDocumentControls\n\n  if (BeforeDocumentControls) {\n    components.BeforeDocumentControls = RenderServerComponent({\n      Component: BeforeDocumentControls,\n      importMap: req.payload.importMap,\n      serverProps: serverProps satisfies BeforeDocumentControlsServerPropsOnly,\n    })\n  }\n\n  const EditMenuItems = collectionConfig?.admin?.components?.edit?.editMenuItems\n\n  if (EditMenuItems) {\n    components.EditMenuItems = RenderServerComponent({\n      Component: EditMenuItems,\n      importMap: req.payload.importMap,\n      serverProps: serverProps satisfies EditMenuItemsServerPropsOnly,\n    })\n  }\n\n  const CustomPreviewButton =\n    collectionConfig?.admin?.components?.edit?.PreviewButton ||\n    globalConfig?.admin?.components?.elements?.PreviewButton\n\n  if (isPreviewEnabled && CustomPreviewButton) {\n    components.PreviewButton = RenderServerComponent({\n      Component: CustomPreviewButton,\n      importMap: req.payload.importMap,\n      serverProps: serverProps satisfies PreviewButtonServerPropsOnly,\n    })\n  }\n\n  const LivePreview =\n    collectionConfig?.admin?.components?.views?.edit?.livePreview ||\n    globalConfig?.admin?.components?.views?.edit?.livePreview\n\n  if (LivePreview?.Component) {\n    components.LivePreview = RenderServerComponent({\n      Component: LivePreview.Component,\n      importMap: req.payload.importMap,\n      serverProps,\n    })\n  }\n\n  const descriptionFromConfig =\n    collectionConfig?.admin?.description || globalConfig?.admin?.description\n\n  const staticDescription: StaticDescription =\n    typeof descriptionFromConfig === 'function'\n      ? descriptionFromConfig({ t: req.i18n.t })\n      : descriptionFromConfig\n\n  const CustomDescription =\n    collectionConfig?.admin?.components?.Description ||\n    globalConfig?.admin?.components?.elements?.Description\n\n  const hasDescription = CustomDescription || staticDescription\n\n  if (hasDescription) {\n    components.Description = RenderServerComponent({\n      clientProps: {\n        collectionSlug: collectionConfig?.slug,\n        description: staticDescription,\n      } satisfies ViewDescriptionClientProps,\n      Component: CustomDescription,\n      Fallback: ViewDescription,\n      importMap: req.payload.importMap,\n      serverProps: serverProps satisfies ViewDescriptionServerPropsOnly,\n    })\n  }\n\n  if (hasSavePermission) {\n    if (collectionConfig?.versions?.drafts || globalConfig?.versions?.drafts) {\n      const CustomPublishButton =\n        collectionConfig?.admin?.components?.edit?.PublishButton ||\n        globalConfig?.admin?.components?.elements?.PublishButton\n\n      if (CustomPublishButton) {\n        components.PublishButton = RenderServerComponent({\n          Component: CustomPublishButton,\n          importMap: req.payload.importMap,\n          serverProps: serverProps satisfies PublishButtonServerPropsOnly,\n        })\n      }\n\n      const CustomSaveDraftButton =\n        collectionConfig?.admin?.components?.edit?.SaveDraftButton ||\n        globalConfig?.admin?.components?.elements?.SaveDraftButton\n\n      const draftsEnabled =\n        (collectionConfig?.versions?.drafts && !collectionConfig?.versions?.drafts?.autosave) ||\n        (globalConfig?.versions?.drafts && !globalConfig?.versions?.drafts?.autosave)\n\n      if ((draftsEnabled || unsavedDraftWithValidations) && CustomSaveDraftButton) {\n        components.SaveDraftButton = RenderServerComponent({\n          Component: CustomSaveDraftButton,\n          importMap: req.payload.importMap,\n          serverProps: serverProps satisfies SaveDraftButtonServerPropsOnly,\n        })\n      }\n    } else {\n      const CustomSaveButton =\n        collectionConfig?.admin?.components?.edit?.SaveButton ||\n        globalConfig?.admin?.components?.elements?.SaveButton\n\n      if (CustomSaveButton) {\n        components.SaveButton = RenderServerComponent({\n          Component: CustomSaveButton,\n          importMap: req.payload.importMap,\n          serverProps: serverProps satisfies SaveButtonServerPropsOnly,\n        })\n      }\n    }\n  }\n\n  if (collectionConfig?.upload && collectionConfig?.admin?.components?.edit?.Upload) {\n    components.Upload = RenderServerComponent({\n      Component: collectionConfig.admin.components.edit.Upload,\n      importMap: req.payload.importMap,\n      serverProps,\n    })\n  }\n\n  if (collectionConfig?.upload && collectionConfig.upload.admin?.components?.controls) {\n    components.UploadControls = RenderServerComponent({\n      Component: collectionConfig.upload.admin.components.controls,\n      importMap: req.payload.importMap,\n      serverProps,\n    })\n  }\n\n  return components\n}\n\nexport const renderDocumentSlotsHandler: ServerFunction<{\n  collectionSlug: string\n  id?: number | string\n}> = async (args) => {\n  const { id, collectionSlug, req } = args\n\n  const collectionConfig = req.payload.collections[collectionSlug]?.config\n\n  if (!collectionConfig) {\n    throw new Error(req.t('error:incorrectCollection'))\n  }\n\n  const { docPermissions, hasSavePermission } = await getDocumentPermissions({\n    collectionConfig,\n    data: {},\n    req,\n  })\n\n  return renderDocumentSlots({\n    id,\n    collectionConfig,\n    hasSavePermission,\n    permissions: docPermissions,\n    req,\n  })\n}\n"],"mappings":"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","ignoreList":[]}