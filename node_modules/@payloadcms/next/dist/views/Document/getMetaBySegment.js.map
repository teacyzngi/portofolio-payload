{"version":3,"file":"getMetaBySegment.js","names":["getNextRequestI18n","generateAPIViewMetadata","generateEditViewMetadata","generateNotFoundViewMetadata","generateVersionViewMetadata","generateVersionsViewMetadata","getDocumentView","getMetaBySegment","collectionConfig","config","globalConfig","params","segments","fn","segmentOne","isCollection","isGlobal","isEditing","Boolean","length","args","isReadOnly","i18n","viewKey","docPermissions","create","delete","fields","read","readVersions","update","routeSegments","customViewConfig","admin","components","views","edit","view"],"sources":["../../../src/views/Document/getMetaBySegment.tsx"],"sourcesContent":["import type { Metadata } from 'next'\nimport type { EditConfig, SanitizedCollectionConfig, SanitizedGlobalConfig } from 'payload'\n\nimport type { GenerateViewMetadata } from '../Root/index.js'\n\nimport { getNextRequestI18n } from '../../utilities/getNextRequestI18n.js'\nimport { generateAPIViewMetadata } from '../API/metadata.js'\nimport { generateEditViewMetadata } from '../Edit/metadata.js'\nimport { generateNotFoundViewMetadata } from '../NotFound/metadata.js'\nimport { generateVersionViewMetadata } from '../Version/metadata.js'\nimport { generateVersionsViewMetadata } from '../Versions/metadata.js'\nimport { getDocumentView } from './getDocumentView.js'\n\nexport type GenerateEditViewMetadata = (\n  args: {\n    collectionConfig?: null | SanitizedCollectionConfig\n    globalConfig?: null | SanitizedGlobalConfig\n    isReadOnly?: boolean\n    view?: keyof EditConfig\n  } & Parameters<GenerateViewMetadata>[0],\n) => Promise<Metadata>\n\nexport const getMetaBySegment: GenerateEditViewMetadata = async ({\n  collectionConfig,\n  config,\n  globalConfig,\n  params,\n}) => {\n  const { segments } = params\n\n  let fn: GenerateEditViewMetadata | null = null\n\n  const [segmentOne] = segments\n  const isCollection = segmentOne === 'collections'\n  const isGlobal = segmentOne === 'globals'\n\n  const isEditing =\n    isGlobal || Boolean(isCollection && segments?.length > 2 && segments[2] !== 'create')\n\n  if (isCollection) {\n    // `/:collection/:id`\n    if (params.segments.length === 3) {\n      fn = generateEditViewMetadata\n    }\n\n    // `/collections/:collection/trash/:id`\n    if (segments.length === 4 && segments[2] === 'trash') {\n      fn = (args) => generateEditViewMetadata({ ...args, isReadOnly: true })\n    }\n\n    // `/:collection/:id/:view`\n    if (params.segments.length === 4) {\n      switch (params.segments[3]) {\n        case 'api':\n          // `/:collection/:id/api`\n          fn = generateAPIViewMetadata\n          break\n        case 'versions':\n          // `/:collection/:id/versions`\n          fn = generateVersionsViewMetadata\n          break\n        default:\n          break\n      }\n    }\n\n    // `/:collection/:id/:slug-1/:slug-2`\n    if (params.segments.length === 5) {\n      switch (params.segments[3]) {\n        case 'versions':\n          // `/:collection/:id/versions/:version`\n          fn = generateVersionViewMetadata\n          break\n        default:\n          break\n      }\n    }\n\n    // `/collections/:collection/trash/:id/:view`\n    if (segments.length === 5 && segments[2] === 'trash') {\n      switch (segments[4]) {\n        case 'api':\n          fn = generateAPIViewMetadata\n          break\n        case 'versions':\n          fn = generateVersionsViewMetadata\n          break\n        default:\n          break\n      }\n    }\n\n    // `/collections/:collection/trash/:id/versions/:versionID`\n    if (segments.length === 6 && segments[2] === 'trash' && segments[4] === 'versions') {\n      fn = generateVersionViewMetadata\n    }\n  }\n\n  if (isGlobal) {\n    // `/:global`\n    if (params.segments?.length === 2) {\n      fn = generateEditViewMetadata\n    }\n\n    // `/:global/:view`\n    if (params.segments?.length === 3) {\n      switch (params.segments[2]) {\n        case 'api':\n          // `/:global/api`\n          fn = generateAPIViewMetadata\n          break\n        case 'versions':\n          // `/:global/versions`\n          fn = generateVersionsViewMetadata\n          break\n        default:\n          break\n      }\n    }\n\n    // `/:global/versions/:version`\n    if (params.segments?.length === 4 && params.segments[2] === 'versions') {\n      fn = generateVersionViewMetadata\n    }\n  }\n\n  const i18n = await getNextRequestI18n({\n    config,\n  })\n\n  if (typeof fn === 'function') {\n    return fn({\n      collectionConfig,\n      config,\n      globalConfig,\n      i18n,\n      isEditing,\n    })\n  } else {\n    const { viewKey } = getDocumentView({\n      collectionConfig,\n      config,\n      docPermissions: {\n        create: true,\n        delete: true,\n        fields: true,\n        read: true,\n        readVersions: true,\n        update: true,\n      },\n      globalConfig,\n      routeSegments: typeof segments === 'string' ? [segments] : segments,\n    })\n\n    if (viewKey) {\n      const customViewConfig =\n        collectionConfig?.admin?.components?.views?.edit?.[viewKey] ||\n        globalConfig?.admin?.components?.views?.edit?.[viewKey]\n\n      if (customViewConfig) {\n        return generateEditViewMetadata({\n          collectionConfig,\n          config,\n          globalConfig,\n          i18n,\n          isEditing,\n          view: viewKey as keyof EditConfig,\n        })\n      }\n    }\n  }\n\n  return generateNotFoundViewMetadata({ config, i18n })\n}\n"],"mappings":"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","ignoreList":[]}