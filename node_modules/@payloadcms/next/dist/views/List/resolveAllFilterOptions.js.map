{"version":3,"file":"resolveAllFilterOptions.js","names":["resolveFilterOptions","fieldAffectsData","fieldHasSubFields","fieldIsHiddenOrDisabled","tabHasName","resolveAllFilterOptions","fields","pathPrefix","req","result","resolvedFilterOptions","Map","Promise","all","map","field","fieldPath","name","type","filterOptions","options","id","undefined","blockData","data","relationTo","siblingData","user","set","tabs","tab","tabPath"],"sources":["../../../src/views/List/resolveAllFilterOptions.ts"],"sourcesContent":["import type { Field, PayloadRequest, ResolvedFilterOptions } from 'payload'\n\nimport { resolveFilterOptions } from '@payloadcms/ui/rsc'\nimport {\n  fieldAffectsData,\n  fieldHasSubFields,\n  fieldIsHiddenOrDisabled,\n  tabHasName,\n} from 'payload/shared'\n\nexport const resolveAllFilterOptions = async ({\n  fields,\n  pathPrefix,\n  req,\n  result,\n}: {\n  fields: Field[]\n  pathPrefix?: string\n  req: PayloadRequest\n  result?: Map<string, ResolvedFilterOptions>\n}): Promise<Map<string, ResolvedFilterOptions>> => {\n  const resolvedFilterOptions = !result ? new Map<string, ResolvedFilterOptions>() : result\n\n  await Promise.all(\n    fields.map(async (field) => {\n      if (fieldIsHiddenOrDisabled(field)) {\n        return\n      }\n\n      const fieldPath = fieldAffectsData(field)\n        ? pathPrefix\n          ? `${pathPrefix}.${field.name}`\n          : field.name\n        : pathPrefix\n\n      if (\n        (field.type === 'relationship' || field.type === 'upload') &&\n        'filterOptions' in field &&\n        field.filterOptions\n      ) {\n        const options = await resolveFilterOptions(field.filterOptions, {\n          id: undefined,\n          blockData: undefined,\n          data: {}, // use empty object to prevent breaking queries when accessing properties of `data`\n          relationTo: field.relationTo,\n          req,\n          siblingData: {}, // use empty object to prevent breaking queries when accessing properties of `siblingData`\n          user: req.user,\n        })\n\n        resolvedFilterOptions.set(fieldPath, options)\n      }\n\n      if (fieldHasSubFields(field)) {\n        await resolveAllFilterOptions({\n          fields: field.fields,\n          pathPrefix: fieldPath,\n          req,\n          result: resolvedFilterOptions,\n        })\n      }\n\n      if (field.type === 'tabs') {\n        await Promise.all(\n          field.tabs.map(async (tab) => {\n            const tabPath = tabHasName(tab)\n              ? fieldPath\n                ? `${fieldPath}.${tab.name}`\n                : tab.name\n              : fieldPath\n\n            await resolveAllFilterOptions({\n              fields: tab.fields,\n              pathPrefix: tabPath,\n              req,\n              result: resolvedFilterOptions,\n            })\n          }),\n        )\n      }\n    }),\n  )\n\n  return resolvedFilterOptions\n}\n"],"mappings":"AAEA,SAASA,oBAAoB,QAAQ;AACrC,SACEC,gBAAgB,EAChBC,iBAAiB,EACjBC,uBAAuB,EACvBC,UAAU,QACL;AAEP,OAAO,MAAMC,uBAAA,GAA0B,MAAAA,CAAO;EAC5CC,MAAM;EACNC,UAAU;EACVC,GAAG;EACHC;AAAM,CAMP;EACC,MAAMC,qBAAA,GAAwB,CAACD,MAAA,GAAS,IAAIE,GAAA,KAAuCF,MAAA;EAEnF,MAAMG,OAAA,CAAQC,GAAG,CACfP,MAAA,CAAOQ,GAAG,CAAC,MAAOC,KAAA;IAChB,IAAIZ,uBAAA,CAAwBY,KAAA,GAAQ;MAClC;IACF;IAEA,MAAMC,SAAA,GAAYf,gBAAA,CAAiBc,KAAA,IAC/BR,UAAA,GACE,GAAGA,UAAA,IAAcQ,KAAA,CAAME,IAAI,EAAE,GAC7BF,KAAA,CAAME,IAAI,GACZV,UAAA;IAEJ,IACE,CAACQ,KAAA,CAAMG,IAAI,KAAK,kBAAkBH,KAAA,CAAMG,IAAI,KAAK,QAAO,KACxD,mBAAmBH,KAAA,IACnBA,KAAA,CAAMI,aAAa,EACnB;MACA,MAAMC,OAAA,GAAU,MAAMpB,oBAAA,CAAqBe,KAAA,CAAMI,aAAa,EAAE;QAC9DE,EAAA,EAAIC,SAAA;QACJC,SAAA,EAAWD,SAAA;QACXE,IAAA,EAAM,CAAC;QACPC,UAAA,EAAYV,KAAA,CAAMU,UAAU;QAC5BjB,GAAA;QACAkB,WAAA,EAAa,CAAC;QACdC,IAAA,EAAMnB,GAAA,CAAImB;MACZ;MAEAjB,qBAAA,CAAsBkB,GAAG,CAACZ,SAAA,EAAWI,OAAA;IACvC;IAEA,IAAIlB,iBAAA,CAAkBa,KAAA,GAAQ;MAC5B,MAAMV,uBAAA,CAAwB;QAC5BC,MAAA,EAAQS,KAAA,CAAMT,MAAM;QACpBC,UAAA,EAAYS,SAAA;QACZR,GAAA;QACAC,MAAA,EAAQC;MACV;IACF;IAEA,IAAIK,KAAA,CAAMG,IAAI,KAAK,QAAQ;MACzB,MAAMN,OAAA,CAAQC,GAAG,CACfE,KAAA,CAAMc,IAAI,CAACf,GAAG,CAAC,MAAOgB,GAAA;QACpB,MAAMC,OAAA,GAAU3B,UAAA,CAAW0B,GAAA,IACvBd,SAAA,GACE,GAAGA,SAAA,IAAac,GAAA,CAAIb,IAAI,EAAE,GAC1Ba,GAAA,CAAIb,IAAI,GACVD,SAAA;QAEJ,MAAMX,uBAAA,CAAwB;UAC5BC,MAAA,EAAQwB,GAAA,CAAIxB,MAAM;UAClBC,UAAA,EAAYwB,OAAA;UACZvB,GAAA;UACAC,MAAA,EAAQC;QACV;MACF;IAEJ;EACF;EAGF,OAAOA,qBAAA;AACT","ignoreList":[]}