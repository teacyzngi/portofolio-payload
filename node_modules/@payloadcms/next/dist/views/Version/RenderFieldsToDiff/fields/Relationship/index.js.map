{"version":3,"file":"index.js","names":["getTranslation","FieldDiffContainer","getHTMLDiffComponents","React","generateLabelFromValue","baseClass","Relationship","comparisonValue","valueFrom","field","i18n","locale","nestingLevel","parentIsLocalized","req","versionValue","valueTo","hasMany","polymorphic","Array","isArray","relationTo","_jsx","ManyRelationshipDiff","SingleRelationshipDiff","args","ReactDOMServer","default","FromComponent","RelationshipDocumentDiff","showPill","value","ToComponent","fromHTML","renderToStaticMarkup","toHTML","diff","tokenizeByCharacter","className","From","label","To","fromArr","toArr","makeNodes","list","map","val","idx","fromNodes","length","toNodes","localeToUse","payload","config","localization","defaultLocale","title","pillLabel","collectionConfig","collections","labels","singular","slug","_jsxs","id"],"sources":["../../../../../../src/views/Version/RenderFieldsToDiff/fields/Relationship/index.tsx"],"sourcesContent":["import type {\n  PayloadRequest,\n  RelationshipField,\n  RelationshipFieldDiffServerComponent,\n  TypeWithID,\n} from 'payload'\n\nimport { getTranslation, type I18nClient } from '@payloadcms/translations'\nimport { FieldDiffContainer, getHTMLDiffComponents } from '@payloadcms/ui/rsc'\n\nimport './index.scss'\n\nimport React from 'react'\n\nimport { generateLabelFromValue } from './generateLabelFromValue.js'\n\nconst baseClass = 'relationship-diff'\n\nexport type RelationshipValue =\n  | { relationTo: string; value: number | string | TypeWithID }\n  | (number | string | TypeWithID)\n\nexport const Relationship: RelationshipFieldDiffServerComponent = ({\n  comparisonValue: valueFrom,\n  field,\n  i18n,\n  locale,\n  nestingLevel,\n  parentIsLocalized,\n  req,\n  versionValue: valueTo,\n}) => {\n  const hasMany = 'hasMany' in field && field.hasMany\n  const polymorphic = Array.isArray(field.relationTo)\n\n  if (hasMany) {\n    return (\n      <ManyRelationshipDiff\n        field={field}\n        i18n={i18n}\n        locale={locale}\n        nestingLevel={nestingLevel}\n        parentIsLocalized={parentIsLocalized}\n        polymorphic={polymorphic}\n        req={req}\n        valueFrom={valueFrom as RelationshipValue[] | undefined}\n        valueTo={valueTo as RelationshipValue[] | undefined}\n      />\n    )\n  }\n\n  return (\n    <SingleRelationshipDiff\n      field={field}\n      i18n={i18n}\n      locale={locale}\n      nestingLevel={nestingLevel}\n      parentIsLocalized={parentIsLocalized}\n      polymorphic={polymorphic}\n      req={req}\n      valueFrom={valueFrom as RelationshipValue}\n      valueTo={valueTo as RelationshipValue}\n    />\n  )\n}\n\nexport const SingleRelationshipDiff: React.FC<{\n  field: RelationshipField\n  i18n: I18nClient\n  locale: string\n  nestingLevel?: number\n  parentIsLocalized: boolean\n  polymorphic: boolean\n  req: PayloadRequest\n  valueFrom: RelationshipValue\n  valueTo: RelationshipValue\n}> = async (args) => {\n  const {\n    field,\n    i18n,\n    locale,\n    nestingLevel,\n    parentIsLocalized,\n    polymorphic,\n    req,\n    valueFrom,\n    valueTo,\n  } = args\n\n  const ReactDOMServer = (await import('react-dom/server')).default\n\n  const FromComponent = valueFrom ? (\n    <RelationshipDocumentDiff\n      field={field}\n      i18n={i18n}\n      locale={locale}\n      parentIsLocalized={parentIsLocalized}\n      polymorphic={polymorphic}\n      relationTo={\n        polymorphic\n          ? (valueFrom as { relationTo: string; value: TypeWithID }).relationTo\n          : (field.relationTo as string)\n      }\n      req={req}\n      showPill={true}\n      value={valueFrom}\n    />\n  ) : null\n  const ToComponent = valueTo ? (\n    <RelationshipDocumentDiff\n      field={field}\n      i18n={i18n}\n      locale={locale}\n      parentIsLocalized={parentIsLocalized}\n      polymorphic={polymorphic}\n      relationTo={\n        polymorphic\n          ? (valueTo as { relationTo: string; value: TypeWithID }).relationTo\n          : (field.relationTo as string)\n      }\n      req={req}\n      showPill={true}\n      value={valueTo}\n    />\n  ) : null\n\n  const fromHTML = FromComponent ? ReactDOMServer.renderToStaticMarkup(FromComponent) : `<p></p>`\n  const toHTML = ToComponent ? ReactDOMServer.renderToStaticMarkup(ToComponent) : `<p></p>`\n\n  const diff = getHTMLDiffComponents({\n    fromHTML,\n    toHTML,\n    tokenizeByCharacter: false,\n  })\n\n  return (\n    <FieldDiffContainer\n      className={`${baseClass}-container ${baseClass}-container--hasOne`}\n      From={diff.From}\n      i18n={i18n}\n      label={{ label: field.label, locale }}\n      nestingLevel={nestingLevel}\n      To={diff.To}\n    />\n  )\n}\n\nconst ManyRelationshipDiff: React.FC<{\n  field: RelationshipField\n  i18n: I18nClient\n  locale: string\n  nestingLevel?: number\n  parentIsLocalized: boolean\n  polymorphic: boolean\n  req: PayloadRequest\n  valueFrom: RelationshipValue[] | undefined\n  valueTo: RelationshipValue[] | undefined\n}> = async ({\n  field,\n  i18n,\n  locale,\n  nestingLevel,\n  parentIsLocalized,\n  polymorphic,\n  req,\n  valueFrom,\n  valueTo,\n}) => {\n  const ReactDOMServer = (await import('react-dom/server')).default\n\n  const fromArr = Array.isArray(valueFrom) ? valueFrom : []\n  const toArr = Array.isArray(valueTo) ? valueTo : []\n\n  const makeNodes = (list: RelationshipValue[]) =>\n    list.map((val, idx) => (\n      <RelationshipDocumentDiff\n        field={field}\n        i18n={i18n}\n        key={idx}\n        locale={locale}\n        parentIsLocalized={parentIsLocalized}\n        polymorphic={polymorphic}\n        relationTo={\n          polymorphic\n            ? (val as { relationTo: string; value: TypeWithID }).relationTo\n            : (field.relationTo as string)\n        }\n        req={req}\n        showPill={polymorphic}\n        value={val}\n      />\n    ))\n\n  const fromNodes =\n    fromArr.length > 0 ? makeNodes(fromArr) : <p className={`${baseClass}__empty`}></p>\n\n  const toNodes = toArr.length > 0 ? makeNodes(toArr) : <p className={`${baseClass}__empty`}></p>\n\n  const fromHTML = ReactDOMServer.renderToStaticMarkup(fromNodes)\n  const toHTML = ReactDOMServer.renderToStaticMarkup(toNodes)\n\n  const diff = getHTMLDiffComponents({\n    fromHTML,\n    toHTML,\n    tokenizeByCharacter: false,\n  })\n\n  return (\n    <FieldDiffContainer\n      className={`${baseClass}-container ${baseClass}-container--hasMany`}\n      From={diff.From}\n      i18n={i18n}\n      label={{ label: field.label, locale }}\n      nestingLevel={nestingLevel}\n      To={diff.To}\n    />\n  )\n}\n\nconst RelationshipDocumentDiff = ({\n  field,\n  i18n,\n  locale,\n  parentIsLocalized,\n  polymorphic,\n  relationTo,\n  req,\n  showPill = false,\n  value,\n}: {\n  field: RelationshipField\n  i18n: I18nClient\n  locale: string\n  parentIsLocalized: boolean\n  polymorphic: boolean\n  relationTo: string\n  req: PayloadRequest\n  showPill?: boolean\n  value: RelationshipValue\n}) => {\n  const localeToUse =\n    locale ??\n    (req.payload.config?.localization && req.payload.config?.localization?.defaultLocale) ??\n    'en'\n\n  const title = generateLabelFromValue({\n    field,\n    locale: localeToUse,\n    parentIsLocalized,\n    req,\n    value,\n  })\n\n  let pillLabel: null | string = null\n  if (showPill) {\n    const collectionConfig = req.payload.collections[relationTo].config\n    pillLabel = collectionConfig.labels?.singular\n      ? getTranslation(collectionConfig.labels.singular, i18n)\n      : collectionConfig.slug\n  }\n\n  return (\n    <div\n      className={`${baseClass}`}\n      data-enable-match=\"true\"\n      data-id={\n        polymorphic\n          ? (value as { relationTo: string; value: TypeWithID }).value.id\n          : (value as TypeWithID).id\n      }\n      data-relation-to={relationTo}\n    >\n      {pillLabel && (\n        <span className={`${baseClass}__pill`} data-enable-match=\"false\">\n          {pillLabel}\n        </span>\n      )}\n      <strong className={`${baseClass}__info`} data-enable-match=\"false\">\n        {title}\n      </strong>\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}