{"version":3,"file":"index.js","names":["getTranslation","FieldDiffContainer","File","getHTMLDiffComponents","React","baseClass","Upload","args","comparisonValue","valueFrom","field","i18n","locale","nestingLevel","req","versionValue","valueTo","hasMany","Array","isArray","_jsx","HasManyUploadDiff","SingleUploadDiff","ReactDOMServer","default","From","To","showCollectionSlug","relationTo","FromComponents","map","uploadDoc","UploadDocumentDiff","id","ToComponents","diffResult","fromHTML","component","renderToStaticMarkup","join","toHTML","tokenizeByCharacter","className","label","FromComponent","ToComponent","fromHtml","toHtml","thumbnailSRC","thumbnailURL","url","filename","t","pillLabel","uploadConfig","payload","collections","config","labels","singular","slug","_jsxs","length","alt","src"],"sources":["../../../../../../src/views/Version/RenderFieldsToDiff/fields/Upload/index.tsx"],"sourcesContent":["import type {\n  FileData,\n  PayloadRequest,\n  TypeWithID,\n  UploadField,\n  UploadFieldDiffServerComponent,\n} from 'payload'\n\nimport { getTranslation, type I18nClient } from '@payloadcms/translations'\nimport { FieldDiffContainer, File, getHTMLDiffComponents } from '@payloadcms/ui/rsc'\n\nimport './index.scss'\n\nimport React from 'react'\n\nconst baseClass = 'upload-diff'\n\ntype UploadDoc = (FileData & TypeWithID) | string\n\nexport const Upload: UploadFieldDiffServerComponent = (args) => {\n  const {\n    comparisonValue: valueFrom,\n    field,\n    i18n,\n    locale,\n    nestingLevel,\n    req,\n    versionValue: valueTo,\n  } = args\n\n  if ('hasMany' in field && field.hasMany && Array.isArray(valueTo)) {\n    return (\n      <HasManyUploadDiff\n        field={field}\n        i18n={i18n}\n        locale={locale}\n        nestingLevel={nestingLevel}\n        req={req}\n        valueFrom={valueFrom as UploadDoc[]}\n        valueTo={valueTo as UploadDoc[]}\n      />\n    )\n  }\n\n  return (\n    <SingleUploadDiff\n      field={field}\n      i18n={i18n}\n      locale={locale}\n      nestingLevel={nestingLevel}\n      req={req}\n      valueFrom={valueFrom as UploadDoc}\n      valueTo={valueTo as UploadDoc}\n    />\n  )\n}\n\nexport const HasManyUploadDiff: React.FC<{\n  field: UploadField\n  i18n: I18nClient\n  locale: string\n  nestingLevel?: number\n  req: PayloadRequest\n  valueFrom: Array<UploadDoc>\n  valueTo: Array<UploadDoc>\n}> = async (args) => {\n  const { field, i18n, locale, nestingLevel, req, valueFrom, valueTo } = args\n  const ReactDOMServer = (await import('react-dom/server')).default\n\n  let From: React.ReactNode = ''\n  let To: React.ReactNode = ''\n\n  const showCollectionSlug = Array.isArray(field.relationTo)\n\n  const FromComponents = valueFrom\n    ? valueFrom.map((uploadDoc) => (\n        <UploadDocumentDiff\n          i18n={i18n}\n          key={typeof uploadDoc === 'object' ? uploadDoc.id : uploadDoc}\n          relationTo={field.relationTo}\n          req={req}\n          showCollectionSlug={showCollectionSlug}\n          uploadDoc={uploadDoc}\n        />\n      ))\n    : null\n  const ToComponents = valueTo\n    ? valueTo.map((uploadDoc) => (\n        <UploadDocumentDiff\n          i18n={i18n}\n          key={typeof uploadDoc === 'object' ? uploadDoc.id : uploadDoc}\n          relationTo={field.relationTo}\n          req={req}\n          showCollectionSlug={showCollectionSlug}\n          uploadDoc={uploadDoc}\n        />\n      ))\n    : null\n\n  const diffResult = getHTMLDiffComponents({\n    fromHTML:\n      `<div class=\"${baseClass}-hasMany\">` +\n      (FromComponents\n        ? FromComponents.map(\n            (component) => `<div>${ReactDOMServer.renderToStaticMarkup(component)}</div>`,\n          ).join('')\n        : '') +\n      '</div>',\n    toHTML:\n      `<div class=\"${baseClass}-hasMany\">` +\n      (ToComponents\n        ? ToComponents.map(\n            (component) => `<div>${ReactDOMServer.renderToStaticMarkup(component)}</div>`,\n          ).join('')\n        : '') +\n      '</div>',\n    tokenizeByCharacter: false,\n  })\n  From = diffResult.From\n  To = diffResult.To\n\n  return (\n    <FieldDiffContainer\n      className={`${baseClass}-container ${baseClass}-container--hasMany`}\n      From={From}\n      i18n={i18n}\n      label={{\n        label: field.label,\n        locale,\n      }}\n      nestingLevel={nestingLevel}\n      To={To}\n    />\n  )\n}\n\nexport const SingleUploadDiff: React.FC<{\n  field: UploadField\n  i18n: I18nClient\n  locale: string\n  nestingLevel?: number\n  req: PayloadRequest\n  valueFrom: UploadDoc\n  valueTo: UploadDoc\n}> = async (args) => {\n  const { field, i18n, locale, nestingLevel, req, valueFrom, valueTo } = args\n\n  const ReactDOMServer = (await import('react-dom/server')).default\n\n  let From: React.ReactNode = ''\n  let To: React.ReactNode = ''\n\n  const showCollectionSlug = Array.isArray(field.relationTo)\n\n  const FromComponent = valueFrom ? (\n    <UploadDocumentDiff\n      i18n={i18n}\n      relationTo={field.relationTo}\n      req={req}\n      showCollectionSlug={showCollectionSlug}\n      uploadDoc={valueFrom}\n    />\n  ) : null\n  const ToComponent = valueTo ? (\n    <UploadDocumentDiff\n      i18n={i18n}\n      relationTo={field.relationTo}\n      req={req}\n      showCollectionSlug={showCollectionSlug}\n      uploadDoc={valueTo}\n    />\n  ) : null\n\n  const fromHtml = FromComponent\n    ? ReactDOMServer.renderToStaticMarkup(FromComponent)\n    : '<p>' + '' + '</p>'\n  const toHtml = ToComponent\n    ? ReactDOMServer.renderToStaticMarkup(ToComponent)\n    : '<p>' + '' + '</p>'\n\n  const diffResult = getHTMLDiffComponents({\n    fromHTML: fromHtml,\n    toHTML: toHtml,\n    tokenizeByCharacter: false,\n  })\n  From = diffResult.From\n  To = diffResult.To\n\n  return (\n    <FieldDiffContainer\n      className={`${baseClass}-container ${baseClass}-container--hasOne`}\n      From={From}\n      i18n={i18n}\n      label={{\n        label: field.label,\n        locale,\n      }}\n      nestingLevel={nestingLevel}\n      To={To}\n    />\n  )\n}\n\nconst UploadDocumentDiff = (args: {\n  i18n: I18nClient\n  relationTo: string\n  req: PayloadRequest\n  showCollectionSlug?: boolean\n  uploadDoc: UploadDoc\n}) => {\n  const { i18n, relationTo, req, showCollectionSlug, uploadDoc } = args\n\n  let thumbnailSRC: string = ''\n  if (uploadDoc && typeof uploadDoc === 'object' && 'thumbnailURL' in uploadDoc) {\n    thumbnailSRC =\n      (typeof uploadDoc.thumbnailURL === 'string' && uploadDoc.thumbnailURL) ||\n      (typeof uploadDoc.url === 'string' && uploadDoc.url) ||\n      ''\n  }\n\n  let filename: string\n  if (uploadDoc && typeof uploadDoc === 'object') {\n    filename = uploadDoc.filename\n  } else {\n    filename = `${i18n.t('general:untitled')} - ID: ${uploadDoc as number | string}`\n  }\n\n  let pillLabel: null | string = null\n\n  if (showCollectionSlug) {\n    const uploadConfig = req.payload.collections[relationTo].config\n    pillLabel = uploadConfig.labels?.singular\n      ? getTranslation(uploadConfig.labels.singular, i18n)\n      : uploadConfig.slug\n  }\n\n  return (\n    <div\n      className={`${baseClass}`}\n      data-enable-match=\"true\"\n      data-id={typeof uploadDoc === 'object' ? uploadDoc?.id : uploadDoc}\n      data-relation-to={relationTo}\n    >\n      <div className={`${baseClass}__card`}>\n        <div className={`${baseClass}__thumbnail`}>\n          {thumbnailSRC?.length ? <img alt={filename} src={thumbnailSRC} /> : <File />}\n        </div>\n        {pillLabel && (\n          <div className={`${baseClass}__pill`} data-enable-match=\"false\">\n            <span>{pillLabel}</span>\n          </div>\n        )}\n        <div className={`${baseClass}__info`} data-enable-match=\"false\">\n          <strong>{filename}</strong>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}