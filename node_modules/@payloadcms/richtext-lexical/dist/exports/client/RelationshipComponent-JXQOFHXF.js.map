{
  "version": 3,
  "sources": ["../../../src/features/relationship/client/components/RelationshipComponent.tsx"],
  "sourcesContent": ["'use client'\nimport type { ElementFormatType } from 'lexical'\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext.js'\nimport { useLexicalEditable } from '@lexical/react/useLexicalEditable'\nimport { getTranslation } from '@payloadcms/translations'\nimport { Button, useConfig, usePayloadAPI, useTranslation } from '@payloadcms/ui'\nimport { $getNodeByKey } from 'lexical'\nimport React, { useCallback, useReducer, useRef, useState } from 'react'\n\nimport type { RelationshipData } from '../../server/nodes/RelationshipNode.js'\n\nimport { useLexicalDocumentDrawer } from '../../../../utilities/fieldsDrawer/useLexicalDocumentDrawer.js'\nimport './index.scss'\nimport { INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND } from '../drawer/commands.js'\n\nconst baseClass = 'lexical-relationship'\n\nconst initialParams = {\n  depth: 0,\n}\n\ntype Props = {\n  className?: string\n  data: RelationshipData\n  format?: ElementFormatType\n  nodeKey?: string\n}\n\nexport const RelationshipComponent: React.FC<Props> = (props) => {\n  const {\n    data: { relationTo, value },\n    nodeKey,\n  } = props\n\n  if (typeof value === 'object') {\n    throw new Error(\n      'Relationship value should be a string or number. The Lexical Relationship component should not receive the populated value object.',\n    )\n  }\n\n  const relationshipElemRef = useRef<HTMLDivElement | null>(null)\n\n  const [editor] = useLexicalComposerContext()\n  const isEditable = useLexicalEditable()\n  const {\n    config: {\n      routes: { api },\n      serverURL,\n    },\n    getEntityConfig,\n  } = useConfig()\n\n  const [relatedCollection] = useState(() => getEntityConfig({ collectionSlug: relationTo }))\n\n  const { i18n, t } = useTranslation()\n  const [cacheBust, dispatchCacheBust] = useReducer((state) => state + 1, 0)\n  const [{ data }, { setParams }] = usePayloadAPI(\n    `${serverURL}${api}/${relatedCollection.slug}/${value}`,\n    { initialParams },\n  )\n\n  const { closeDocumentDrawer, DocumentDrawer, DocumentDrawerToggler } = useLexicalDocumentDrawer({\n    id: value,\n    collectionSlug: relatedCollection.slug,\n  })\n\n  const removeRelationship = useCallback(() => {\n    editor.update(() => {\n      $getNodeByKey(nodeKey!)?.remove()\n    })\n  }, [editor, nodeKey])\n\n  const updateRelationship = React.useCallback(() => {\n    setParams({\n      ...initialParams,\n      cacheBust, // do this to get the usePayloadAPI to re-fetch the data even though the URL string hasn't changed\n    })\n\n    closeDocumentDrawer()\n    dispatchCacheBust()\n  }, [cacheBust, setParams, closeDocumentDrawer])\n\n  return (\n    <div className={baseClass} contentEditable={false} ref={relationshipElemRef}>\n      <div className={`${baseClass}__wrap`}>\n        <p className={`${baseClass}__label`}>\n          {t('fields:labelRelationship', {\n            label: relatedCollection.labels?.singular\n              ? getTranslation(relatedCollection.labels?.singular, i18n)\n              : relatedCollection.slug,\n          })}\n        </p>\n        <DocumentDrawerToggler className={`${baseClass}__doc-drawer-toggler`}>\n          <p className={`${baseClass}__title`}>\n            {data ? data[relatedCollection?.admin?.useAsTitle || 'id'] : value}\n          </p>\n        </DocumentDrawerToggler>\n      </div>\n      {isEditable && (\n        <div className={`${baseClass}__actions`}>\n          <Button\n            buttonStyle=\"icon-label\"\n            className={`${baseClass}__swapButton`}\n            disabled={!isEditable}\n            el=\"button\"\n            icon=\"swap\"\n            onClick={() => {\n              if (nodeKey) {\n                editor.dispatchCommand(INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND, {\n                  replace: { nodeKey },\n                })\n              }\n            }}\n            round\n            tooltip={t('fields:swapRelationship')}\n          />\n          <Button\n            buttonStyle=\"icon-label\"\n            className={`${baseClass}__removeButton`}\n            disabled={!isEditable}\n            icon=\"x\"\n            onClick={(e) => {\n              e.preventDefault()\n              removeRelationship()\n            }}\n            round\n            tooltip={t('fields:removeRelationship')}\n          />\n        </div>\n      )}\n\n      {!!value && <DocumentDrawer onSave={updateRelationship} />}\n    </div>\n  )\n}\n"],
  "mappings": "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",
  "names": ["useLexicalComposerContext", "useLexicalEditable", "getTranslation", "Button", "useConfig", "usePayloadAPI", "useTranslation", "$getNodeByKey", "React", "useCallback", "useReducer", "useRef", "useState", "baseClass", "initialParams", "depth", "RelationshipComponent", "props", "data", "relationTo", "value", "nodeKey", "Error", "relationshipElemRef", "useRef", "editor", "useLexicalComposerContext", "isEditable", "useLexicalEditable", "config", "routes", "api", "serverURL", "getEntityConfig", "useConfig", "relatedCollection", "useState", "collectionSlug", "i18n", "t", "useTranslation", "cacheBust", "dispatchCacheBust", "useReducer", "state", "setParams", "usePayloadAPI", "slug", "closeDocumentDrawer", "DocumentDrawer", "DocumentDrawerToggler", "useLexicalDocumentDrawer", "id", "removeRelationship", "useCallback", "update", "$getNodeByKey", "remove", "updateRelationship", "React", "_jsxs", "className", "contentEditable", "ref", "_jsx", "label", "labels", "singular", "getTranslation", "admin", "useAsTitle", "Button", "buttonStyle", "disabled", "el", "icon", "onClick", "dispatchCommand", "INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND", "replace", "round", "tooltip", "e", "preventDefault", "onSave"]
}
