{"version":3,"file":"sanitize.js","names":["deepMerge","sanitizeClientFeatures","features","sanitized","enabledFeatures","enabledFormats","markdownTransformers","nodes","plugins","providers","slashMenu","dynamicGroups","groups","toolbarFixed","toolbarInline","customGroups","forEach","feature","key","sanitizedClientFeatureProps","size","length","concat","enableFormats","push","node","plugin","i","clientProps","Component","position","group","foundGroup","find","sanitizedGroup","items","filter","optionGroup","transformer","allNodes","allTransformers","Object","keys","map","customConfig","sort","a","b","order","sanitizeClientEditorConfig","resolvedClientFeatureMap","lexical","admin","resolvedFeatureMap"],"sources":["../../../../src/lexical/config/client/sanitize.ts"],"sourcesContent":["'use client'\n\nimport type { EditorConfig as LexicalEditorConfig } from 'lexical'\n\nimport { deepMerge } from 'payload/shared'\n\nimport type { ToolbarGroup } from '../../../features/toolbars/types.js'\nimport type {\n  ResolvedClientFeatureMap,\n  SanitizedClientFeatures,\n} from '../../../features/typesClient.js'\nimport type { LexicalFieldAdminClientProps } from '../../../types.js'\nimport type { SanitizedClientEditorConfig } from '../types.js'\n\nexport const sanitizeClientFeatures = (\n  features: ResolvedClientFeatureMap,\n): SanitizedClientFeatures => {\n  const sanitized: SanitizedClientFeatures = {\n    enabledFeatures: [],\n    enabledFormats: [],\n    markdownTransformers: [],\n    nodes: [],\n    plugins: [],\n    providers: [],\n    slashMenu: {\n      dynamicGroups: [],\n      groups: [],\n    },\n    toolbarFixed: {\n      groups: [],\n    },\n    toolbarInline: {\n      groups: [],\n    },\n  }\n\n  // Allow customization of groups for toolbarFixed\n  let customGroups: Record<string, Partial<ToolbarGroup>> = {}\n  features.forEach((feature) => {\n    if (feature.key === 'toolbarFixed' && feature.sanitizedClientFeatureProps?.customGroups) {\n      customGroups = {\n        ...customGroups,\n        ...feature.sanitizedClientFeatureProps.customGroups,\n      }\n    }\n  })\n\n  if (!features?.size) {\n    return sanitized\n  }\n\n  features.forEach((feature) => {\n    if (feature.providers?.length) {\n      sanitized.providers = sanitized.providers.concat(feature.providers)\n    }\n\n    if (feature.enableFormats?.length) {\n      sanitized.enabledFormats.push(...feature.enableFormats)\n    }\n\n    if (feature.nodes?.length) {\n      // Important: do not use concat\n      for (const node of feature.nodes) {\n        sanitized.nodes.push(node)\n      }\n    }\n    if (feature.plugins?.length) {\n      feature.plugins.forEach((plugin, i) => {\n        sanitized.plugins?.push({\n          clientProps: feature.sanitizedClientFeatureProps,\n          Component: plugin.Component as any, // Appeases strict: true\n          key: feature.key + i,\n          position: plugin.position,\n        })\n      })\n    }\n\n    if (feature.toolbarInline?.groups?.length) {\n      for (const group of feature.toolbarInline.groups) {\n        // 1. find the group with the same key or create new one\n        let foundGroup = sanitized.toolbarInline.groups.find(\n          (sanitizedGroup) => sanitizedGroup.key === group.key,\n        )\n        if (!foundGroup) {\n          foundGroup = {\n            ...group,\n            items: [],\n          }\n        } else {\n          sanitized.toolbarInline.groups = sanitized.toolbarInline.groups.filter(\n            (sanitizedGroup) => sanitizedGroup.key !== group.key,\n          )\n        }\n\n        // 2. Add options to group options array and add to sanitized.slashMenu.groupsWithOptions\n        if (group?.items?.length) {\n          foundGroup.items = foundGroup.items.concat(group.items)\n        }\n        sanitized.toolbarInline?.groups.push(foundGroup)\n      }\n    }\n\n    if (feature.toolbarFixed?.groups?.length) {\n      for (const group of feature.toolbarFixed.groups) {\n        // 1. find the group with the same key or create new one\n        let foundGroup = sanitized.toolbarFixed.groups.find(\n          (sanitizedGroup) => sanitizedGroup.key === group.key,\n        )\n        if (!foundGroup) {\n          foundGroup = {\n            ...group,\n            items: [],\n          }\n        } else {\n          sanitized.toolbarFixed.groups = sanitized.toolbarFixed.groups.filter(\n            (sanitizedGroup) => sanitizedGroup.key !== group.key,\n          )\n        }\n\n        // 2. Add options to group options array and add to sanitized.slashMenu.groupsWithOptions\n        if (group?.items?.length) {\n          foundGroup.items = foundGroup.items.concat(group.items)\n        }\n        sanitized.toolbarFixed?.groups.push(foundGroup)\n      }\n    }\n\n    if (feature.slashMenu?.groups) {\n      if (feature.slashMenu.dynamicGroups?.length) {\n        sanitized.slashMenu.dynamicGroups = sanitized.slashMenu.dynamicGroups.concat(\n          feature.slashMenu.dynamicGroups,\n        )\n      }\n\n      for (const optionGroup of feature.slashMenu.groups) {\n        // 1. find the group with the same name or create new one\n        let group = sanitized.slashMenu.groups.find((group) => group.key === optionGroup.key)\n        if (!group) {\n          group = {\n            ...optionGroup,\n            items: [],\n          }\n        } else {\n          sanitized.slashMenu.groups = sanitized.slashMenu.groups.filter(\n            (group) => group.key !== optionGroup.key,\n          )\n        }\n\n        // 2. Add options to group options array and add to sanitized.slashMenu.groupsWithOptions\n        if (optionGroup?.items?.length) {\n          group.items = group.items.concat(optionGroup.items)\n        }\n        sanitized.slashMenu.groups.push(group)\n      }\n    }\n\n    if (feature.markdownTransformers?.length) {\n      // Important: do not use concat\n      for (const transformer of feature.markdownTransformers) {\n        if (typeof transformer === 'function') {\n          sanitized.markdownTransformers.push(\n            transformer({\n              allNodes: sanitized.nodes,\n              allTransformers: sanitized.markdownTransformers,\n            }),\n          )\n        } else {\n          sanitized.markdownTransformers.push(transformer)\n        }\n      }\n    }\n    sanitized.enabledFeatures.push(feature.key)\n  })\n\n  // Apply custom group configurations to toolbarFixed groups\n  if (Object.keys(customGroups).length > 0) {\n    sanitized.toolbarFixed.groups = sanitized.toolbarFixed.groups.map((group) => {\n      const customConfig = customGroups[group.key]\n      if (customConfig) {\n        return deepMerge(group, customConfig)\n      }\n      return group\n    })\n  }\n\n  // Sort sanitized.toolbarInline.groups by order property\n  sanitized.toolbarInline.groups.sort((a, b) => {\n    if (a.order && b.order) {\n      return a.order - b.order\n    } else if (a.order) {\n      return -1\n    } else if (b.order) {\n      return 1\n    } else {\n      return 0\n    }\n  })\n  // Sort sanitized.toolbarFixed.groups by order property\n  sanitized.toolbarFixed.groups.sort((a, b) => {\n    if (a.order && b.order) {\n      return a.order - b.order\n    } else if (a.order) {\n      return -1\n    } else if (b.order) {\n      return 1\n    } else {\n      return 0\n    }\n  })\n\n  // Sort sanitized.toolbarInline.groups.[group].entries by order property\n  for (const group of sanitized.toolbarInline.groups) {\n    group.items.sort((a, b) => {\n      if (a.order && b.order) {\n        return a.order - b.order\n      } else if (a.order) {\n        return -1\n      } else if (b.order) {\n        return 1\n      } else {\n        return 0\n      }\n    })\n  }\n\n  // Sort sanitized.toolbarFixed.groups.[group].entries by order property\n  for (const group of sanitized.toolbarFixed.groups) {\n    group.items.sort((a, b) => {\n      if (a.order && b.order) {\n        return a.order - b.order\n      } else if (a.order) {\n        return -1\n      } else if (b.order) {\n        return 1\n      } else {\n        return 0\n      }\n    })\n  }\n\n  return sanitized\n}\n\nexport function sanitizeClientEditorConfig(\n  resolvedClientFeatureMap: ResolvedClientFeatureMap,\n  lexical?: LexicalEditorConfig,\n  admin?: LexicalFieldAdminClientProps,\n): SanitizedClientEditorConfig {\n  return {\n    admin,\n    features: sanitizeClientFeatures(resolvedClientFeatureMap),\n    lexical: lexical!,\n    resolvedFeatureMap: resolvedClientFeatureMap,\n  }\n}\n"],"mappings":"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","ignoreList":[]}