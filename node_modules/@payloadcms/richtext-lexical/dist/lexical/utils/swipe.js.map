{"version":3,"file":"swipe.js","names":["elements","WeakMap","readTouch","e","touch","changedTouches","undefined","clientX","clientY","addListener","element","cb","elementValues","get","listeners","Set","handleTouchstart","start","handleTouchend","end","listener","addEventListener","set","add","deleteListener","delete","size","removeEventListener","addSwipeLeftListener","force","x","y","Math","abs","addSwipeRightListener","addSwipeUpListener","addSwipeDownListener"],"sources":["../../../src/lexical/utils/swipe.ts"],"sourcesContent":["'use client'\ntype Force = [number, number]\ntype Listener = (force: Force, e: TouchEvent) => void\ninterface ElementValues {\n  handleTouchend: (e: TouchEvent) => void\n  handleTouchstart: (e: TouchEvent) => void\n  listeners: Set<Listener>\n  start: Force | null\n}\n\nconst elements = new WeakMap<HTMLElement, ElementValues>()\n\nfunction readTouch(e: TouchEvent): [number, number] | null {\n  const touch = e.changedTouches[0]\n  if (touch === undefined) {\n    return null\n  }\n  return [touch.clientX, touch.clientY]\n}\n\nfunction addListener(element: HTMLElement, cb: Listener): () => void {\n  let elementValues = elements.get(element)\n  if (elementValues === undefined) {\n    const listeners = new Set<Listener>()\n    const handleTouchstart = (e: TouchEvent): void => {\n      if (elementValues !== undefined) {\n        elementValues.start = readTouch(e)\n      }\n    }\n    const handleTouchend = (e: TouchEvent): void => {\n      if (elementValues === undefined) {\n        return\n      }\n      const { start } = elementValues\n      if (start === null) {\n        return\n      }\n      const end = readTouch(e)\n      for (const listener of listeners) {\n        if (end !== null) {\n          listener([end[0] - start[0], end[1] - start[1]], e)\n        }\n      }\n    }\n    element.addEventListener('touchstart', handleTouchstart)\n    element.addEventListener('touchend', handleTouchend)\n\n    elementValues = {\n      handleTouchend,\n      handleTouchstart,\n      listeners,\n      start: null,\n    }\n    elements.set(element, elementValues)\n  }\n  elementValues.listeners.add(cb)\n  return () => {\n    deleteListener(element, cb)\n  }\n}\n\nfunction deleteListener(element: HTMLElement, cb: Listener): void {\n  const elementValues = elements.get(element)\n  if (elementValues === undefined) {\n    return\n  }\n  const { listeners } = elementValues\n  listeners.delete(cb)\n  if (listeners.size === 0) {\n    elements.delete(element)\n    element.removeEventListener('touchstart', elementValues.handleTouchstart)\n    element.removeEventListener('touchend', elementValues.handleTouchend)\n  }\n}\n\nexport function addSwipeLeftListener(\n  element: HTMLElement,\n  cb: (_force: number, e: TouchEvent) => void,\n): () => void {\n  return addListener(element, (force, e) => {\n    const [x, y] = force\n    if (x < 0 && -x > Math.abs(y)) {\n      cb(x, e)\n    }\n  })\n}\n\nexport function addSwipeRightListener(\n  element: HTMLElement,\n  cb: (_force: number, e: TouchEvent) => void,\n): () => void {\n  return addListener(element, (force, e) => {\n    const [x, y] = force\n    if (x > 0 && x > Math.abs(y)) {\n      cb(x, e)\n    }\n  })\n}\n\nexport function addSwipeUpListener(\n  element: HTMLElement,\n  cb: (_force: number, e: TouchEvent) => void,\n): () => void {\n  return addListener(element, (force, e) => {\n    const [x, y] = force\n    if (y < 0 && -y > Math.abs(x)) {\n      cb(x, e)\n    }\n  })\n}\n\nexport function addSwipeDownListener(\n  element: HTMLElement,\n  cb: (_force: number, e: TouchEvent) => void,\n): () => void {\n  return addListener(element, (force, e) => {\n    const [x, y] = force\n    if (y > 0 && y > Math.abs(x)) {\n      cb(x, e)\n    }\n  })\n}\n"],"mappings":"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","ignoreList":[]}