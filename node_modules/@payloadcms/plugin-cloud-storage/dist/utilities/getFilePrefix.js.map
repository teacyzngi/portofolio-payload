{"version":3,"sources":["../../src/utilities/getFilePrefix.ts"],"sourcesContent":["import type { CollectionConfig, PayloadRequest, UploadConfig } from 'payload'\n\nexport async function getFilePrefix({\n  clientUploadContext,\n  collection,\n  filename,\n  req,\n}: {\n  clientUploadContext?: unknown\n  collection: CollectionConfig\n  filename: string\n  req: PayloadRequest\n}): Promise<string> {\n  // Prioritize from clientUploadContext if there is:\n  if (\n    clientUploadContext &&\n    typeof clientUploadContext === 'object' &&\n    'prefix' in clientUploadContext &&\n    typeof clientUploadContext.prefix === 'string'\n  ) {\n    return clientUploadContext.prefix\n  }\n\n  const imageSizes = (collection?.upload as UploadConfig)?.imageSizes || []\n\n  const files = await req.payload.find({\n    collection: collection.slug,\n    depth: 0,\n    draft: true,\n    limit: 1,\n    pagination: false,\n    where: {\n      or: [\n        {\n          filename: { equals: filename },\n        },\n        ...imageSizes.map((imageSize) => ({\n          [`sizes.${imageSize.name}.filename`]: { equals: filename },\n        })),\n      ],\n    },\n  })\n  const prefix = files?.docs?.[0]?.prefix\n  return prefix ? (prefix as string) : ''\n}\n"],"names":["getFilePrefix","clientUploadContext","collection","filename","req","prefix","imageSizes","upload","files","payload","find","slug","depth","draft","limit","pagination","where","or","equals","map","imageSize","name","docs"],"mappings":"AAEA,OAAO,eAAeA,cAAc,EAClCC,mBAAmB,EACnBC,UAAU,EACVC,QAAQ,EACRC,GAAG,EAMJ;IACC,mDAAmD;IACnD,IACEH,uBACA,OAAOA,wBAAwB,YAC/B,YAAYA,uBACZ,OAAOA,oBAAoBI,MAAM,KAAK,UACtC;QACA,OAAOJ,oBAAoBI,MAAM;IACnC;IAEA,MAAMC,aAAa,AAACJ,YAAYK,QAAyBD,cAAc,EAAE;IAEzE,MAAME,QAAQ,MAAMJ,IAAIK,OAAO,CAACC,IAAI,CAAC;QACnCR,YAAYA,WAAWS,IAAI;QAC3BC,OAAO;QACPC,OAAO;QACPC,OAAO;QACPC,YAAY;QACZC,OAAO;YACLC,IAAI;gBACF;oBACEd,UAAU;wBAAEe,QAAQf;oBAAS;gBAC/B;mBACGG,WAAWa,GAAG,CAAC,CAACC,YAAe,CAAA;wBAChC,CAAC,CAAC,MAAM,EAAEA,UAAUC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE;4BAAEH,QAAQf;wBAAS;oBAC3D,CAAA;aACD;QACH;IACF;IACA,MAAME,SAASG,OAAOc,MAAM,CAAC,EAAE,EAAEjB;IACjC,OAAOA,SAAUA,SAAoB;AACvC"}